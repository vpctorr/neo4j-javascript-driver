var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(r){var n;return r.__esModule?r:(n=Object.defineProperty({},"__esModule",{value:!0}),Object.keys(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}})}),n)}var lib$2={},version$1={},logging=(Object.defineProperty(version$1,"__esModule",{value:!0}),version$1.default="0.0.0-dev",{});Object.defineProperty(logging,"__esModule",{value:!0}),logging.logging=void 0,logging.logging={console:function(e){return{level:e,logger:function(e,t){return console.log("".concat(Date.now()," ").concat(e.toUpperCase()," ").concat(t))}}}};const SERVICE_UNAVAILABLE$5="ServiceUnavailable",SESSION_EXPIRED$2="SessionExpired",PROTOCOL_ERROR$6="ProtocolError",NOT_AVAILABLE$1="N/A";class Neo4jError extends Error{code;retriable;__proto__;constructor(e,t,r){super(e,null!=r?{cause:r}:void 0),this.constructor=Neo4jError,this.__proto__=Neo4jError.prototype,this.code=t,this.name="Neo4jError",this.retriable=_isRetriableCode(t)}static isRetriable(e){return null!=e&&e instanceof Neo4jError&&e.retriable}}function newError(e,t,r){return new Neo4jError(e,t??NOT_AVAILABLE$1,r)}const isRetriableError=Neo4jError.isRetriable;function _isRetriableCode(e){return e===SERVICE_UNAVAILABLE$5||e===SESSION_EXPIRED$2||_isAuthorizationExpired(e)||_isTransientError(e)}function _isTransientError(e){return!0===e?.includes("TransientError")}function _isAuthorizationExpired(e){return"Neo.ClientError.Security.AuthorizationExpired"===e}const INT_CACHE=new Map;class Integer{low;high;constructor(e,t){this.low=e??0,this.high=t??0}inSafeRange(){return this.greaterThanOrEqual(Integer.MIN_SAFE_VALUE)&&this.lessThanOrEqual(Integer.MAX_SAFE_VALUE)}toInt(){return this.low}toNumber(){return this.high*TWO_PWR_32_DBL+(this.low>>>0)}toBigInt(){var e;return this.isZero()?BigInt(0):this.isPositive()?BigInt(this.high>>>0)*BigInt(TWO_PWR_32_DBL)+BigInt(this.low>>>0):(e=this.negate(),BigInt(-1)*(BigInt(e.high>>>0)*BigInt(TWO_PWR_32_DBL)+BigInt(e.low>>>0)))}toNumberOrInfinity(){return this.lessThan(Integer.MIN_SAFE_VALUE)?Number.NEGATIVE_INFINITY:this.greaterThan(Integer.MAX_SAFE_VALUE)?Number.POSITIVE_INFINITY:this.toNumber()}toString(t){if((t=t??10)<2||36<t)throw RangeError("radix out of range: "+t.toString());if(this.isZero())return"0";let r;var e,n;if(this.isNegative())return this.equals(Integer.MIN_VALUE)?(e=Integer.fromNumber(t),n=this.div(e),r=n.multiply(e).subtract(this),n.toString(t)+r.toInt().toString(t)):"-"+this.negate().toString(t);var o=Integer.fromNumber(Math.pow(t,6));r=this;let i="";for(;;){var s=r.div(o);let e=(r.subtract(s.multiply(o)).toInt()>>>0).toString(t);if((r=s).isZero())return e+i;for(;e.length<6;)e="0"+e;i=""+e+i}}valueOf(){return this.toBigInt()}getHighBits(){return this.high}getLowBits(){return this.low}getNumBitsAbs(){if(this.isNegative())return this.equals(Integer.MIN_VALUE)?64:this.negate().getNumBitsAbs();var e=0!==this.high?this.high:this.low;let t=0;for(t=31;0<t&&0==(e&1<<t);t--);return 0!==this.high?t+33:t+1}isZero(){return 0===this.high&&0===this.low}isNegative(){return this.high<0}isPositive(){return 0<=this.high}isOdd(){return 1==(1&this.low)}isEven(){return 0==(1&this.low)}equals(e){e=Integer.fromValue(e);return this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}lessThan(e){return this.compare(e)<0}lessThanOrEqual(e){return this.compare(e)<=0}greaterThan(e){return 0<this.compare(e)}greaterThanOrEqual(e){return 0<=this.compare(e)}compare(e){var t,r,e=Integer.fromValue(e);return this.equals(e)?0:(t=this.isNegative(),r=e.isNegative(),t&&!r||(t||!r)&&this.subtract(e).isNegative()?-1:1)}negate(){return this.equals(Integer.MIN_VALUE)?Integer.MIN_VALUE:this.not().add(Integer.ONE)}add(e){var e=Integer.fromValue(e),t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,s=65535&e.high,a=e.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=o+(65535&e.low))>>>16,h&=65535,l+=(c+=n+a)>>>16,c&=65535,u+=(l+=r+s)>>>16,l&=65535,u=u+(t+i)&65535,Integer.fromBits(c<<16|h,u<<16|l)}subtract(e){e=Integer.fromValue(e);return this.add(e.negate())}multiply(e){var t,r,n,o,i,s,a,u,l,c,h;return this.isZero()||(e=Integer.fromValue(e)).isZero()?Integer.ZERO:this.equals(Integer.MIN_VALUE)?e.isOdd()?Integer.MIN_VALUE:Integer.ZERO:e.equals(Integer.MIN_VALUE)?this.isOdd()?Integer.MIN_VALUE:Integer.ZERO:this.isNegative()?e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate():e.isNegative()?this.multiply(e.negate()).negate():this.lessThan(TWO_PWR_24)&&e.lessThan(TWO_PWR_24)?Integer.fromNumber(this.toNumber()*e.toNumber()):(t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,s=65535&e.high,a=e.low>>>16,h=c=l=u=0,c+=(h+=o*(e=65535&e.low))>>>16,h&=65535,l=((c+=n*e)>>>16)+((c=(c&65535)+o*a)>>>16),c&=65535,u=(u+=(l+=r*e)>>>16)+((l=(l&65535)+n*a)>>>16)+((l=(l&65535)+o*s)>>>16),l&=65535,u=t*e+r*a+n*s+o*i+u&65535,Integer.fromBits(c<<16|h,u<<16|l))}div(e){var r=Integer.fromValue(e);if(r.isZero())throw newError("division by zero");if(this.isZero())return Integer.ZERO;let n,o,i;if(this.equals(Integer.MIN_VALUE))return r.equals(Integer.ONE)||r.equals(Integer.NEG_ONE)?Integer.MIN_VALUE:r.equals(Integer.MIN_VALUE)?Integer.ONE:(e=this.shiftRight(1),(n=e.div(r).shiftLeft(1)).equals(Integer.ZERO)?r.isNegative()?Integer.ONE:Integer.NEG_ONE:(o=this.subtract(r.multiply(n)),i=n.add(o.div(r))));if(r.equals(Integer.MIN_VALUE))return Integer.ZERO;if(this.isNegative())return r.isNegative()?this.negate().div(r.negate()):this.negate().div(r).negate();if(r.isNegative())return this.div(r.negate()).negate();for(i=Integer.ZERO,o=this;o.greaterThanOrEqual(r);){n=Math.max(1,Math.floor(o.toNumber()/r.toNumber()));var s=Math.ceil(Math.log(n)/Math.LN2),a=s<=48?1:Math.pow(2,s-48);let e=Integer.fromNumber(n),t=e.multiply(r);for(;t.isNegative()||t.greaterThan(o);)n-=a,e=Integer.fromNumber(n),t=e.multiply(r);e.isZero()&&(e=Integer.ONE),i=i.add(e),o=o.subtract(t)}return i}modulo(e){e=Integer.fromValue(e);return this.subtract(this.div(e).multiply(e))}not(){return Integer.fromBits(~this.low,~this.high)}and(e){e=Integer.fromValue(e);return Integer.fromBits(this.low&e.low,this.high&e.high)}or(e){e=Integer.fromValue(e);return Integer.fromBits(this.low|e.low,this.high|e.high)}xor(e){e=Integer.fromValue(e);return Integer.fromBits(this.low^e.low,this.high^e.high)}shiftLeft(e){e=Integer.toNumber(e);return 0==(e&=63)?Integer.ZERO:e<32?Integer.fromBits(this.low<<e,this.high<<e|this.low>>>32-e):Integer.fromBits(0,this.low<<e-32)}shiftRight(e){var t=Integer.toNumber(e),e=Integer.toNumber(e);return 0==(t&=63)?Integer.ZERO:e<32?Integer.fromBits(this.low>>>t|this.high<<32-t,this.high>>t):Integer.fromBits(this.high>>t-32,0<=this.high?0:-1)}static ZERO=Integer.fromInt(0);static ONE=Integer.fromInt(1);static NEG_ONE=Integer.fromInt(-1);static MAX_VALUE=Integer.fromBits(-1,2147483647);static MIN_VALUE=Integer.fromBits(0,-2147483648);static MIN_SAFE_VALUE=Integer.fromBits(1,-2097152);static MAX_SAFE_VALUE=Integer.fromBits(-1,2097151);static __isInteger__=!0;static isInteger(e){return!0===e?.__isInteger__}static fromInt(e){var t;return-128<=(e|=0)&&e<128&&null!=(t=INT_CACHE.get(e))||(t=new Integer(e,e<0?-1:0),-128<=e&&e<128&&INT_CACHE.set(e,t)),t}static fromBits(e,t){return new Integer(e,t)}static fromNumber(e){return isNaN(e)||!isFinite(e)?Integer.ZERO:e<=-TWO_PWR_63_DBL?Integer.MIN_VALUE:e+1>=TWO_PWR_63_DBL?Integer.MAX_VALUE:e<0?Integer.fromNumber(-e).negate():new Integer(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0)}static fromString(t,r,{strictStringValidation:n}={}){if(0===t.length)throw newError("number format error: empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Integer.ZERO;if((r=r??10)<2||36<r)throw newError("radix out of range: "+r.toString());var e;if(0<(e=t.indexOf("-")))throw newError('number format error: interior "-" character: '+t);if(0===e)return Integer.fromString(t.substring(1),r).negate();var o=Integer.fromNumber(Math.pow(r,8));let i=Integer.ZERO;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e),a=t.substring(e,e+s),u=parseInt(a,r);if(!0===n&&!_isValidNumberFromString(a,u,r))throw newError(`number format error: "${a}" is NaN in radix ${r}: `+t);i=(s<8?(a=Integer.fromNumber(Math.pow(r,s)),i.multiply(a)):i=i.multiply(o)).add(Integer.fromNumber(u))}return i}static fromValue(e,t={}){return e instanceof Integer?e:"number"==typeof e?(!0===t.ceilFloat&&(e=Math.ceil(e)),Integer.fromNumber(e)):"string"==typeof e?Integer.fromString(e,void 0,t):"bigint"==typeof e?Integer.fromString(e.toString()):new Integer(e.low,e.high)}static toNumber(e){switch(typeof e){case"number":return e;case"bigint":return Number(e);default:return Integer.fromValue(e).toNumber()}}static toString(e,t){return Integer.fromValue(e).toString(t)}static inSafeRange(e){return Integer.fromValue(e).inSafeRange()}}function _convertNumberToString(e,t,r){e=e.toString(t),t=Math.max(r-e.length,0);return""+"0".repeat(t)+e}function _isValidNumberFromString(e,t,r){return!Number.isNaN(e)&&!Number.isNaN(t)&&_convertNumberToString(t,r,e.length)===e.toLowerCase()}Object.defineProperty(Integer.prototype,"__isInteger__",{value:!0,enumerable:!1,configurable:!1});const TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=Integer.fromInt(TWO_PWR_24_DBL),int=Integer.fromValue,isInt=Integer.isInteger,inSafeRange=Integer.inSafeRange,toNumber=Integer.toNumber,toString=Integer.toString,__isBrokenObject__="__isBrokenObject__",__reason__="__reason__";function createBrokenObject(r,e={}){const n=()=>{throw r};return new Proxy(e,{get:(e,t)=>t===__isBrokenObject__||(t===__reason__?r:void("toJSON"!==t&&n())),set:n,apply:n,construct:n,defineProperty:n,deleteProperty:n,getOwnPropertyDescriptor:n,getPrototypeOf:n,has:n,isExtensible:n,ownKeys:n,preventExtensions:n,setPrototypeOf:n})}function isBrokenObject(e){return null!==e&&"object"==typeof e&&!0===e[__isBrokenObject__]}function getBrokenObjectReason(e){return e[__reason__]}var objectUtil$1=Object.freeze({__proto__:null,createBrokenObject:createBrokenObject,isBrokenObject:isBrokenObject,getBrokenObjectReason:getBrokenObjectReason});function stringify(e){return JSON.stringify(e,(e,t)=>isBrokenObject(t)?{__isBrokenObject__:!0,__reason__:getBrokenObjectReason(t)}:"bigint"==typeof t?t+"n":t)}var json=Object.freeze({__proto__:null,stringify:stringify});const ENCRYPTION_ON$2="ENCRYPTION_ON",ENCRYPTION_OFF$2="ENCRYPTION_OFF";function isEmptyObjectOrNull(e){if(null!==e){if(!isObject(e))return!1;for(const t in e)if(void 0!==e[t])return!1}return!0}function isObject(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}function validateQueryAndParameters(e,t,r){let n="",o=t??{};t=r?.skipAsserts??!1;return"string"==typeof e?n=e:e instanceof String?n=e.toString():"object"==typeof e&&null!=e.text&&(n=e.text,o=e.parameters??{}),t||(assertCypherQuery(n),assertQueryParameters(o)),{validatedQuery:n,params:o}}function assertObject(e,t){if(isObject(e))return e;throw new TypeError(t+" expected to be an object but was: "+stringify(e))}function assertString$1(e,t){if(isString(e))return e;throw new TypeError(stringify(t)+" expected to be string but was: "+stringify(e))}function assertNumber(e,t){if("number"!=typeof e)throw new TypeError(t+" expected to be a number but was: "+stringify(e));return e}function assertNumberOrInteger(e,t){if("number"==typeof e||"bigint"==typeof e||isInt(e))return e;throw new TypeError(t+" expected to be either a number or an Integer object but was: "+stringify(e))}function assertValidDate(e,t){if("[object Date]"!==Object.prototype.toString.call(e))throw new TypeError(t+" expected to be a standard JavaScript Date but was: "+stringify(e));if(Number.isNaN(e.getTime()))throw new TypeError(t+" expected to be valid JavaScript Date but its time was NaN: "+stringify(e));return e}function assertCypherQuery(e){if(assertString$1(e,"Cypher query"),0===e.trim().length)throw new TypeError("Cypher query is expected to be a non-empty string.")}function assertQueryParameters(e){var t;if(!isObject(e))throw t=null!=e.constructor?" "+e.constructor.name:"",new TypeError(`Query parameters are expected to either be undefined/null or an object, given:${t} `+JSON.stringify(e))}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function equals$1(e,t){if(e!==t){if(null===e||null===t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const o of r)if(!equals$1(e[o],t[o]))return!1}return!0}var util=Object.freeze({__proto__:null,isEmptyObjectOrNull:isEmptyObjectOrNull,isObject:isObject,isString:isString,assertObject:assertObject,assertString:assertString$1,assertNumber:assertNumber,assertNumberOrInteger:assertNumberOrInteger,assertValidDate:assertValidDate,validateQueryAndParameters:validateQueryAndParameters,equals:equals$1,ENCRYPTION_ON:ENCRYPTION_ON$2,ENCRYPTION_OFF:ENCRYPTION_OFF$2});class ValueRange{_minNumber;_maxNumber;_minInteger;_maxInteger;constructor(e,t){this._minNumber=e,this._maxNumber=t,this._minInteger=int(e),this._maxInteger=int(t)}contains(e){var t;return isInt(e)&&e instanceof Integer?e.greaterThanOrEqual(this._minInteger)&&e.lessThanOrEqual(this._maxInteger):"bigint"==typeof e?(t=int(e)).greaterThanOrEqual(this._minInteger)&&t.lessThanOrEqual(this._maxInteger):e>=this._minNumber&&e<=this._maxNumber}toString(){return`[${this._minNumber}, ${this._maxNumber}]`}}const YEAR_RANGE=new ValueRange(-999999999,999999999),MONTH_OF_YEAR_RANGE=new ValueRange(1,12),DAY_OF_MONTH_RANGE=new ValueRange(1,31),HOUR_OF_DAY_RANGE=new ValueRange(0,23),MINUTE_OF_HOUR_RANGE=new ValueRange(0,59),SECOND_OF_MINUTE_RANGE=new ValueRange(0,59),NANOSECOND_OF_SECOND_RANGE=new ValueRange(0,999999999),MINUTES_PER_HOUR=60,SECONDS_PER_MINUTE=60,SECONDS_PER_HOUR=SECONDS_PER_MINUTE*MINUTES_PER_HOUR,NANOS_PER_SECOND$1=1e9,NANOS_PER_MILLISECOND=1e6,NANOS_PER_MINUTE$1=NANOS_PER_SECOND$1*SECONDS_PER_MINUTE,NANOS_PER_HOUR$1=NANOS_PER_MINUTE$1*MINUTES_PER_HOUR,DAYS_0000_TO_1970$1=719528,DAYS_PER_400_YEAR_CYCLE$1=146097,SECONDS_PER_DAY$1=86400;function normalizeSecondsForDuration(e,t){return int(e).add(floorDiv$1(t,NANOS_PER_SECOND$1))}function normalizeNanosecondsForDuration(e){return floorMod$1(e,NANOS_PER_SECOND$1)}function localTimeToNanoOfDay$1(e,t,r,n){e=int(e),t=int(t),r=int(r),n=int(n);let o=e.multiply(NANOS_PER_HOUR$1);return(o=(o=o.add(t.multiply(NANOS_PER_MINUTE$1))).add(r.multiply(NANOS_PER_SECOND$1))).add(n)}function localDateTimeToEpochSecond$2(e,t,r,n,o,i,s){e=dateToEpochDay$1(e,t,r),t=localTimeToSecondOfDay(n,o,i);return e.multiply(SECONDS_PER_DAY$1).add(t)}function dateToEpochDay$1(e,t,r){e=int(e),t=int(t),r=int(r);let n=e.multiply(365);return n=(n=(n=e.greaterThanOrEqual(0)?n.add(e.add(3).div(4).subtract(e.add(99).div(100)).add(e.add(399).div(400))):n.subtract(e.div(-4).subtract(e.div(-100)).add(e.div(-400)))).add(t.multiply(367).subtract(362).div(12))).add(r.subtract(1)),t.greaterThan(2)&&(n=n.subtract(1),isLeapYear(e)||(n=n.subtract(1))),n.subtract(DAYS_0000_TO_1970$1)}function durationToIsoString(e,t,r,n){return`P${formatNumber(e)}M${formatNumber(t)}DT${formatSecondsAndNanosecondsForDuration(r,n)}S`}function timeToIsoString(e,t,r,n){return formatNumber(e,2)+`:${formatNumber(t,2)}:`+formatNumber(r,2)+formatNanosecond(n)}function timeZoneOffsetToIsoString(e){var t,r,n;return(e=int(e)).equals(0)?"Z":(t=(r=e.isNegative())?"-":"+",r=formatNumber((e=r?e.multiply(-1):e).div(SECONDS_PER_HOUR),2),n=formatNumber(e.div(SECONDS_PER_MINUTE).modulo(MINUTES_PER_HOUR),2),null!=(e=(e=e.modulo(SECONDS_PER_MINUTE)).equals(0)?null:formatNumber(e,2))?t+r+`:${n}:`+e:t+r+":"+n)}function dateToIsoString(e,t,r){return formatYear(e)+`-${formatNumber(t,2)}-`+formatNumber(r,2)}function isoStringToStandardDate(e){return new Date(e)}function toStandardDate(e){return new Date(e)}function newDate(e){return new Date(e)}function totalNanoseconds(e,t){return add(t=t??0,e.getMilliseconds()*NANOS_PER_MILLISECOND)}function timeZoneOffsetInSeconds(e){var t=e.getSeconds()>=e.getUTCSeconds()?e.getSeconds()-e.getUTCSeconds():e.getSeconds()-e.getUTCSeconds()+60,e=e.getTimezoneOffset();return 0===e?0+t:-1*e*SECONDS_PER_MINUTE+t}function assertValidYear(e){return assertValidTemporalValue(e,YEAR_RANGE,"Year")}function assertValidMonth(e){return assertValidTemporalValue(e,MONTH_OF_YEAR_RANGE,"Month")}function assertValidDay(e){return assertValidTemporalValue(e,DAY_OF_MONTH_RANGE,"Day")}function assertValidHour(e){return assertValidTemporalValue(e,HOUR_OF_DAY_RANGE,"Hour")}function assertValidMinute(e){return assertValidTemporalValue(e,MINUTE_OF_HOUR_RANGE,"Minute")}function assertValidSecond(e){return assertValidTemporalValue(e,SECOND_OF_MINUTE_RANGE,"Second")}function assertValidNanosecond(e){return assertValidTemporalValue(e,NANOSECOND_OF_SECOND_RANGE,"Nanosecond")}function assertValidZoneId(t,r){try{Intl.DateTimeFormat(void 0,{timeZone:r})}catch(e){throw newError(t+` is expected to be a valid ZoneId but was: "${r}"`)}}function assertValidTemporalValue(e,t,r){if(assertNumberOrInteger(e,r),t.contains(e))return e;throw newError(`${r} is expected to be in range ${t.toString()} but was: `+e.toString())}function localTimeToSecondOfDay(e,t,r){e=int(e),t=int(t),r=int(r);let n=e.multiply(SECONDS_PER_HOUR);return(n=n.add(t.multiply(SECONDS_PER_MINUTE))).add(r)}function isLeapYear(e){return!(!(e=int(e)).modulo(4).equals(0)||e.modulo(100).equals(0)&&!e.modulo(400).equals(0))}function floorDiv$1(e,t){e=int(e),t=int(t);let r=e.div(t);return r=e.isPositive()!==t.isPositive()&&r.multiply(t).notEquals(e)?r.subtract(1):r}function floorMod$1(e,t){return e=int(e),t=int(t),e.subtract(floorDiv$1(e,t).multiply(t))}function formatSecondsAndNanosecondsForDuration(e,t){e=int(e),t=int(t);let r,n;var o=e.isNegative(),i=t.greaterThan(0);return r=o&&i?e.equals(-1)?"-0":e.add(1).toString():e.toString(),null!=(n=i?formatNanosecond((o?t.negate().add(2*NANOS_PER_SECOND$1):t.add(NANOS_PER_SECOND$1)).modulo(NANOS_PER_SECOND$1)):n)?r+n:r}function formatNanosecond(e){return(e=int(e)).equals(0)?"":"."+formatNumber(e,9)}function formatYear(e){e=int(e);return e.isNegative()||e.greaterThan(9999)?formatNumber(e,6,{usePositiveSign:!0}):formatNumber(e,4)}function formatNumber(e,t,r){var n=(e=int(e)).isNegative();let o=(e=n?e.negate():e).toString();if(null!=t)for(;o.length<t;)o="0"+o;return n?"-"+o:!0===r?.usePositiveSign?"+"+o:o}function add(e,t){return e instanceof Integer?e.add(t):"bigint"==typeof e?e+BigInt(t):e+t}var temporalUtil=Object.freeze({__proto__:null,YEAR_RANGE:YEAR_RANGE,MONTH_OF_YEAR_RANGE:MONTH_OF_YEAR_RANGE,DAY_OF_MONTH_RANGE:DAY_OF_MONTH_RANGE,HOUR_OF_DAY_RANGE:HOUR_OF_DAY_RANGE,MINUTE_OF_HOUR_RANGE:MINUTE_OF_HOUR_RANGE,SECOND_OF_MINUTE_RANGE:SECOND_OF_MINUTE_RANGE,NANOSECOND_OF_SECOND_RANGE:NANOSECOND_OF_SECOND_RANGE,MINUTES_PER_HOUR:MINUTES_PER_HOUR,SECONDS_PER_MINUTE:SECONDS_PER_MINUTE,SECONDS_PER_HOUR:SECONDS_PER_HOUR,NANOS_PER_SECOND:NANOS_PER_SECOND$1,NANOS_PER_MILLISECOND:NANOS_PER_MILLISECOND,NANOS_PER_MINUTE:NANOS_PER_MINUTE$1,NANOS_PER_HOUR:NANOS_PER_HOUR$1,DAYS_0000_TO_1970:DAYS_0000_TO_1970$1,DAYS_PER_400_YEAR_CYCLE:DAYS_PER_400_YEAR_CYCLE$1,SECONDS_PER_DAY:SECONDS_PER_DAY$1,normalizeSecondsForDuration:normalizeSecondsForDuration,normalizeNanosecondsForDuration:normalizeNanosecondsForDuration,localTimeToNanoOfDay:localTimeToNanoOfDay$1,localDateTimeToEpochSecond:localDateTimeToEpochSecond$2,dateToEpochDay:dateToEpochDay$1,durationToIsoString:durationToIsoString,timeToIsoString:timeToIsoString,timeZoneOffsetToIsoString:timeZoneOffsetToIsoString,dateToIsoString:dateToIsoString,isoStringToStandardDate:isoStringToStandardDate,toStandardDate:toStandardDate,newDate:newDate,totalNanoseconds:totalNanoseconds,timeZoneOffsetInSeconds:timeZoneOffsetInSeconds,assertValidYear:assertValidYear,assertValidMonth:assertValidMonth,assertValidDay:assertValidDay,assertValidHour:assertValidHour,assertValidMinute:assertValidMinute,assertValidSecond:assertValidSecond,assertValidNanosecond:assertValidNanosecond,assertValidZoneId:assertValidZoneId,floorDiv:floorDiv$1,floorMod:floorMod$1});const IDENTIFIER_PROPERTY_ATTRIBUTES$1={value:!0,enumerable:!1,configurable:!1,writable:!1},DURATION_IDENTIFIER_PROPERTY="__isDuration__",LOCAL_TIME_IDENTIFIER_PROPERTY="__isLocalTime__",TIME_IDENTIFIER_PROPERTY="__isTime__",DATE_IDENTIFIER_PROPERTY="__isDate__",LOCAL_DATE_TIME_IDENTIFIER_PROPERTY="__isLocalDateTime__",DATE_TIME_IDENTIFIER_PROPERTY="__isDateTime__";class Duration{months;days;seconds;nanoseconds;constructor(e,t,r,n){this.months=assertNumberOrInteger(e,"Months"),this.days=assertNumberOrInteger(t,"Days"),assertNumberOrInteger(r,"Seconds"),assertNumberOrInteger(n,"Nanoseconds"),this.seconds=normalizeSecondsForDuration(r,n),this.nanoseconds=normalizeNanosecondsForDuration(n),Object.freeze(this)}toString(){return durationToIsoString(this.months,this.days,this.seconds,this.nanoseconds)}}function isDuration(e){return hasIdentifierProperty$1(e,DURATION_IDENTIFIER_PROPERTY)}Object.defineProperty(Duration.prototype,DURATION_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES$1);class LocalTime{hour;minute;second;nanosecond;constructor(e,t,r,n){this.hour=assertValidHour(e),this.minute=assertValidMinute(t),this.second=assertValidSecond(r),this.nanosecond=assertValidNanosecond(n),Object.freeze(this)}static fromStandardDate(e,t){verifyStandardDateAndNanos(e,t);t=totalNanoseconds(e,t);return new LocalTime(e.getHours(),e.getMinutes(),e.getSeconds(),t instanceof Integer?t.toInt():"bigint"==typeof t?int(t).toInt():t)}toString(){return timeToIsoString(this.hour,this.minute,this.second,this.nanosecond)}}function isLocalTime(e){return hasIdentifierProperty$1(e,LOCAL_TIME_IDENTIFIER_PROPERTY)}Object.defineProperty(LocalTime.prototype,LOCAL_TIME_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES$1);class Time{hour;minute;second;nanosecond;timeZoneOffsetSeconds;constructor(e,t,r,n,o){this.hour=assertValidHour(e),this.minute=assertValidMinute(t),this.second=assertValidSecond(r),this.nanosecond=assertValidNanosecond(n),this.timeZoneOffsetSeconds=assertNumberOrInteger(o,"Time zone offset in seconds"),Object.freeze(this)}static fromStandardDate(e,t){return verifyStandardDateAndNanos(e,t),new Time(e.getHours(),e.getMinutes(),e.getSeconds(),toNumber(totalNanoseconds(e,t)),timeZoneOffsetInSeconds(e))}toString(){return timeToIsoString(this.hour,this.minute,this.second,this.nanosecond)+timeZoneOffsetToIsoString(this.timeZoneOffsetSeconds)}}function isTime(e){return hasIdentifierProperty$1(e,TIME_IDENTIFIER_PROPERTY)}Object.defineProperty(Time.prototype,TIME_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES$1);class Date$1{year;month;day;constructor(e,t,r){this.year=assertValidYear(e),this.month=assertValidMonth(t),this.day=assertValidDay(r),Object.freeze(this)}static fromStandardDate(e){return verifyStandardDateAndNanos(e),new Date$1(e.getFullYear(),e.getMonth()+1,e.getDate())}toStandardDate(){return isoStringToStandardDate(this.toString())}toString(){return dateToIsoString(this.year,this.month,this.day)}}function isDate(e){return hasIdentifierProperty$1(e,DATE_IDENTIFIER_PROPERTY)}Object.defineProperty(Date$1.prototype,DATE_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES$1);class LocalDateTime{year;month;day;hour;minute;second;nanosecond;constructor(e,t,r,n,o,i,s){this.year=assertValidYear(e),this.month=assertValidMonth(t),this.day=assertValidDay(r),this.hour=assertValidHour(n),this.minute=assertValidMinute(o),this.second=assertValidSecond(i),this.nanosecond=assertValidNanosecond(s),Object.freeze(this)}static fromStandardDate(e,t){return verifyStandardDateAndNanos(e,t),new LocalDateTime(e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),toNumber(totalNanoseconds(e,t)))}toStandardDate(){return isoStringToStandardDate(this.toString())}toString(){return localDateTimeToString(this.year,this.month,this.day,this.hour,this.minute,this.second,this.nanosecond)}}function isLocalDateTime(e){return hasIdentifierProperty$1(e,LOCAL_DATE_TIME_IDENTIFIER_PROPERTY)}Object.defineProperty(LocalDateTime.prototype,LOCAL_DATE_TIME_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES$1);class DateTime{year;month;day;hour;minute;second;nanosecond;timeZoneOffsetSeconds;timeZoneId;constructor(e,t,r,n,o,i,s,a,u){this.year=assertValidYear(e),this.month=assertValidMonth(t),this.day=assertValidDay(r),this.hour=assertValidHour(n),this.minute=assertValidMinute(o),this.second=assertValidSecond(i),this.nanosecond=assertValidNanosecond(s);var[e,t]=verifyTimeZoneArguments(a,u);this.timeZoneOffsetSeconds=e,this.timeZoneId=t??void 0,Object.freeze(this)}static fromStandardDate(e,t){return verifyStandardDateAndNanos(e,t),new DateTime(e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),toNumber(totalNanoseconds(e,t)),timeZoneOffsetInSeconds(e),null)}toStandardDate(){return toStandardDate(this._toUTC())}toString(){return localDateTimeToString(this.year,this.month,this.day,this.hour,this.minute,this.second,this.nanosecond)+(null!=this.timeZoneOffsetSeconds?timeZoneOffsetToIsoString(this.timeZoneOffsetSeconds??0):"")+(null!=this.timeZoneId?`[${this.timeZoneId}]`:"")}_toUTC(){if(void 0===this.timeZoneOffsetSeconds)throw new Error("Requires DateTime created with time zone offset");var e=localDateTimeToEpochSecond$2(this.year,this.month,this.day,this.hour,this.minute,this.second,this.nanosecond).subtract(this.timeZoneOffsetSeconds??0);return int(e).multiply(1e3).add(int(this.nanosecond).div(1e6)).toNumber()}}function isDateTime(e){return hasIdentifierProperty$1(e,DATE_TIME_IDENTIFIER_PROPERTY)}function hasIdentifierProperty$1(e,t){return null!=e&&!0===e[t]}function localDateTimeToString(e,t,r,n,o,i,s){return dateToIsoString(e,t,r)+"T"+timeToIsoString(n,o,i,s)}function verifyTimeZoneArguments(e,t){var r,n=null!=e,o=null!=t&&""!==t;if(n||o)return r=[void 0,void 0],n&&(assertNumberOrInteger(e,"Time zone offset in seconds"),r[0]=e),o&&(assertString$1(t,"Time zone ID"),assertValidZoneId("Time zone ID",t),r[1]=t),r;throw newError(`Unable to create DateTime without either time zone offset or id. Please specify either of them. Given offset: ${e} and id: `+t)}function verifyStandardDateAndNanos(e,t){assertValidDate(e,"Standard date"),null!=t&&assertNumberOrInteger(t,"Nanosecond")}Object.defineProperty(DateTime.prototype,DATE_TIME_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES$1);const IDENTIFIER_PROPERTY_ATTRIBUTES={value:!0,enumerable:!1,configurable:!1,writable:!1},NODE_IDENTIFIER_PROPERTY="__isNode__",RELATIONSHIP_IDENTIFIER_PROPERTY="__isRelationship__",UNBOUND_RELATIONSHIP_IDENTIFIER_PROPERTY="__isUnboundRelationship__",PATH_IDENTIFIER_PROPERTY="__isPath__",PATH_SEGMENT_IDENTIFIER_PROPERTY="__isPathSegment__";function hasIdentifierProperty(e,t){return null!=e&&!0===e[t]}class Node{identity;labels;properties;elementId;constructor(e,t,r,n){this.identity=e,this.labels=t,this.properties=r,this.elementId=_valueOrGetDefault(n,()=>e.toString())}toString(){let t="("+this.elementId;for(let e=0;e<this.labels.length;e++)t+=":"+this.labels[e];var r=Object.keys(this.properties);if(0<r.length){t+=" {";for(let e=0;e<r.length;e++)0<e&&(t+=","),t+=r[e]+":"+stringify(this.properties[r[e]]);t+="}"}return t+=")"}}function isNode(e){return hasIdentifierProperty(e,NODE_IDENTIFIER_PROPERTY)}Object.defineProperty(Node.prototype,NODE_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES);class Relationship{identity;start;end;type;properties;elementId;startNodeElementId;endNodeElementId;constructor(e,t,r,n,o,i,s,a){this.identity=e,this.start=t,this.end=r,this.type=n,this.properties=o,this.elementId=_valueOrGetDefault(i,()=>e.toString()),this.startNodeElementId=_valueOrGetDefault(s,()=>t.toString()),this.endNodeElementId=_valueOrGetDefault(a,()=>r.toString())}toString(){let t="("+this.startNodeElementId+")-[:"+this.type;var r=Object.keys(this.properties);if(0<r.length){t+=" {";for(let e=0;e<r.length;e++)0<e&&(t+=","),t+=r[e]+":"+stringify(this.properties[r[e]]);t+="}"}return t+="]->("+this.endNodeElementId+")"}}function isRelationship(e){return hasIdentifierProperty(e,RELATIONSHIP_IDENTIFIER_PROPERTY)}Object.defineProperty(Relationship.prototype,RELATIONSHIP_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES);class UnboundRelationship{identity;type;properties;elementId;constructor(e,t,r,n){this.identity=e,this.type=t,this.properties=r,this.elementId=_valueOrGetDefault(n,()=>e.toString())}bind(e,t){return new Relationship(this.identity,e,t,this.type,this.properties,this.elementId)}bindTo(e,t){return new Relationship(this.identity,e.identity,t.identity,this.type,this.properties,this.elementId,e.elementId,t.elementId)}toString(){let t="-[:"+this.type;var r=Object.keys(this.properties);if(0<r.length){t+=" {";for(let e=0;e<r.length;e++)0<e&&(t+=","),t+=r[e]+":"+stringify(this.properties[r[e]]);t+="}"}return t+="]->"}}function isUnboundRelationship(e){return hasIdentifierProperty(e,UNBOUND_RELATIONSHIP_IDENTIFIER_PROPERTY)}Object.defineProperty(UnboundRelationship.prototype,UNBOUND_RELATIONSHIP_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES);class PathSegment{start;relationship;end;constructor(e,t,r){this.start=e,this.relationship=t,this.end=r}}function isPathSegment(e){return hasIdentifierProperty(e,PATH_SEGMENT_IDENTIFIER_PROPERTY)}Object.defineProperty(PathSegment.prototype,PATH_SEGMENT_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES);class Path{start;end;segments;length;constructor(e,t,r){this.start=e,this.end=t,this.segments=r,this.length=r.length}}function isPath(e){return hasIdentifierProperty(e,PATH_IDENTIFIER_PROPERTY)}function _valueOrGetDefault(e,t){return null==e?t():e}function generateFieldLookup(e){const r={};return e.forEach((e,t)=>{r[e]=t}),r}Object.defineProperty(Path.prototype,PATH_IDENTIFIER_PROPERTY,IDENTIFIER_PROPERTY_ATTRIBUTES);class Record{keys;length;_fields;_fieldLookup;constructor(e,t,r){this.keys=e,this.length=e.length,this._fields=t,this._fieldLookup=r??generateFieldLookup(e)}forEach(e){for(var[t,r]of this.entries())e(r,t,this)}map(e){var t,r,n=[];for([t,r]of this.entries())n.push(e(r,t,this));return n}*entries(){for(let e=0;e<this.keys.length;e++)yield[this.keys[e],this._fields[e]]}*values(){for(let e=0;e<this.keys.length;e++)yield this._fields[e]}*[Symbol.iterator](){for(let e=0;e<this.keys.length;e++)yield this._fields[e]}toObject(){var e,t,r={};for([e,t]of this.entries())r[e]=t;return r}get(e){let t;if("number"!=typeof e){if(void 0===(t=this._fieldLookup[e]))throw newError(`This record has no field with key '${e.toString()}', available keys are: [`+this.keys.toString()+"].")}else t=e;if(t>this._fields.length-1||t<0)throw newError("This record has no field with index '"+t.toString()+"'. Remember that indexes start at `0`, and make sure your query returns records in the shape you meant it to.");return this._fields[t]}has(e){return"number"==typeof e?0<=e&&e<this._fields.length:void 0!==this._fieldLookup[e]}}const POINT_IDENTIFIER_PROPERTY="__isPoint__";class Point{srid;x;y;z;constructor(e,t,r,n){this.srid=assertNumberOrInteger(e,"SRID"),this.x=assertNumber(t,"X coordinate"),this.y=assertNumber(r,"Y coordinate"),this.z=null==n?n:assertNumber(n,"Z coordinate"),Object.freeze(this)}toString(){return null==this.z||isNaN(this.z)?`Point{srid=${formatAsFloat(this.srid)}, x=${formatAsFloat(this.x)}, y=${formatAsFloat(this.y)}}`:`Point{srid=${formatAsFloat(this.srid)}, x=${formatAsFloat(this.x)}, y=${formatAsFloat(this.y)}, z=${formatAsFloat(this.z)}}`}}function formatAsFloat(e){return Number.isInteger(e)?e.toString()+".0":e.toString()}function isPoint(e){return null!=e&&!0===e[POINT_IDENTIFIER_PROPERTY]}Object.defineProperty(Point.prototype,POINT_IDENTIFIER_PROPERTY,{value:!0,enumerable:!1,configurable:!1,writable:!1});class ResultSummary{query;queryType;counters;updateStatistics;plan;profile;notifications;server;resultConsumedAfter;resultAvailableAfter;database;constructor(e,t,r,n){this.query={text:e,parameters:t},this.queryType=r.type,this.counters=new QueryStatistics(r.stats??{}),this.updateStatistics=this.counters,this.plan=(null!=r.plan||null!=r.profile)&&new Plan(r.plan??r.profile),this.profile=null!=r.profile&&new ProfiledPlan(r.profile),this.notifications=this._buildNotifications(r.notifications),this.server=new ServerInfo(r.server,n),this.resultConsumedAfter=r.result_consumed_after,this.resultAvailableAfter=r.result_available_after,this.database={name:r.db??null}}_buildNotifications(e){return null==e?[]:e.map(function(e){return new Notification(e)})}hasPlan(){return this.plan instanceof Plan}hasProfile(){return this.profile instanceof ProfiledPlan}}class Plan{operatorType;identifiers;arguments;children;constructor(e){this.operatorType=e.operatorType,this.identifiers=e.identifiers,this.arguments=e.args,this.children=null!=e.children?e.children.map(e=>new Plan(e)):[]}}class ProfiledPlan{operatorType;identifiers;arguments;dbHits;rows;pageCacheMisses;pageCacheHits;pageCacheHitRatio;time;children;constructor(e){this.operatorType=e.operatorType,this.identifiers=e.identifiers,this.arguments=e.args,this.dbHits=valueOrDefault$1("dbHits",e),this.rows=valueOrDefault$1("rows",e),this.pageCacheMisses=valueOrDefault$1("pageCacheMisses",e),this.pageCacheHits=valueOrDefault$1("pageCacheHits",e),this.pageCacheHitRatio=valueOrDefault$1("pageCacheHitRatio",e),this.time=valueOrDefault$1("time",e),this.children=null!=e.children?e.children.map(e=>new ProfiledPlan(e)):[]}hasPageCacheStats(){return 0<this.pageCacheMisses||0<this.pageCacheHits||0<this.pageCacheHitRatio}}class Stats{nodesCreated;nodesDeleted;relationshipsCreated;relationshipsDeleted;propertiesSet;labelsAdded;labelsRemoved;indexesAdded;indexesRemoved;constraintsAdded;constraintsRemoved;constructor(){this.nodesCreated=0,this.nodesDeleted=0,this.relationshipsCreated=0,this.relationshipsDeleted=0,this.propertiesSet=0,this.labelsAdded=0,this.labelsRemoved=0,this.indexesAdded=0,this.indexesRemoved=0,this.constraintsAdded=0,this.constraintsRemoved=0}}class QueryStatistics{_stats;_systemUpdates;_containsSystemUpdates;_containsUpdates;constructor(r){this._stats={nodesCreated:0,nodesDeleted:0,relationshipsCreated:0,relationshipsDeleted:0,propertiesSet:0,labelsAdded:0,labelsRemoved:0,indexesAdded:0,indexesRemoved:0,constraintsAdded:0,constraintsRemoved:0},this._systemUpdates=0,Object.keys(r).forEach(e=>{var t=e.replace(/(-\w)/g,e=>e[1].toUpperCase());t in this._stats?this._stats[t]=intValue(r[e]):"systemUpdates"===t?this._systemUpdates=intValue(r[e]):"containsSystemUpdates"===t?this._containsSystemUpdates=r[e]:"containsUpdates"===t&&(this._containsUpdates=r[e])}),this._stats=Object.freeze(this._stats)}containsUpdates(){return void 0!==this._containsUpdates?this._containsUpdates:0<Object.keys(this._stats).reduce((e,t)=>e+this._stats[t],0)}updates(){return this._stats}containsSystemUpdates(){return void 0!==this._containsSystemUpdates?this._containsSystemUpdates:0<this._systemUpdates}systemUpdates(){return this._systemUpdates}}const notificationSeverityLevel={WARNING:"WARNING",INFORMATION:"INFORMATION",UNKNOWN:"UNKNOWN"},severityLevels=(Object.freeze(notificationSeverityLevel),Object.values(notificationSeverityLevel)),notificationCategory={HINT:"HINT",UNRECOGNIZED:"UNRECOGNIZED",UNSUPPORTED:"UNSUPPORTED",PERFORMANCE:"PERFORMANCE",DEPRECATION:"DEPRECATION",TOPOLOGY:"TOPOLOGY",SECURITY:"SECURITY",GENERIC:"GENERIC",UNKNOWN:"UNKNOWN"},categories=(Object.freeze(notificationCategory),Object.values(notificationCategory));class Notification{code;title;description;severity;position;severityLevel;category;rawSeverityLevel;rawCategory;constructor(e){this.code=e.code,this.title=e.title,this.description=e.description,this.severity=e.severity,this.position=Notification._constructPosition(e.position),this.severityLevel=severityLevels.includes(e.severity)?e.severity:notificationSeverityLevel.UNKNOWN,this.rawSeverityLevel=e.severity,this.category=categories.includes(e.category)?e.category:notificationCategory.UNKNOWN,this.rawCategory=e.category}static _constructPosition(e){return null==e?{}:{offset:intValue(e.offset),line:intValue(e.line),column:intValue(e.column)}}}class ServerInfo{address;protocolVersion;agent;constructor(e,t){null!=e&&(this.address=e.address,this.agent=e.version),this.protocolVersion=t}}function intValue(e){return e instanceof Integer?e.toNumber():"bigint"==typeof e?int(e).toNumber():e}function valueOrDefault$1(e,t,r=0){return!1!==t&&e in t?intValue(t[e]):r}const queryType={READ_ONLY:"r",READ_WRITE:"rw",WRITE_ONLY:"w",SCHEMA_WRITE:"s"},notificationFilterMinimumSeverityLevel={OFF:"OFF",WARNING:"WARNING",INFORMATION:"INFORMATION"},notificationFilterDisabledCategory=(Object.freeze(notificationFilterMinimumSeverityLevel),{HINT:"HINT",UNRECOGNIZED:"UNRECOGNIZED",UNSUPPORTED:"UNSUPPORTED",PERFORMANCE:"PERFORMANCE",TOPOLOGY:"TOPOLOGY",SECURITY:"SECURITY",DEPRECATION:"DEPRECATION",GENERIC:"GENERIC"});Object.freeze(notificationFilterDisabledCategory);class CompletedObserver$1{subscribe(e){apply(e,e.onKeys,[]),apply(e,e.onCompleted,{})}cancel(){}pause(){}resume(){}prepareToHandleSingleResponse(){}markCompleted(){}onError(e){throw new Error("CompletedObserver not supposed to call onError",{cause:e})}}class FailedObserver$1{_error;_beforeError;_observers;constructor({error:e,onError:t}){this._error=e,this._beforeError=t,this._observers=[],this.onError(e)}subscribe(e){apply(e,e.onError,this._error),this._observers.push(e)}onError(t){apply(this,this._beforeError,t),this._observers.forEach(e=>apply(e,e.onError,t))}cancel(){}pause(){}resume(){}markCompleted(){}prepareToHandleSingleResponse(){}}function apply(e,t,r){null!=t&&t.bind(e)(r)}var observers=Object.freeze({__proto__:null,CompletedObserver:CompletedObserver$1,FailedObserver:FailedObserver$1});const BOOKMARKS_KEY="bookmarks";class Bookmarks$6{_values;constructor(e){this._values=asStringArray(e)}static empty(){return EMPTY_BOOKMARK}isEmpty(){return 0===this._values.length}values(){return this._values}[Symbol.iterator](){return this._values[Symbol.iterator]()}asBeginTransactionParameters(){return this.isEmpty()?{}:{[BOOKMARKS_KEY]:this._values}}}const EMPTY_BOOKMARK=new Bookmarks$6(null);function asStringArray(e){if(null==e||""===e)return[];if(isString(e))return[e];if(Array.isArray(e)){var t=new Set,r=flattenArray(e);for(let e=0;e<r.length;e++){var n=r[e];if(null!=n){if(!isString(n))throw new TypeError(`Bookmark value should be a string, given: '${n}'`);t.add(n)}}return[...t]}throw new TypeError(`Bookmarks should either be a string or a string array, given: '${e}'`)}function flattenArray(e){return e.reduce((e,t)=>Array.isArray(t)?e.concat(flattenArray(t)):e.concat(t),[])}var bookmarks=Object.freeze({__proto__:null,Bookmarks:Bookmarks$6});const FETCH_ALL$5=-1,DEFAULT_POOL_ACQUISITION_TIMEOUT=6e4,DEFAULT_POOL_MAX_SIZE=100,DEFAULT_CONNECTION_TIMEOUT_MILLIS=3e4,ACCESS_MODE_READ$1="READ",ACCESS_MODE_WRITE$1="WRITE",BOLT_PROTOCOL_V1$1=1,BOLT_PROTOCOL_V2$1=2,BOLT_PROTOCOL_V3$3=3,BOLT_PROTOCOL_V4_0$3=4,BOLT_PROTOCOL_V4_1$1=4.1,BOLT_PROTOCOL_V4_2$1=4.2,BOLT_PROTOCOL_V4_3$1=4.3,BOLT_PROTOCOL_V4_4$3=4.4,BOLT_PROTOCOL_V5_0$1=5,BOLT_PROTOCOL_V5_1$3=5.1,BOLT_PROTOCOL_V5_2$1=5.2,BOLT_PROTOCOL_V5_3$1=5.3,BOLT_PROTOCOL_V5_4$1=5.4,TELEMETRY_APIS={MANAGED_TRANSACTION:0,UNMANAGED_TRANSACTION:1,AUTO_COMMIT_TRANSACTION:2,EXECUTE_QUERY:3};var constants=Object.freeze({__proto__:null,FETCH_ALL:FETCH_ALL$5,ACCESS_MODE_READ:ACCESS_MODE_READ$1,ACCESS_MODE_WRITE:ACCESS_MODE_WRITE$1,DEFAULT_CONNECTION_TIMEOUT_MILLIS:DEFAULT_CONNECTION_TIMEOUT_MILLIS,DEFAULT_POOL_ACQUISITION_TIMEOUT:DEFAULT_POOL_ACQUISITION_TIMEOUT,DEFAULT_POOL_MAX_SIZE:DEFAULT_POOL_MAX_SIZE,BOLT_PROTOCOL_V1:BOLT_PROTOCOL_V1$1,BOLT_PROTOCOL_V2:BOLT_PROTOCOL_V2$1,BOLT_PROTOCOL_V3:BOLT_PROTOCOL_V3$3,BOLT_PROTOCOL_V4_0:BOLT_PROTOCOL_V4_0$3,BOLT_PROTOCOL_V4_1:BOLT_PROTOCOL_V4_1$1,BOLT_PROTOCOL_V4_2:BOLT_PROTOCOL_V4_2$1,BOLT_PROTOCOL_V4_3:BOLT_PROTOCOL_V4_3$1,BOLT_PROTOCOL_V4_4:BOLT_PROTOCOL_V4_4$3,BOLT_PROTOCOL_V5_0:BOLT_PROTOCOL_V5_0$1,BOLT_PROTOCOL_V5_1:BOLT_PROTOCOL_V5_1$3,BOLT_PROTOCOL_V5_2:BOLT_PROTOCOL_V5_2$1,BOLT_PROTOCOL_V5_3:BOLT_PROTOCOL_V5_3$1,BOLT_PROTOCOL_V5_4:BOLT_PROTOCOL_V5_4$1,TELEMETRY_APIS:TELEMETRY_APIS});const ERROR="error",WARN="warn",INFO="info",DEBUG="debug",DEFAULT_LEVEL=INFO,levels={[ERROR]:0,[WARN]:1,[INFO]:2,[DEBUG]:3};class Logger$3{_level;_loggerFunction;constructor(e,t){this._level=e,this._loggerFunction=t}static create(e){var t;return null!=e?.logging?(t=extractConfiguredLevel(e=e.logging),e=extractConfiguredLogger(e),new Logger$3(t,e)):this.noOp()}static noOp(){return noOpLogger}isErrorEnabled(){return isLevelEnabled(this._level,ERROR)}error(e){this.isErrorEnabled()&&this._loggerFunction(ERROR,e)}isWarnEnabled(){return isLevelEnabled(this._level,WARN)}warn(e){this.isWarnEnabled()&&this._loggerFunction(WARN,e)}isInfoEnabled(){return isLevelEnabled(this._level,INFO)}info(e){this.isInfoEnabled()&&this._loggerFunction(INFO,e)}isDebugEnabled(){return isLevelEnabled(this._level,DEBUG)}debug(e){this.isDebugEnabled()&&this._loggerFunction(DEBUG,e)}}class NoOpLogger extends Logger$3{constructor(){super(INFO,(e,t)=>{})}isErrorEnabled(){return!1}error(e){}isWarnEnabled(){return!1}warn(e){}isInfoEnabled(){return!1}info(e){}isDebugEnabled(){return!1}debug(e){}}const noOpLogger=new NoOpLogger;function isLevelEnabled(e,t){return levels[e]>=levels[t]}function extractConfiguredLevel(e){if(null==e?.level)return DEFAULT_LEVEL;var e=e.level,t=levels[e];if(null==t&&0!==t)throw newError(`Illegal logging level: ${e}. Supported levels are: `+Object.keys(levels).toString());return e}function extractConfiguredLogger(e){if(null!=e?.logger){var t=e.logger;if(null!=t&&"function"==typeof t)return t}throw newError("Illegal logger function: "+(e?.logger?.toString()??"undefined"))}var logger=Object.freeze({__proto__:null,Logger:Logger$3});class ConnectionHolder{_mode;_database;_bookmarks;_connectionProvider;_referenceCount;_connectionPromise;_impersonatedUser;_getConnectionAcquistionBookmarks;_onDatabaseNameResolved;_auth;_log;_closed;constructor({mode:e,database:t="",bookmarks:r,connectionProvider:n,impersonatedUser:o,onDatabaseNameResolved:i,getConnectionAcquistionBookmarks:s,auth:a,log:u}){this._mode=e??ACCESS_MODE_WRITE$1,this._closed=!1,this._database=null!=t?assertString$1(t,"database"):"",this._bookmarks=r??Bookmarks$6.empty(),this._connectionProvider=n,this._impersonatedUser=o,this._referenceCount=0,this._connectionPromise=Promise.resolve(null),this._onDatabaseNameResolved=i,this._auth=a,this._log=u,this._logError=this._logError.bind(this),this._getConnectionAcquistionBookmarks=s??(()=>Promise.resolve(Bookmarks$6.empty()))}mode(){return this._mode}database(){return this._database}setDatabase(e){this._database=e}bookmarks(){return this._bookmarks}connectionProvider(){return this._connectionProvider}referenceCount(){return this._referenceCount}initializeConnection(){return 0!==this._referenceCount||null==this._connectionProvider?(this._referenceCount++,!1):(this._connectionPromise=this._createConnectionPromise(this._connectionProvider),this._referenceCount++,!0)}async _createConnectionPromise(e){return e.acquireConnection({accessMode:this._mode,database:this._database,bookmarks:await this._getBookmarks(),impersonatedUser:this._impersonatedUser,onDatabaseNameResolved:this._onDatabaseNameResolved,auth:this._auth})}async _getBookmarks(){return this._getConnectionAcquistionBookmarks()}getConnection(){return this._connectionPromise}releaseConnection(){return 0!==this._referenceCount&&(this._referenceCount--,0===this._referenceCount)?this._releaseConnection():this._connectionPromise}close(e){return this._closed=!0,0===this._referenceCount?this._connectionPromise:(this._referenceCount=0,this._releaseConnection(e))}log(){return this._log}_releaseConnection(t){return this._connectionPromise=this._connectionPromise.then(e=>null!=e?e.isOpen()&&(e.hasOngoingObservableRequests()||!0===t)?e.resetAndFlush().catch(ignoreError).then(()=>e.release().then(()=>null)):e.release().then(()=>null):Promise.resolve(null)).catch(this._logError),this._connectionPromise}_logError(e){return this._log.isWarnEnabled()&&this._log.warn(`ConnectionHolder got an error while releasing the connection. Error ${e}. Stacktrace: `+e.stack),null}}class ReadOnlyConnectionHolder extends ConnectionHolder{_connectionHolder;constructor(e){super({mode:e.mode(),database:e.database(),bookmarks:e.bookmarks(),getConnectionAcquistionBookmarks:e._getConnectionAcquistionBookmarks,connectionProvider:e.connectionProvider(),log:e.log()}),this._connectionHolder=e}initializeConnection(){return 0!==this._connectionHolder.referenceCount()}getConnection(){return this._connectionHolder.getConnection()}releaseConnection(){return this._connectionHolder.getConnection().catch(()=>Promise.resolve(null))}close(){return this._connectionHolder.getConnection().catch(()=>Promise.resolve(null))}}class EmptyConnectionHolder extends ConnectionHolder{constructor(){super({log:Logger$3.create({})})}mode(){}database(){}initializeConnection(){return!0}async getConnection(){return Promise.reject(newError("This connection holder does not serve connections"))}async releaseConnection(){return Promise.resolve(null)}async close(){return Promise.resolve(null)}}const EMPTY_CONNECTION_HOLDER$1=new EmptyConnectionHolder;function ignoreError(e){return null}var connectionHolder=Object.freeze({__proto__:null,default:ReadOnlyConnectionHolder,ConnectionHolder:ConnectionHolder,ReadOnlyConnectionHolder:ReadOnlyConnectionHolder,EMPTY_CONNECTION_HOLDER:EMPTY_CONNECTION_HOLDER$1});class TxConfig$3{timeout;metadata;constructor(e,t){assertValidConfig(e),this.timeout=extractTimeout(e,t),this.metadata=extractMetadata(e)}static empty(){return EMPTY_CONFIG}isEmpty(){return Object.values(this).every(e=>null==e)}}const EMPTY_CONFIG=new TxConfig$3({});function extractTimeout(e,t){if(isObject(e)&&null!=e.timeout){assertNumberOrInteger(e.timeout,"Transaction timeout"),isTimeoutFloat(e)&&!0===t?.isInfoEnabled()&&t?.info(`Transaction timeout expected to be an integer, got: ${e.timeout}. The value will be rounded up.`);t=int(e.timeout,{ceilFloat:!0});if(t.isNegative())throw newError("Transaction timeout should not be negative");return t}return null}function isTimeoutFloat(e){return"number"==typeof e.timeout&&!Number.isInteger(e.timeout)}function extractMetadata(e){if(isObject(e)&&null!=e.metadata){e=e.metadata;if(assertObject(e,"config.metadata"),0!==Object.keys(e).length)return e}return null}function assertValidConfig(e){null!=e&&assertObject(e,"Transaction config")}var txConfig=Object.freeze({__proto__:null,TxConfig:TxConfig$3});const DEFAULT_MAX_RETRY_TIME_MS=3e4,DEFAULT_INITIAL_RETRY_DELAY_MS=1e3,DEFAULT_RETRY_DELAY_MULTIPLIER=2,DEFAULT_RETRY_DELAY_JITTER_FACTOR=.2;function setTimeoutWrapper(e,t,...r){return setTimeout(e,t,...r)}function clearTimeoutWrapper(e){return clearTimeout(e)}class TransactionExecutor{_maxRetryTimeMs;_initialRetryDelayMs;_multiplier;_jitterFactor;_inFlightTimeoutIds;_setTimeout;_clearTimeout;telemetryApi;pipelineBegin;constructor(e,t,r,n,o={setTimeout:setTimeoutWrapper,clearTimeout:clearTimeoutWrapper}){this._maxRetryTimeMs=_valueOrDefault(e,DEFAULT_MAX_RETRY_TIME_MS),this._initialRetryDelayMs=_valueOrDefault(t,DEFAULT_INITIAL_RETRY_DELAY_MS),this._multiplier=_valueOrDefault(r,DEFAULT_RETRY_DELAY_MULTIPLIER),this._jitterFactor=_valueOrDefault(n,DEFAULT_RETRY_DELAY_JITTER_FACTOR),this._setTimeout=o.setTimeout,this._clearTimeout=o.clearTimeout,this._inFlightTimeoutIds=[],this.pipelineBegin=!1,this.telemetryApi=TELEMETRY_APIS.MANAGED_TRANSACTION,this._verifyAfterConstruction()}execute(n,o,i){const s={apiTransactionConfig:{api:this.telemetryApi,onTelemetrySuccess:()=>{s.apiTransactionConfig=void 0}}};return new Promise((e,t)=>{this._executeTransactionInsidePromise(n,o,e,t,i,s).catch(t)}).catch(e=>{var t=Date.now(),r=this._initialRetryDelayMs;return this._retryTransactionPromise(n,o,e,t,r,i,s)})}close(){this._inFlightTimeoutIds.forEach(e=>this._clearTimeout(e)),this._inFlightTimeoutIds=[]}_retryTransactionPromise(o,i,e,r,s,a,u){return Date.now()-r>this._maxRetryTimeMs||!isRetriableError(e)?Promise.reject(e):new Promise((e,t)=>{var r=this._computeDelayWithJitter(s);const n=this._setTimeout(()=>{this._inFlightTimeoutIds=this._inFlightTimeoutIds.filter(e=>e!==n),this._executeTransactionInsidePromise(o,i,e,t,a,u).catch(t)},r);this._inFlightTimeoutIds.push(n)}).catch(e=>{var t=s*this._multiplier;return this._retryTransactionPromise(o,i,e,r,t,a,u)})}async _executeTransactionInsidePromise(e,t,r,n,o,i){let s;try{var a=e(null!=i?.apiTransactionConfig?{...i?.apiTransactionConfig}:void 0);s=this.pipelineBegin?a:await a}catch(e){return void n(e)}e=(o??(e=>e))(s);this._safeExecuteTransactionWork(e,t).then(e=>this._handleTransactionWorkSuccess(e,s,r,n)).catch(e=>this._handleTransactionWorkFailure(e,s,n))}_safeExecuteTransactionWork(e,t){try{var r=t(e);return Promise.resolve(r)}catch(e){return Promise.reject(e)}}_handleTransactionWorkSuccess(e,t,r,n){t.isOpen()?t.commit().then(()=>{r(e)}).catch(e=>{n(e)}):r(e)}_handleTransactionWorkFailure(e,t,r){t.isOpen()?t.rollback().catch(e=>{}).then(()=>r(e)).catch(r):r(e)}_computeDelayWithJitter(e){var t=e*this._jitterFactor,r=e-t,e=e+t;return Math.random()*(e-r)+r}_verifyAfterConstruction(){if(this._maxRetryTimeMs<0)throw newError("Max retry time should be >= 0: "+this._maxRetryTimeMs.toString());if(this._initialRetryDelayMs<0)throw newError("Initial retry delay should >= 0: "+this._initialRetryDelayMs.toString());if(this._multiplier<1)throw newError("Multiplier should be >= 1.0: "+this._multiplier.toString());if(this._jitterFactor<0||1<this._jitterFactor)throw newError("Jitter factor should be in [0.0, 1.0]: "+this._jitterFactor.toFixed())}}function _valueOrDefault(e,t){return null!=e?e:t}var transactionExecutor=Object.freeze({__proto__:null,TransactionExecutor:TransactionExecutor});const DEFAULT_BOLT_PORT=7687,DEFAULT_HTTP_PORT=7474,DEFAULT_HTTPS_PORT=7473;class Url{scheme;host;port;hostAndPort;query;constructor(e,t,r,n,o){this.scheme=e,this.host=t,this.port=r,this.hostAndPort=n,this.query=o}}function parseDatabaseUrl(e){assertString$1(e,"URL");var t=sanitizeUrl(e),r=uriJsParse(t.url),t=t.schemeMissing?null:extractScheme(r.scheme),n=extractHost(r.host),o=formatHost(n),i=extractPort(r.port,t),o=o+":"+i,r=extractQuery(r.query??extractResourceQueryString(r.resourceName),e);return new Url(t,n,i,o,r)}function extractResourceQueryString(e){return"string"!=typeof e?null:([,e]=e.split("?"),e)}function sanitizeUrl(e){return(e=e.trim()).includes("://")?{schemeMissing:!1,url:e}:{schemeMissing:!0,url:"none://"+e}}function extractScheme(e){return null!=e?":"===(e=e.trim()).charAt(e.length-1)?e.substring(0,e.length-1):e:null}function extractHost(e,t){if(null==e)throw new Error("Unable to extract host from null or undefined URL");return e.trim()}function extractPort(e,t){e="string"==typeof e?parseInt(e,10):e;return null==e||isNaN(e)?defaultPortForScheme(t):e}function extractQuery(e,r){e=null!=e?trimAndSanitizeQuery(e):null;const n={};return null!=e&&e.split("&").forEach(e=>{e=e.split("=");if(2!==e.length)throw new Error(`Invalid parameters: '${e.toString()}' in URL '${r}'.`);var t=trimAndVerifyQueryElement(e[0],"key",r),e=trimAndVerifyQueryElement(e[1],"value",r);if(void 0!==n[t])throw new Error(`Duplicated query parameters with key '${t}' in URL '${r}'`);n[t]=e}),n}function trimAndSanitizeQuery(e){return e="?"===(e=(e??"").trim())?.charAt(0)?e.substring(1,e.length):e}function trimAndVerifyQueryElement(e,t,r){if(""===(e=(e??"").trim()))throw new Error(`Illegal empty ${t} in URL query '${r}'`);return e}function escapeIPv6Address(e){var t="["===e.charAt(0),r="]"===e.charAt(e.length-1);if(t||r){if(t&&r)return e;throw new Error("Illegal IPv6 address "+e)}return`[${e}]`}function formatHost(e){if(""===e||null==e)throw new Error("Illegal host "+e);return e.includes(":")?escapeIPv6Address(e):e}function formatIPv4Address(e,t){return e+":"+t}function formatIPv6Address(e,t){return escapeIPv6Address(e)+":"+t}function defaultPortForScheme(e){return"http"===e?DEFAULT_HTTP_PORT:"https"===e?DEFAULT_HTTPS_PORT:DEFAULT_BOLT_PORT}function uriJsParse(e){function s(e,t){t=e.indexOf(t);return 0<=t?[e.substring(0,t),e[t],e.substring(t+1)]:[e,"",""]}function t(e){var t={};let r;"@"===(r=(i="@",0<=(i=(o=e).lastIndexOf(i))?[o.substring(0,i),o[i],o.substring(i+1)]:["","",o]))[1]&&(t.userInfo=decodeURIComponent(r[0]),e=r[2]);i="]",o=s(o=e,n="[");var n,[o,i]=[(n=s(o[2],i))[0],n[2]];return""!==o?(t.host=o,r=s(i,":")):(r=s(e,":"),t.host=r[0]),":"===r[1]&&(t.port=r[2]),t}let r={};var n=s(e,":");return":"===n[1]&&(r.scheme=decodeURIComponent(n[0]),e=n[2]),"#"===(n=s(e,"#"))[1]&&(r.fragment=decodeURIComponent(n[2]),e=n[0]),"?"===(n=s(e,"?"))[1]&&(r.query=n[2],e=n[0]),e.startsWith("//")?(n=s(e.substr(2),"/"),(r={...r,...t(n[0])}).path=n[1]+n[2]):r.path=e,r}var urlUtil=Object.freeze({__proto__:null,parseDatabaseUrl:parseDatabaseUrl,defaultPortForScheme:defaultPortForScheme,formatIPv4Address:formatIPv4Address,formatIPv6Address:formatIPv6Address,Url:Url});class ServerAddress$1{_host;_resolved;_port;_hostPort;_stringValue;constructor(e,t,r,n){this._host=assertString$1(e,"host"),this._resolved=null!=t?assertString$1(t,"resolved"):null,this._port=assertNumber(r,"port"),this._hostPort=n,this._stringValue=null!=t?n+`(${t})`:""+n}host(){return this._host}resolvedHost(){return null!=this._resolved?this._resolved:this._host}port(){return this._port}resolveWith(e){return new ServerAddress$1(this._host,e,this._port,this._hostPort)}asHostPort(){return this._hostPort}asKey(){return this._hostPort}toString(){return this._stringValue}static fromUrl(e){e=parseDatabaseUrl(e);return new ServerAddress$1(e.host,null,e.port,e.hostAndPort)}}var serverAddress=Object.freeze({__proto__:null,ServerAddress:ServerAddress$1});class BaseHostNameResolver$1{resolve(){throw new Error("Abstract function")}_resolveToItself(e){return Promise.resolve([e])}}function resolveToSelf(e){return Promise.resolve([e])}class ConfiguredCustomResolver{_resolverFunction;constructor(e){this._resolverFunction=e??resolveToSelf}resolve(t){return new Promise(e=>e(this._resolverFunction(t.asHostPort()))).then(e=>{if(Array.isArray(e))return e.map(e=>ServerAddress$1.fromUrl(e));throw new TypeError("Configured resolver function should either return an array of addresses or a Promise resolved with an array of addresses.Each address is '<host>:<port>'. Got: "+e)})}}var index$8=Object.freeze({__proto__:null,BaseHostNameResolver:BaseHostNameResolver$1,ConfiguredCustomResolver:ConfiguredCustomResolver});function fromVersion(e,t=()=>({get userAgent(){}})){t=t();return{product:"neo4j-javascript/"+e,platform:null!=t.userAgent?t.userAgent.split("(")[1].split(")")[0]:void 0,languageDetails:t.userAgent||void 0}}var index$7=Object.freeze({__proto__:null,fromVersion:fromVersion}),internal=Object.freeze({__proto__:null,util:util,temporalUtil:temporalUtil,observer:observers,bookmarks:bookmarks,constants:constants,connectionHolder:connectionHolder,txConfig:txConfig,transactionExecutor:transactionExecutor,logger:logger,urlUtil:urlUtil,serverAddress:serverAddress,resolver:index$8,objectUtil:objectUtil$1,boltAgent:index$7});const EMPTY_CONNECTION_HOLDER=connectionHolder["EMPTY_CONNECTION_HOLDER"],DEFAULT_ON_ERROR=e=>{console.log("Uncaught error when processing result: "+e)},DEFAULT_ON_COMPLETED=e=>{},DEFAULT_ON_KEYS=e=>{};class Result{_stack;_streamObserverPromise;_p;_query;_parameters;_connectionHolder;_keys;_summary;_error;_watermarks;constructor(e,t,r,n,o={high:Number.MAX_VALUE,low:Number.MAX_VALUE}){this._stack=captureStacktrace(),this._streamObserverPromise=e,this._p=null,this._query=t,this._parameters=r??{},this._connectionHolder=n??EMPTY_CONNECTION_HOLDER,this._keys=null,this._summary=null,this._error=null,this._watermarks=o}keys(){return null!==this._keys?Promise.resolve(this._keys):null!==this._error?Promise.reject(this._error):new Promise((t,r)=>{this._streamObserverPromise.then(e=>e.subscribe(this._decorateObserver({onKeys:e=>t(e),onError:e=>r(e)}))).catch(r)})}summary(){return null!==this._summary?Promise.resolve(this._summary):null!==this._error?Promise.reject(this._error):new Promise((t,r)=>{this._streamObserverPromise.then(e=>{e.cancel(),e.subscribe(this._decorateObserver({onCompleted:e=>t(e),onError:e=>r(e)}))}).catch(r)})}_getOrCreatePromise(){return null==this._p&&(this._p=new Promise((t,r)=>{const n=[];this.subscribe({onNext:e=>{n.push(e)},onCompleted:e=>{t({records:n,summary:e})},onError:e=>{r(e)}})})),this._p}[Symbol.asyncIterator](){if(!this.isOpen()){const t=newError("Result is already consumed");return{next:()=>Promise.reject(t),peek:()=>Promise.reject(t)}}const r={paused:!0,firstRun:!0,finished:!1},e=()=>{var e,t;null!=r.streaming&&(e=(t=r.queuedObserver?.size??0)>=this._watermarks.high,t=t<=this._watermarks.low,e&&!r.paused?(r.paused=!0,r.streaming.pause()):(t&&r.paused||r.firstRun&&!e)&&(r.firstRun=!1,r.paused=!1,r.streaming.resume()))},n=async()=>(void 0===r.queuedObserver&&(r.queuedObserver=this._createQueuedResultObserver(e),r.streaming=await this._subscribe(r.queuedObserver,!0).catch(()=>{}),e()),r.queuedObserver),o=e=>{if(void 0===e)throw newError("InvalidState: Result stream finished without Summary",PROTOCOL_ERROR$6);return!0};return{next:async()=>{var e;return r.finished&&o(r.summary)?{done:!0,value:r.summary}:(!0===(e=await(await n()).dequeue()).done&&(r.finished=e.done,r.summary=e.value),e)},return:async e=>{if(r.finished&&o(r.summary))return{done:!0,value:e??r.summary};r.streaming?.cancel();var t=await(await n()).dequeueUntilDone();return r.finished=!0,t.value=e??t.value,r.summary=t.value,t},peek:async()=>{return r.finished&&o(r.summary)?{done:!0,value:r.summary}:(await n()).head()}}}then(e,t){return this._getOrCreatePromise().then(e,t)}catch(e){return this._getOrCreatePromise().catch(e)}[Symbol.toStringTag]="Result";finally(e){return this._getOrCreatePromise().finally(e)}subscribe(e){this._subscribe(e).catch(()=>{})}isOpen(){return null===this._summary&&null===this._error}_subscribe(e,t=!1){const r=this._decorateObserver(e);return this._streamObserverPromise.then(e=>(t&&e.pause(),e.subscribe(r),e)).catch(e=>(null!=r.onError&&r.onError(e),Promise.reject(e)))}_decorateObserver(t){const r=t.onCompleted??DEFAULT_ON_COMPLETED,n=t.onError??DEFAULT_ON_ERROR,o=t.onKeys??DEFAULT_ON_KEYS;return{onNext:null!=t.onNext?t.onNext.bind(t):void 0,onKeys:e=>(this._keys=e,o.call(t,e)),onCompleted:e=>{this._releaseConnectionAndGetSummary(e).then(e=>null!==this._summary?r.call(t,this._summary):(this._summary=e,r.call(t,e))).catch(n)},onError:e=>{this._connectionHolder.releaseConnection().then(()=>{replaceStacktrace(e,this._stack),this._error=e,n.call(t,e)}).catch(n)}}}_cancel(){null===this._summary&&null===this._error&&this._streamObserverPromise.then(e=>e.cancel()).catch(()=>{})}_releaseConnectionAndGetSummary(t){const{validatedQuery:r,params:n}=validateQueryAndParameters(this._query,this._parameters,{skipAsserts:!0}),o=this._connectionHolder;return o.getConnection().then(e=>o.releaseConnection().then(()=>e?.getProtocolVersion()),e=>{}).then(e=>new ResultSummary(r,n,t,e))}_createQueuedResultObserver(r){function n(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}function o(e){return e instanceof Error}async function t(){if(0<i.length){var e=i.shift()??newError("Unexpected empty buffer",PROTOCOL_ERROR$6);if(r(),o(e))throw e;return e}return s.resolvable=n(),s.resolvable.promise}const i=[],s={resolvable:null},a={onNext:e=>{a._push({done:!1,value:e})},onCompleted:e=>{a._push({done:!0,value:e})},onError:e=>{a._push(e)},_push(e){var t;null!==s.resolvable?(t=s.resolvable,s.resolvable=null,o(e)?t.reject(e):t.resolve(e)):(i.push(e),r())},dequeue:t,dequeueUntilDone:async()=>{for(;;){var e=await t();if(!0===e.done)return e}},head:async()=>{if(0<i.length){var e=i[0];if(o(e))throw e;return e}s.resolvable=n();try{var t=await s.resolvable.promise;return i.unshift(t),t}catch(e){throw i.unshift(e),e}finally{r()}},get size(){return i.length}};return a}}function captureStacktrace(){var e=new Error("");return null!=e.stack?e.stack.replace(/^Error(\n\r)*/,""):null}function replaceStacktrace(e,t){null!=t&&(e.stack=e.toString()+"\n"+t)}class EagerResult{keys;records;summary;constructor(e,t,r){this.keys=e,this.records=t,this.summary=r}}class ConnectionProvider{acquireConnection(e){throw Error("Not implemented")}supportsMultiDb(){throw Error("Not implemented")}supportsTransactionConfig(){throw Error("Not implemented")}supportsUserImpersonation(){throw Error("Not implemented")}supportsSessionAuth(){throw Error("Not implemented")}verifyConnectivityAndGetServerInfo(e){throw Error("Not implemented")}verifyAuthentication(e){throw Error("Not implemented")}getNegotiatedProtocolVersion(){throw Error("Not Implemented")}close(){throw Error("Not implemented")}}class Connection$1{beginTransaction(e){throw new Error("Not implemented")}run(e,t,r){throw new Error("Not implemented")}commitTransaction(e){throw new Error("Not implemented")}rollbackTransaction(e){throw new Error("Not implemented")}resetAndFlush(){throw new Error("Not implemented")}isOpen(){throw new Error("Not implemented")}getProtocolVersion(){throw new Error("Not implemented")}hasOngoingObservableRequests(){throw new Error("Not implemented")}}class Transaction{_connectionHolder;_reactive;_state;_onClose;_onBookmarks;_onConnection;_onError;_onComplete;_fetchSize;_results;_impersonatedUser;_lowRecordWatermak;_highRecordWatermark;_bookmarks;_activePromise;_acceptActive;_notificationFilter;_apiTelemetryConfig;constructor({connectionHolder:e,onClose:t,onBookmarks:r,onConnection:n,reactive:o,fetchSize:i,impersonatedUser:s,highRecordWatermark:a,lowRecordWatermark:u,notificationFilter:l,apiTelemetryConfig:c}){this._connectionHolder=e,this._reactive=o,this._state=_states$1.ACTIVE,this._onClose=t,this._onBookmarks=r,this._onConnection=n,this._onError=this._onErrorCallback.bind(this),this._fetchSize=i,this._onComplete=this._onCompleteCallback.bind(this),this._results=[],this._impersonatedUser=s,this._lowRecordWatermak=u,this._highRecordWatermark=a,this._bookmarks=Bookmarks$6.empty(),this._notificationFilter=l,this._apiTelemetryConfig=c,this._acceptActive=()=>{},this._activePromise=new Promise((e,t)=>{this._acceptActive=e})}_begin(t,r,n){this._connectionHolder.getConnection().then(async e=>{if(this._onConnection(),null!=e)return this._bookmarks=await t(),e.beginTransaction({bookmarks:this._bookmarks,txConfig:r,mode:this._connectionHolder.mode(),database:this._connectionHolder.database(),impersonatedUser:this._impersonatedUser,notificationFilter:this._notificationFilter,apiTelemetryConfig:this._apiTelemetryConfig,beforeError:e=>{null!=n&&n.onError(e),this._onError(e).catch(()=>{})},afterComplete:e=>{null!=n&&n.onComplete(e),this._onComplete(e)}});throw newError("No connection available")}).catch(e=>{null!=n&&n.onError(e),this._onError(e).catch(()=>{})}).finally(()=>this._acceptActive())}run(e,t){var{validatedQuery:e,params:t}=validateQueryAndParameters(e,t),e=this._state.run(e,t,{connectionHolder:this._connectionHolder,onError:this._onError,onComplete:this._onComplete,onConnection:this._onConnection,reactive:this._reactive,fetchSize:this._fetchSize,highRecordWatermark:this._highRecordWatermark,lowRecordWatermark:this._lowRecordWatermak,preparationJob:this._activePromise});return this._results.push(e),e}commit(){const r=this._state.commit({connectionHolder:this._connectionHolder,onError:this._onError,onComplete:e=>this._onCompleteCallback(e,this._bookmarks),onConnection:this._onConnection,pendingResults:this._results,preparationJob:this._activePromise});return this._state=r.state,this._onClose(),new Promise((e,t)=>{r.result.subscribe({onCompleted:()=>e(),onError:e=>t(e)})})}rollback(){const r=this._state.rollback({connectionHolder:this._connectionHolder,onError:this._onError,onComplete:this._onComplete,onConnection:this._onConnection,pendingResults:this._results,preparationJob:this._activePromise});return this._state=r.state,this._onClose(),new Promise((e,t)=>{r.result.subscribe({onCompleted:()=>e(),onError:e=>t(e)})})}isOpen(){return this._state===_states$1.ACTIVE}async close(){this.isOpen()&&await this.rollback()}[Symbol.asyncDispose](){return this.close()}_onErrorCallback(t){return this._state=_states$1.FAILED,this._onClose(),this._results.forEach(e=>{e.isOpen()&&e._streamObserverPromise.then(e=>e.onError(t)).catch(e=>{})}),this._connectionHolder.releaseConnection()}_onCompleteCallback(e,t){this._onBookmarks(new Bookmarks$6(e?.bookmark),t??Bookmarks$6.empty(),e?.db)}}const _states$1={ACTIVE:{commit:({connectionHolder:e,onError:t,onComplete:r,onConnection:n,pendingResults:o,preparationJob:i})=>({result:finishTransaction(!0,e,t,r,n,o,i),state:_states$1.SUCCEEDED}),rollback:({connectionHolder:e,onError:t,onComplete:r,onConnection:n,pendingResults:o,preparationJob:i})=>({result:finishTransaction(!1,e,t,r,n,o,i),state:_states$1.ROLLED_BACK}),run:(t,r,{connectionHolder:e,onError:n,onComplete:o,onConnection:i,reactive:s,fetchSize:a,highRecordWatermark:u,lowRecordWatermark:l,preparationJob:c})=>{const h=c??Promise.resolve();return newCompletedResult(e.getConnection().then(e=>h.then(()=>e)).then(e=>{if(i(),null!=e)return e.run(t,r,{bookmarks:Bookmarks$6.empty(),txConfig:TxConfig$3.empty(),beforeError:n,afterComplete:o,reactive:s,fetchSize:a,highRecordWatermark:u,lowRecordWatermark:l});throw newError("No connection available")}).catch(e=>new FailedObserver$1({error:e,onError:n})),t,r,e,u,l)}},FAILED:{commit:({connectionHolder:e,onError:t})=>({result:newCompletedResult(new FailedObserver$1({error:newError("Cannot commit this transaction, because it has been rolled back either because of an error or explicit termination."),onError:t}),"COMMIT",{},e,0,0),state:_states$1.FAILED}),rollback:({connectionHolder:e})=>({result:newCompletedResult(new CompletedObserver$1,"ROLLBACK",{},e,0,0),state:_states$1.FAILED}),run:(e,t,{connectionHolder:r,onError:n})=>newCompletedResult(new FailedObserver$1({error:newError("Cannot run query in this transaction, because it has been rolled back either because of an error or explicit termination."),onError:n}),e,t,r,0,0)},SUCCEEDED:{commit:({connectionHolder:e,onError:t})=>({result:newCompletedResult(new FailedObserver$1({error:newError("Cannot commit this transaction, because it has already been committed."),onError:t}),"COMMIT",{},EMPTY_CONNECTION_HOLDER$1,0,0),state:_states$1.SUCCEEDED,connectionHolder:e}),rollback:({connectionHolder:e,onError:t})=>({result:newCompletedResult(new FailedObserver$1({error:newError("Cannot rollback this transaction, because it has already been committed."),onError:t}),"ROLLBACK",{},EMPTY_CONNECTION_HOLDER$1,0,0),state:_states$1.SUCCEEDED,connectionHolder:e}),run:(e,t,{connectionHolder:r,onError:n})=>newCompletedResult(new FailedObserver$1({error:newError("Cannot run query in this transaction, because it has already been committed."),onError:n}),e,t,r,0,0)},ROLLED_BACK:{commit:({connectionHolder:e,onError:t})=>({result:newCompletedResult(new FailedObserver$1({error:newError("Cannot commit this transaction, because it has already been rolled back."),onError:t}),"COMMIT",{},e,0,0),state:_states$1.ROLLED_BACK}),rollback:({connectionHolder:e})=>({result:newCompletedResult(new FailedObserver$1({error:newError("Cannot rollback this transaction, because it has already been rolled back.")}),"ROLLBACK",{},e,0,0),state:_states$1.ROLLED_BACK}),run:(e,t,{connectionHolder:r,onError:n})=>newCompletedResult(new FailedObserver$1({error:newError("Cannot run query in this transaction, because it has already been rolled back."),onError:n}),e,t,r,0,0)}};function finishTransaction(r,e,n,o,i,s,t){const a=t??Promise.resolve();t=e.getConnection().then(e=>a.then(()=>e)).then(t=>(i(),s.forEach(e=>e._cancel()),Promise.all(s.map(e=>e.summary())).then(e=>{if(null!=t)return r?t.commitTransaction({beforeError:n,afterComplete:o}):t.rollbackTransaction({beforeError:n,afterComplete:o});throw newError("No connection available")}))).catch(e=>new FailedObserver$1({error:e,onError:n}));return new Result(t,r?"COMMIT":"ROLLBACK",{},e,{high:Number.MAX_VALUE,low:Number.MAX_VALUE})}function newCompletedResult(e,t,r,n=EMPTY_CONNECTION_HOLDER$1,o,i){return new Result(Promise.resolve(e),t,r,new ReadOnlyConnectionHolder(n??EMPTY_CONNECTION_HOLDER$1),{low:i,high:o})}class ManagedTransaction{_run;constructor({run:e}){this._run=e}static fromTransaction(e){return new ManagedTransaction({run:e.run.bind(e)})}run(e,t){return this._run(e,t)}}class TransactionPromise extends Transaction{[Symbol.toStringTag]="TransactionPromise";_beginError;_beginMetadata;_beginPromise;_reject;_resolve;constructor({connectionHolder:e,onClose:t,onBookmarks:r,onConnection:n,reactive:o,fetchSize:i,impersonatedUser:s,highRecordWatermark:a,lowRecordWatermark:u,notificationFilter:l,apiTelemetryConfig:c}){super({connectionHolder:e,onClose:t,onBookmarks:r,onConnection:n,reactive:o,fetchSize:i,impersonatedUser:s,highRecordWatermark:a,lowRecordWatermark:u,notificationFilter:l,apiTelemetryConfig:c})}then(e,t){return this._getOrCreateBeginPromise().then(e,t)}catch(e){return this._getOrCreateBeginPromise().catch(e)}finally(e){return this._getOrCreateBeginPromise().finally(e)}_getOrCreateBeginPromise(){return null==this._beginPromise&&(this._beginPromise=new Promise((e,t)=>{this._resolve=e,this._reject=t,null!=this._beginError&&t(this._beginError),null!=this._beginMetadata&&e(this._toTransaction())})),this._beginPromise}_toTransaction(){return{...this,run:super.run.bind(this),commit:super.commit.bind(this),rollback:super.rollback.bind(this),close:super.close.bind(this),isOpen:super.isOpen.bind(this),_begin:this._begin.bind(this)}}_begin(e,t){return super._begin(e,t,{onError:this._onBeginError.bind(this),onComplete:this._onBeginMetadata.bind(this)})}_onBeginError(e){this._beginError=e,null!=this._reject&&this._reject(e)}_onBeginMetadata(e){this._beginMetadata=e??{},null!=this._resolve&&this._resolve(this._toTransaction())}}class Session{_mode;_database;_reactive;_fetchSize;_readConnectionHolder;_writeConnectionHolder;_open;_hasTx;_lastBookmarks;_configuredBookmarks;_transactionExecutor;_impersonatedUser;_databaseNameResolved;_lowRecordWatermark;_highRecordWatermark;_results;_bookmarkManager;_notificationFilter;_log;constructor({mode:e,connectionProvider:t,bookmarks:r,database:n,config:o,reactive:i,fetchSize:s,impersonatedUser:a,bookmarkManager:u,notificationFilter:l,auth:c,log:h}){this._mode=e,this._database=n,this._reactive=i,this._fetchSize=s,this._onDatabaseNameResolved=this._onDatabaseNameResolved.bind(this),this._getConnectionAcquistionBookmarks=this._getConnectionAcquistionBookmarks.bind(this),this._readConnectionHolder=new ConnectionHolder({mode:ACCESS_MODE_READ$1,auth:c,database:n,bookmarks:r,connectionProvider:t,impersonatedUser:a,onDatabaseNameResolved:this._onDatabaseNameResolved,getConnectionAcquistionBookmarks:this._getConnectionAcquistionBookmarks,log:h}),this._writeConnectionHolder=new ConnectionHolder({mode:ACCESS_MODE_WRITE$1,auth:c,database:n,bookmarks:r,connectionProvider:t,impersonatedUser:a,onDatabaseNameResolved:this._onDatabaseNameResolved,getConnectionAcquistionBookmarks:this._getConnectionAcquistionBookmarks,log:h}),this._open=!0,this._hasTx=!1,this._impersonatedUser=a,this._lastBookmarks=r??Bookmarks$6.empty(),this._configuredBookmarks=this._lastBookmarks,this._transactionExecutor=_createTransactionExecutor(o),this._databaseNameResolved=""!==this._database;e=this._calculateWatermaks();this._lowRecordWatermark=e.low,this._highRecordWatermark=e.high,this._results=[],this._bookmarkManager=u,this._notificationFilter=l,this._log=h}run(e,t,r){const{validatedQuery:n,params:o}=validateQueryAndParameters(e,t),i=null!=r?new TxConfig$3(r,this._log):TxConfig$3.empty();e=this._run(n,o,async e=>{const t=await this._bookmarks();return this._assertSessionIsOpen(),e.run(n,o,{bookmarks:t,txConfig:i,mode:this._mode,database:this._database,apiTelemetryConfig:{api:TELEMETRY_APIS.AUTO_COMMIT_TRANSACTION},impersonatedUser:this._impersonatedUser,afterComplete:e=>this._onCompleteCallback(e,t),reactive:this._reactive,fetchSize:this._fetchSize,lowRecordWatermark:this._lowRecordWatermark,highRecordWatermark:this._highRecordWatermark,notificationFilter:this._notificationFilter})});return this._results.push(e),e}_run(e,t,r){var{connectionHolder:r,resultPromise:n}=this._acquireAndConsumeConnection(r),n=n.catch(e=>Promise.resolve(new FailedObserver$1({error:e}))),o={high:this._highRecordWatermark,low:this._lowRecordWatermark};return new Result(n,e,t,r,o)}_acquireConnection(e){const{connectionHolder:t,resultPromise:r}=this._acquireAndConsumeConnection(e);return r.then(async e=>(await t.releaseConnection(),e))}_acquireAndConsumeConnection(t){let e;var r=this._connectionHolderWithMode(this._mode);return e=this._open?!this._hasTx&&r.initializeConnection()?r.getConnection().then(e=>t(e)):Promise.reject(newError("Queries cannot be run directly on a session with an open transaction; either run from within the transaction or use a different session.")):Promise.reject(newError("Cannot run query in a closed session.")),{connectionHolder:r,resultPromise:e}}beginTransaction(e){let t=TxConfig$3.empty();return null!=e&&(t=new TxConfig$3(e,this._log)),this._beginTransaction(this._mode,t,{api:TELEMETRY_APIS.UNMANAGED_TRANSACTION})}_beginTransaction(e,t,r){if(!this._open)throw newError("Cannot begin a transaction on a closed session.");if(this._hasTx)throw newError("You cannot begin a transaction on a session with an open transaction; either run from within the transaction or use a different session.");e=Session._validateSessionMode(e),e=this._connectionHolderWithMode(e),e.initializeConnection(),this._hasTx=!0,e=new TransactionPromise({connectionHolder:e,impersonatedUser:this._impersonatedUser,onClose:this._transactionClosed.bind(this),onBookmarks:(e,t,r)=>this._updateBookmarks(e,t,r),onConnection:this._assertSessionIsOpen.bind(this),reactive:this._reactive,fetchSize:this._fetchSize,lowRecordWatermark:this._lowRecordWatermark,highRecordWatermark:this._highRecordWatermark,notificationFilter:this._notificationFilter,apiTelemetryConfig:r});return e._begin(()=>this._bookmarks(),t),e}_assertSessionIsOpen(){if(!this._open)throw newError("You cannot run more transactions on a closed session.")}_transactionClosed(){this._hasTx=!1}lastBookmark(){return this.lastBookmarks()}lastBookmarks(){return this._lastBookmarks.values()}async _bookmarks(){var e=await this._bookmarkManager?.getBookmarks();return void 0===e?this._lastBookmarks:new Bookmarks$6([...e,...this._configuredBookmarks])}readTransaction(e,t){t=new TxConfig$3(t,this._log);return this._runTransaction(ACCESS_MODE_READ$1,t,e)}writeTransaction(e,t){t=new TxConfig$3(t,this._log);return this._runTransaction(ACCESS_MODE_WRITE$1,t,e)}_runTransaction(t,r,e){return this._transactionExecutor.execute(e=>this._beginTransaction(t,r,e),e)}executeRead(e,t){t=new TxConfig$3(t,this._log);return this._executeInTransaction(ACCESS_MODE_READ$1,t,e)}executeWrite(e,t){t=new TxConfig$3(t,this._log);return this._executeInTransaction(ACCESS_MODE_WRITE$1,t,e)}_executeInTransaction(t,r,e){return this._transactionExecutor.execute(e=>this._beginTransaction(t,r,e),e,ManagedTransaction.fromTransaction)}_onDatabaseNameResolved(e){this._databaseNameResolved||(this._database=e=e??"",this._readConnectionHolder.setDatabase(e),this._writeConnectionHolder.setDatabase(e),this._databaseNameResolved=!0)}async _getConnectionAcquistionBookmarks(){var e=await this._bookmarkManager?.getBookmarks();return void 0===e?this._lastBookmarks:new Bookmarks$6([...this._configuredBookmarks,...e])}_updateBookmarks(e,t,r){null==e||e.isEmpty()||(this._bookmarkManager?.updateBookmarks(t?.values()??[],e?.values()??[]).catch(()=>{}),this._lastBookmarks=e,this._configuredBookmarks=Bookmarks$6.empty())}async close(){this._open&&(this._open=!1,this._results.forEach(e=>e._cancel()),this._transactionExecutor.close(),await this._readConnectionHolder.close(this._hasTx),await this._writeConnectionHolder.close(this._hasTx))}[Symbol.asyncDispose](){return this.close()}_connectionHolderWithMode(e){if(e===ACCESS_MODE_READ$1)return this._readConnectionHolder;if(e===ACCESS_MODE_WRITE$1)return this._writeConnectionHolder;throw newError("Unknown access mode: "+e)}_onCompleteCallback(e,t){this._updateBookmarks(new Bookmarks$6(e.bookmark),t,e.db)}_calculateWatermaks(){return this._fetchSize===FETCH_ALL$5?{low:Number.MAX_VALUE,high:Number.MAX_VALUE}:{low:.3*this._fetchSize,high:.7*this._fetchSize}}_configureTransactionExecutor(e,t){this._transactionExecutor.pipelineBegin=e,this._transactionExecutor.telemetryApi=t}static _validateSessionMode(e){e=e??ACCESS_MODE_WRITE$1;if(e!==ACCESS_MODE_READ$1&&e!==ACCESS_MODE_WRITE$1)throw newError("Illegal session mode "+e);return e}}function _createTransactionExecutor(e){e=e?.maxTransactionRetryTime??null;return new TransactionExecutor(e)}function bookmarkManager(e={}){var t=new Set(e.initialBookmarks);return new Neo4jBookmarkManager(t,e.bookmarksSupplier,e.bookmarksConsumer)}class Neo4jBookmarkManager{_bookmarks;_bookmarksSupplier;_bookmarksConsumer;constructor(e,t,r){this._bookmarks=e,this._bookmarksSupplier=t,this._bookmarksConsumer=r}async updateBookmarks(e,t){var r=this._bookmarks;for(const n of e)r.delete(n);for(const o of t)r.add(o);"function"==typeof this._bookmarksConsumer&&await this._bookmarksConsumer([...r])}async getBookmarks(){var e=new Set(this._bookmarks);if("function"==typeof this._bookmarksSupplier)for(const t of await this._bookmarksSupplier()??[])e.add(t);return[...e]}}async function createEagerResultFromResult(e){var{summary:t,records:r}=await e,e=await e.keys();return new EagerResult(e,r,t)}class ResultTransformers{eagerResultTransformer(){return createEagerResultFromResult}mappedResultTransformer(o){if(null==o||null==o.collect&&null==o.map)throw newError("Requires a map or/and a collect functions.");return async e=>new Promise((t,r)=>{const n={records:[],keys:[]};e.subscribe({onKeys(e){n.keys=e},onNext(e){var t;null!=o.map?void 0!==(t=o.map(e))&&n.records.push(t):n.records.push(e)},onCompleted(e){null!=o.collect?t(o.collect(n.records,e,n.keys)):(e={records:n.records,summary:e,keys:n.keys},t(e))},onError(e){r(e)}})})}}const resultTransformers=new ResultTransformers;Object.freeze(resultTransformers);class QueryExecutor{_createSession;constructor(e){this._createSession=e}async execute(t,r,n){var e=this._createSession({database:t.database,bookmarkManager:t.bookmarkManager,impersonatedUser:t.impersonatedUser});e._configureTransactionExecutor(!0,TELEMETRY_APIS.EXECUTE_QUERY);try{return await("READ"===t.routing?e.executeRead:e.executeWrite).bind(e)(async e=>{e=e.run(r,n);return t.resultTransformer(e)},t.transactionConfig)}finally{await e.close()}}}const DEFAULT_MAX_CONNECTION_LIFETIME=36e5,DEFAULT_FETCH_SIZE=1e3,READ$2=ACCESS_MODE_READ$1,WRITE$2=ACCESS_MODE_WRITE$1;let idGenerator$1=0;class SessionConfig{defaultAccessMode;bookmarks;database;impersonatedUser;fetchSize;bookmarkManager;notificationFilter;auth;constructor(){this.defaultAccessMode=WRITE$2,this.bookmarks=[],this.database="",this.impersonatedUser=void 0,this.auth=void 0,this.fetchSize=void 0,this.bookmarkManager=void 0,this.notificationFilter=void 0}}const ROUTING_WRITE="WRITE",ROUTING_READ="READ",routing={WRITE:ROUTING_WRITE,READ:ROUTING_READ};Object.freeze(routing);class QueryConfig{routing;database;impersonatedUser;bookmarkManager;resultTransformer;transactionConfig;constructor(){this.routing=routing.WRITE,this.resultTransformer=void 0,this.database="",this.impersonatedUser=void 0,this.bookmarkManager=void 0,this.transactionConfig=void 0}}class Driver{_id;_meta;_config;_log;_createConnectionProvider;_connectionProvider;_createSession;_defaultExecuteQueryBookmarkManager;_queryExecutor;constructor(e,t={},r,n=e=>new Session(e),o=e=>new QueryExecutor(e)){sanitizeConfig(t);var i=Logger$3.create(t);validateConfig(t,i),this._id=idGenerator$1++,this._meta=e,this._config=t,this._log=i,this._createConnectionProvider=r,this._createSession=n,this._defaultExecuteQueryBookmarkManager=bookmarkManager(),this._queryExecutor=o(this.session.bind(this)),this._connectionProvider=null,this._afterConstruction()}get executeQueryBookmarkManager(){return this._defaultExecuteQueryBookmarkManager}async executeQuery(e,t,r={}){var n=null===r.bookmarkManager?void 0:r.bookmarkManager??this.executeQueryBookmarkManager,o=r.resultTransformer??resultTransformers.eagerResultTransformer(),i=r.routing??routing.WRITE;if(i!==routing.READ&&i!==routing.WRITE)throw newError(`Illegal query routing config: "${i}"`);return this._queryExecutor.execute({resultTransformer:o,bookmarkManager:n,routing:i,database:r.database,impersonatedUser:r.impersonatedUser,transactionConfig:r.transactionConfig},e,t)}verifyConnectivity({database:e=""}={}){return this._getOrCreateConnectionProvider().verifyConnectivityAndGetServerInfo({database:e,accessMode:READ$2})}async verifyAuthentication({database:e,auth:t}={}){return this._getOrCreateConnectionProvider().verifyAuthentication({database:e??"system",auth:t,accessMode:READ$2})}getServerInfo({database:e=""}={}){return this._getOrCreateConnectionProvider().verifyConnectivityAndGetServerInfo({database:e,accessMode:READ$2})}supportsMultiDb(){return this._getOrCreateConnectionProvider().supportsMultiDb()}supportsTransactionConfig(){return this._getOrCreateConnectionProvider().supportsTransactionConfig()}supportsUserImpersonation(){return this._getOrCreateConnectionProvider().supportsUserImpersonation()}supportsSessionAuth(){return this._getOrCreateConnectionProvider().supportsSessionAuth()}getNegotiatedProtocolVersion(){return this._getOrCreateConnectionProvider().getNegotiatedProtocolVersion()}isEncrypted(){return this._isEncrypted()}_supportsRouting(){return this._meta.routing}_isEncrypted(){return this._config.encrypted===ENCRYPTION_ON$2||!0===this._config.encrypted}_getTrust(){return this._config.trust}session({defaultAccessMode:e=WRITE$2,bookmarks:t,database:r="",impersonatedUser:n,fetchSize:o,bookmarkManager:i,notificationFilter:s,auth:a}={}){return this._newSession({defaultAccessMode:e,bookmarkOrBookmarks:t,database:r,reactive:!1,impersonatedUser:n,fetchSize:validateFetchSizeValue(o,this._config.fetchSize),bookmarkManager:i,notificationFilter:s,auth:a})}close(){return this._log.info(`Driver ${this._id} closing`),null!=this._connectionProvider?this._connectionProvider.close():Promise.resolve()}[Symbol.asyncDispose](){return this.close()}_afterConstruction(){this._log.info(`${this._meta.typename} driver ${this._id} created for server address `+this._meta.address.toString())}_newSession({defaultAccessMode:e,bookmarkOrBookmarks:t,database:r,reactive:n,impersonatedUser:o,fetchSize:i,bookmarkManager:s,notificationFilter:a,auth:u}){var e=Session._validateSessionMode(e),l=this._getOrCreateConnectionProvider(),t=null!=t?new Bookmarks$6(t):Bookmarks$6.empty();return this._createSession({mode:e,database:r??"",connectionProvider:l,bookmarks:t,config:this._config,reactive:n,impersonatedUser:o,fetchSize:i,bookmarkManager:s,notificationFilter:a,auth:u,log:this._log})}_getOrCreateConnectionProvider(){return null==this._connectionProvider&&(this._connectionProvider=this._createConnectionProvider(this._id,this._config,this._log,createHostNameResolver(this._config))),this._connectionProvider}}function validateConfig(e,t){var r=e.resolver;if(null!=r&&"function"!=typeof r)throw new TypeError("Configured resolver should be a function. Got: "+typeof r);return e.connectionAcquisitionTimeout<e.connectionTimeout&&t.warn('Configuration for "connectionAcquisitionTimeout" should be greater than or equal to "connectionTimeout". Otherwise, the connection acquisition timeout will take precedence for over the connection timeout in scenarios where a new connection is created while it is acquired'),e}function sanitizeConfig(e){e.maxConnectionLifetime=sanitizeIntValue(e.maxConnectionLifetime,DEFAULT_MAX_CONNECTION_LIFETIME),e.maxConnectionPoolSize=sanitizeIntValue(e.maxConnectionPoolSize,DEFAULT_POOL_MAX_SIZE),e.connectionAcquisitionTimeout=sanitizeIntValue(e.connectionAcquisitionTimeout,DEFAULT_POOL_ACQUISITION_TIMEOUT),e.fetchSize=validateFetchSizeValue(e.fetchSize,DEFAULT_FETCH_SIZE),e.connectionTimeout=extractConnectionTimeout(e),e.connectionLivenessCheckTimeout=validateConnectionLivenessCheckTimeoutSizeValue(e.connectionLivenessCheckTimeout)}function sanitizeIntValue(e,t){e=parseInt(e,10);return 0<e||0===e?e:e<0?Number.MAX_SAFE_INTEGER:t}function validateFetchSizeValue(e,t){e=parseInt(e,10);if(0<e||e===FETCH_ALL$5)return e;if(0===e||e<0)throw new Error(`The fetch size can only be a positive value or ${FETCH_ALL$5} for ALL. However fetchSize = `+e);return t}function extractConnectionTimeout(e){e=parseInt(e.connectionTimeout,10);return 0===e||!isNaN(e)&&e<0?null:isNaN(e)?DEFAULT_CONNECTION_TIMEOUT_MILLIS:e}function validateConnectionLivenessCheckTimeoutSizeValue(e){if(null!=e){e=parseInt(e,10);if(e<0||Number.isNaN(e))throw new Error("The connectionLivenessCheckTimeout can only be a positive value or 0 for always. However connectionLivenessCheckTimeout = "+e);return e}}function createHostNameResolver(e){return new ConfiguredCustomResolver(e.resolver)}var driver=Object.freeze({__proto__:null,Driver:Driver,READ:READ$2,WRITE:WRITE$2,routing:routing,SessionConfig:SessionConfig,QueryConfig:QueryConfig,default:Driver});const auth={basic:(e,t,r)=>null!=r?{scheme:"basic",principal:e,credentials:t,realm:r}:{scheme:"basic",principal:e,credentials:t},kerberos:e=>({scheme:"kerberos",principal:"",credentials:e}),bearer:e=>({scheme:"bearer",credentials:e}),none:()=>({scheme:"none"}),custom:(e,t,r,n,o)=>{n={scheme:n,principal:e};return isNotEmpty(t)&&(n.credentials=t),isNotEmpty(r)&&(n.realm=r),isNotEmpty(o)&&(n.parameters=o),n}};function isNotEmpty(e){return!(null==e||""===e||Object.getPrototypeOf(e)===Object.prototype&&0===Object.keys(e).length)}class AuthTokenManagers{bearer({tokenProvider:e}){if("function"!=typeof e)throw new TypeError("tokenProvider should be function, but got: "+typeof e);return new ExpirationBasedAuthTokenManager(e,["Neo.ClientError.Security.Unauthorized","Neo.ClientError.Security.TokenExpired"])}basic({tokenProvider:e}){if("function"!=typeof e)throw new TypeError("tokenProvider should be function, but got: "+typeof e);return new ExpirationBasedAuthTokenManager(async()=>({token:await e()}),["Neo.ClientError.Security.Unauthorized"])}}const authTokenManagers=new AuthTokenManagers;function staticAuthTokenManager({authToken:e}){return new StaticAuthTokenManager(e)}Object.freeze(authTokenManagers);class TokenRefreshObservable{_subscribers;constructor(e=[]){this._subscribers=e}subscribe(e){this._subscribers.push(e)}onCompleted(t){this._subscribers.forEach(e=>e.onCompleted(t))}onError(t){this._subscribers.forEach(e=>e.onError(t))}}class ExpirationBasedAuthTokenManager{_tokenProvider;_handledSecurityCodes;_currentAuthData;_refreshObservable;constructor(e,t,r,n){this._tokenProvider=e,this._handledSecurityCodes=t,this._currentAuthData=r,this._refreshObservable=n}async getToken(){return(void 0===this._currentAuthData||void 0!==this._currentAuthData.expiration&&this._currentAuthData.expiration<new Date)&&await this._refreshAuthToken(),this._currentAuthData?.token}handleSecurityException(e,t){return!!this._handledSecurityCodes.includes(t)&&(equals$1(e,this._currentAuthData?.token)&&this._scheduleRefreshAuthToken(),!0)}_scheduleRefreshAuthToken(e){void 0===this._refreshObservable&&(this._currentAuthData=void 0,this._refreshObservable=new TokenRefreshObservable,Promise.resolve(this._tokenProvider()).then(e=>{this._currentAuthData=e,this._refreshObservable?.onCompleted(e)}).catch(e=>{this._refreshObservable?.onError(e)}).finally(()=>{this._refreshObservable=void 0})),void 0!==e&&this._refreshObservable.subscribe(e)}async _refreshAuthToken(){return new Promise((e,t)=>{this._scheduleRefreshAuthToken({onCompleted:e,onError:t})})}}class StaticAuthTokenManager{_authToken;constructor(e){this._authToken=e}getToken(){return this._authToken}handleSecurityException(e,t){return!1}}class Config{encrypted;trust;trustedCertificates;knownHosts;fetchSize;maxConnectionPoolSize;maxTransactionRetryTime;maxConnectionLifetime;connectionAcquisitionTimeout;connectionLivenessCheckTimeout;connectionTimeout;disableLosslessIntegers;notificationFilter;useBigInt;logging;resolver;userAgent;telemetryDisabled;constructor(){this.encrypted=void 0,this.trust=void 0,this.trustedCertificates=[],this.maxConnectionPoolSize=100,this.maxConnectionLifetime=36e5,this.connectionAcquisitionTimeout=6e4,this.maxTransactionRetryTime=3e4,this.connectionLivenessCheckTimeout=void 0,this.connectionTimeout=3e4,this.disableLosslessIntegers=!1,this.useBigInt=!1,this.logging=void 0,this.resolver=void 0,this.notificationFilter=void 0,this.userAgent=void 0,this.telemetryDisabled=!1}}class InternalConfig extends Config{boltAgent}var types=Object.freeze({__proto__:null,Config:Config,InternalConfig:InternalConfig});const error={SERVICE_UNAVAILABLE:SERVICE_UNAVAILABLE$5,SESSION_EXPIRED:SESSION_EXPIRED$2,PROTOCOL_ERROR:PROTOCOL_ERROR$6},forExport={authTokenManagers:authTokenManagers,newError:newError,Neo4jError:Neo4jError,isRetriableError:isRetriableError,error:error,Integer:Integer,int:int,isInt:isInt,inSafeRange:inSafeRange,toNumber:toNumber,toString:toString,internal:internal,isPoint:isPoint,Point:Point,Date:Date$1,DateTime:DateTime,Duration:Duration,isDate:isDate,isDateTime:isDateTime,isDuration:isDuration,isLocalDateTime:isLocalDateTime,isLocalTime:isLocalTime,isTime:isTime,LocalDateTime:LocalDateTime,LocalTime:LocalTime,Time:Time,Node:Node,isNode:isNode,Relationship:Relationship,isRelationship:isRelationship,UnboundRelationship:UnboundRelationship,isUnboundRelationship:isUnboundRelationship,Path:Path,isPath:isPath,PathSegment:PathSegment,isPathSegment:isPathSegment,Record:Record,ResultSummary:ResultSummary,queryType:queryType,ServerInfo:ServerInfo,Notification:Notification,Plan:Plan,ProfiledPlan:ProfiledPlan,QueryStatistics:QueryStatistics,Stats:Stats,Result:Result,EagerResult:EagerResult,Transaction:Transaction,ManagedTransaction:ManagedTransaction,TransactionPromise:TransactionPromise,Session:Session,Driver:Driver,Connection:Connection$1,types:types,driver:driver,json:json,auth:auth,bookmarkManager:bookmarkManager,routing:routing,resultTransformers:resultTransformers,notificationCategory:notificationCategory,notificationSeverityLevel:notificationSeverityLevel,notificationFilterDisabledCategory:notificationFilterDisabledCategory,notificationFilterMinimumSeverityLevel:notificationFilterMinimumSeverityLevel};var lib$1=Object.freeze({__proto__:null,authTokenManagers:authTokenManagers,newError:newError,Neo4jError:Neo4jError,isRetriableError:isRetriableError,error:error,Integer:Integer,int:int,isInt:isInt,inSafeRange:inSafeRange,toNumber:toNumber,toString:toString,internal:internal,isPoint:isPoint,Point:Point,Date:Date$1,DateTime:DateTime,Duration:Duration,isDate:isDate,isDateTime:isDateTime,isDuration:isDuration,isLocalDateTime:isLocalDateTime,isLocalTime:isLocalTime,isTime:isTime,LocalDateTime:LocalDateTime,LocalTime:LocalTime,Time:Time,Node:Node,isNode:isNode,Relationship:Relationship,isRelationship:isRelationship,UnboundRelationship:UnboundRelationship,isUnboundRelationship:isUnboundRelationship,Path:Path,isPath:isPath,PathSegment:PathSegment,isPathSegment:isPathSegment,Record:Record,ResultSummary:ResultSummary,queryType:queryType,ServerInfo:ServerInfo,Notification:Notification,Plan:Plan,ProfiledPlan:ProfiledPlan,QueryStatistics:QueryStatistics,Stats:Stats,Result:Result,EagerResult:EagerResult,ConnectionProvider:ConnectionProvider,Connection:Connection$1,Transaction:Transaction,ManagedTransaction:ManagedTransaction,TransactionPromise:TransactionPromise,Session:Session,Driver:Driver,types:types,driver:driver,json:json,auth:auth,bookmarkManager:bookmarkManager,staticAuthTokenManager:staticAuthTokenManager,routing:routing,resultTransformers:resultTransformers,notificationCategory:notificationCategory,notificationSeverityLevel:notificationSeverityLevel,notificationFilterDisabledCategory:notificationFilterDisabledCategory,notificationFilterMinimumSeverityLevel:notificationFilterMinimumSeverityLevel,default:forExport}),require$$2=getAugmentedNamespace(lib$1);class LoadBalancingStrategy{selectReader(e){throw new Error("Abstract function")}selectWriter(e){throw new Error("Abstract function")}}class RoundRobinArrayIndex{constructor(e){this._offset=e||0}next(e){var t;return 0===e?-1:(t=this._offset,this._offset+=1,this._offset===Number.MAX_SAFE_INTEGER&&(this._offset=0),t%e)}}class LeastConnectedLoadBalancingStrategy extends LoadBalancingStrategy{constructor(e){super(),this._readersIndex=new RoundRobinArrayIndex,this._writersIndex=new RoundRobinArrayIndex,this._connectionPool=e}selectReader(e){return this._select(e,this._readersIndex)}selectWriter(e){return this._select(e,this._writersIndex)}_select(e,t){var r=e.length;if(0===r)return null;var n=t.next(r);let o=n,i=null,s=Number.MAX_SAFE_INTEGER;do{var a=e[o],u=this._connectionPool.activeResourceCount(a);u<s&&(i=a,s=u),o===r-1?o=0:o++}while(o!==n);return i}}for(var index$6=Object.freeze({__proto__:null,default:LeastConnectedLoadBalancingStrategy,LoadBalancingStrategy:LoadBalancingStrategy,LeastConnectedLoadBalancingStrategy:LeastConnectedLoadBalancingStrategy}),buffer={},base64Js={},lookup=(base64Js.byteLength=byteLength,base64Js.toByteArray=toByteArray,base64Js.fromByteArray=fromByteArray,[]),revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),t=(e=-1===e?t:e)===t?0:4-e%4;return[e,t]}function byteLength(e){var e=getLens(e),t=e[0],e=e[1];return 3*(t+e)/4-e}function _byteLength(e,t,r){return 3*(t+r)/4-r}function toByteArray(e){for(var t,r=getLens(e),n=r[0],r=r[1],o=new Arr(_byteLength(e,n,r)),i=0,s=0<r?n-4:n,a=0;a<s;a+=4)t=revLookup[e.charCodeAt(a)]<<18|revLookup[e.charCodeAt(a+1)]<<12|revLookup[e.charCodeAt(a+2)]<<6|revLookup[e.charCodeAt(a+3)],o[i++]=t>>16&255,o[i++]=t>>8&255,o[i++]=255&t;return 2===r&&(t=revLookup[e.charCodeAt(a)]<<2|revLookup[e.charCodeAt(a+1)]>>4,o[i++]=255&t),1===r&&(t=revLookup[e.charCodeAt(a)]<<10|revLookup[e.charCodeAt(a+1)]<<4|revLookup[e.charCodeAt(a+2)]>>2,o[i++]=t>>8&255,o[i++]=255&t),o}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,t,r){for(var n,o=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(tripletToBase64(n));return o.join("")}function fromByteArray(e){for(var t,r=e.length,n=r%3,o=[],i=0,s=r-n;i<s;i+=16383)o.push(encodeChunk(e,i,s<i+16383?s:i+16383));return 1==n?(t=e[r-1],o.push(lookup[t>>2]+lookup[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],o.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),o.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;var ieee754={read:function(e,t,r,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,l=u>>1,c=-7,h=r?o-1:0,_=r?-1:1,o=e[t+h];for(h+=_,i=o&(1<<-c)-1,o>>=-c,c+=a;0<c;i=256*i+e[t+h],h+=_,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=n;0<c;s=256*s+e[t+h],h+=_,c-=8);if(0===i)i=1-l;else{if(i===u)return s?NaN:1/0*(o?-1:1);s+=Math.pow(2,n),i-=l}return(o?-1:1)*s*Math.pow(2,i-n)},write:function(e,t,r,n,o,i){var s,a,u=8*i-o-1,l=(1<<u)-1,c=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:i-1,d=n?1:-1,i=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-s))<1&&(s--,n*=2),2<=(t+=1<=s+c?h/n:h*Math.pow(2,1-c))*n&&(s++,n/=2),l<=s+c?(a=0,s=l):1<=s+c?(a=(t*n-1)*Math.pow(2,o),s+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,o),s=0));8<=o;e[r+_]=255&a,_+=d,a/=256,o-=8);for(s=s<<o|a,u+=o;0<u;e[r+_]=255&s,_+=d,s/=256,u-=8);e[r+_-d]|=128*i}};!function(r){const g=base64Js,i=ieee754;var e="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=c,r.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},r.INSPECT_MAX_BYTES=50;const t=2147483647;function a(e){if(e>t)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return Object.setPrototypeOf(e,c.prototype),e}function c(e,t,r){if("number"!=typeof e)return n(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}function n(t,r,e){if("string"==typeof t){var n=t;var o=r;"string"==typeof o&&""!==o||(o="utf8");if(!c.isEncoding(o))throw new TypeError("Unknown encoding: "+o);var i=0|_(n,o);let e=a(i);n=e.write(n,o);n!==i&&(e=e.slice(0,n));return e}if(ArrayBuffer.isView(t))return D(o=t,Uint8Array)?l((i=new Uint8Array(o)).buffer,i.byteOffset,i.byteLength):u(o);if(null!=t){if(D(t,ArrayBuffer)||t&&D(t.buffer,ArrayBuffer))return l(t,r,e);if("undefined"!=typeof SharedArrayBuffer&&(D(t,SharedArrayBuffer)||t&&D(t.buffer,SharedArrayBuffer)))return l(t,r,e);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return c.from(n,r,e);var s=function(e){{var t,r;if(c.isBuffer(e))return t=0|h(e.length),0!==(r=a(t)).length&&e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||k(e.length)?a(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(t);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),r,e)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function o(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return o(e),a(e<0?0:0|h(e))}function u(t){var r=t.length<0?0:0|h(t.length),n=a(r);for(let e=0;e<r;e+=1)n[e]=255&t[e];return n}function l(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,c.prototype),n}function h(e){if(e>=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function _(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;let o=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return A(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return H(e).length;default:if(o)return n?-1:A(e).length;t=(""+t).toLowerCase(),o=!0}}function B(e,r,n){let t=!1;if((r=void 0===r||r<0?0:r)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(r>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":{var o=this;var i=r;var s=n;var a=o.length;(!i||i<0)&&(i=0);(!s||s<0||a<s)&&(s=a);let t="";for(let e=i;e<s;++e)t+=V[o[e]];return t;return}case"utf8":case"utf-8":return p(this,r,n);case"ascii":{var u=this;a=r;var l=n;let t="";l=Math.min(u.length,l);for(let e=a;e<l;++e)t+=String.fromCharCode(127&u[e]);return t;return}case"latin1":case"binary":{var c=this;i=r;var h=n;let t="";h=Math.min(c.length,h);for(let e=i;e<h;++e)t+=String.fromCharCode(c[e]);return t;return}case"base64":return d=this,m=n,0===(f=r)&&m===d.length?g.fromByteArray(d):g.fromByteArray(d.slice(f,m));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":{d=this;f=r;m=n;var _=d.slice(f,m);let t="";for(let e=0;e<_.length-1;e+=2)t+=String.fromCharCode(_[e]+256*_[e+1]);return t;return}default:if(t)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),t=!0}var d,f,m}function d(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function f(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=k(r=+r)?o?0:e.length-1:r)<0?e.length+r:r)>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(o?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):m(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function m(r,n,t,e,o){let i=1,s=r.length,a=n.length;if(void 0!==e&&("ucs2"===(e=String(e).toLowerCase())||"ucs-2"===e||"utf16le"===e||"utf-16le"===e)){if(r.length<2||n.length<2)return-1;i=2,s/=2,a/=2,t/=2}function u(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}let l;if(o){let e=-1;for(l=t;l<s;l++)if(u(r,l)===u(n,-1===e?0:l-e)){if(-1===e&&(e=l),l-e+1===a)return e*i}else-1!==e&&(l-=l-e),e=-1}else for(t+a>s&&(t=s-a),l=t;0<=l;l--){let t=!0;for(let e=0;e<a;e++)if(u(r,l+e)!==u(n,e)){t=!1;break}if(t)return l}return-1}function M(e,t,r,n){return L(function(t){var r=[];for(let e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r}(t),e,r,n)}function $(e,t,r,n){return L(function(t,r){var n,o;var i=[];for(let e=0;e<t.length&&!((r-=2)<0);++e)n=t.charCodeAt(e),o=n>>8,i.push(n%256),i.push(o);return i}(t,e.length-r),e,r,n)}function p(s,e,t){t=Math.min(s.length,t);var r=[];let a=e;for(;a<t;){var u=s[a];let o=null,i=239<u?4:223<u?3:191<u?2:1;if(a+i<=t){let e,t,r,n;switch(i){case 1:u<128&&(o=u);break;case 2:128==(192&(e=s[a+1]))&&127<(n=(31&u)<<6|63&e)&&(o=n);break;case 3:e=s[a+1],t=s[a+2],128==(192&e)&&128==(192&t)&&2047<(n=(15&u)<<12|(63&e)<<6|63&t)&&(n<55296||57343<n)&&(o=n);break;case 4:e=s[a+1],t=s[a+2],r=s[a+3],128==(192&e)&&128==(192&t)&&128==(192&r)&&65535<(n=(15&u)<<18|(63&e)<<12|(63&t)<<6|63&r)&&n<1114112&&(o=n)}}null===o?(o=65533,i=1):65535<o&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),a+=i}{var n=r,o=n.length;if(o<=E)return String.fromCharCode.apply(String,n);let e="",t=0;for(;t<o;)e+=String.fromCharCode.apply(String,n.slice(t,t+=E));return e}}r.kMaxLength=t,(c.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=n,Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return t=t,r=r,o(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},c.allocUnsafe=s,c.allocUnsafeSlow=s,c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(r,n){if(D(r,Uint8Array)&&(r=c.from(r,r.offset,r.byteLength)),D(n,Uint8Array)&&(n=c.from(n,n.offset,n.byteLength)),!c.isBuffer(r)||!c.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===n)return 0;let o=r.length,i=n.length;for(let e=0,t=Math.min(o,i);e<t;++e)if(r[e]!==n[e]){o=r[e],i=n[e];break}return o<i?-1:i<o?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=c.allocUnsafe(e);let o=0;for(r=0;r<t.length;++r){let e=t[r];if(D(e,Uint8Array))o+e.length>n.length?(e=c.isBuffer(e)?e:c.from(e)).copy(n,o):Uint8Array.prototype.set.call(n,e,o);else{if(!c.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(n,o)}o+=e.length}return n},c.byteLength=_,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)d(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},c.prototype.toLocaleString=c.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?p(this,0,e):B.apply(this,arguments)},c.prototype.equals=function(e){if(c.isBuffer(e))return this===e||0===c.compare(this,e);throw new TypeError("Argument must be a Buffer")},c.prototype.inspect=function(){let e="";var t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},e&&(c.prototype[e]=c.prototype.inspect),c.prototype.compare=function(e,t,r,n,o){if(D(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),(t=void 0===t?0:t)<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&r<=t)return 0;if(o<=n)return-1;if(r<=t)return 1;if(this===e)return 0;let i=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0);var a=Math.min(i,s),u=this.slice(n,o),l=e.slice(t,r);for(let e=0;e<a;++e)if(u[e]!==l[e]){i=u[e],s=l[e];break}return i<s?-1:s<i?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return f(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return f(this,e,t,r,!1)},c.prototype.write=function(t,r,n,e){if(void 0===r)e="utf8",n=this.length,r=0;else if(void 0===n&&"string"==typeof r)e=r,n=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(n)?(n>>>=0,void 0===e&&(e="utf8")):(e=n,n=void 0)}var o,i,s,a=this.length-r;if((void 0===n||a<n)&&(n=a),0<t.length&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");e=e||"utf8";let u=!1;for(;;)switch(e){case"hex":{var l=this;var c=t;var h=r;var _=n;h=Number(h)||0;var d=l.length-h;(!_||d<(_=Number(_)))&&(_=d),(d=c.length)/2<_&&(_=d/2);let e;for(e=0;e<_;++e){var f=parseInt(c.substr(2*e,2),16);if(k(f))return e;l[h+e]=f}return e;return}case"utf8":case"utf-8":return d=r,s=n,L(A(t,(i=this).length-d),i,d,s);case"ascii":case"latin1":case"binary":return M(this,t,r,n);case"base64":return i=this,s=r,o=n,L(H(t),i,s,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,t,r,n);default:if(u)throw new TypeError("Unknown encoding: "+e);e=(""+e).toLowerCase(),u=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const E=4096;function T(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,o){F(t,n,o,e,r,7);n=Number(t&BigInt(4294967295)),e[r++]=n,e[r++]=n>>=8,e[r++]=n>>=8,e[r++]=n>>=8,o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,e[r++]=o>>=8,e[r++]=o>>=8,e[r++]=o>>=8,r}function R(e,t,r,n,o){F(t,n,o,e,r,7);n=Number(t&BigInt(4294967295)),e[r+7]=n,e[r+6]=n>>=8,e[r+5]=n>>=8,e[r+4]=n>>=8,o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,e[r+2]=o>>=8,e[r+1]=o>>=8,e[r]=o>>=8,r+8}function I(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function v(e,t,r,n,o){return t=+t,r>>>=0,o||I(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function y(e,t,r,n,o){return t=+t,r>>>=0,o||I(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r=this.length,r=((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),this.subarray(e,t));return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||T(e,t,this.length);let n=this[e],o=1,i=0;for(;++i<t&&(o*=256);)n+=this[e+i]*o;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||T(e,t,this.length);let n=this[e+--t],o=1;for(;0<t&&(o*=256);)n+=this[e+--t]*o;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||T(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||T(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||T(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=U(function(e){N(e>>>=0,"offset");var t=this[e],r=this[e+7],t=(void 0!==t&&void 0!==r||P(e,this.length-8),t+256*this[++e]+65536*this[++e]+this[++e]*2**24),e=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(t)+(BigInt(e)<<BigInt(32))}),c.prototype.readBigUInt64BE=U(function(e){N(e>>>=0,"offset");var t=this[e],r=this[e+7],t=(void 0!==t&&void 0!==r||P(e,this.length-8),t*2**24+65536*this[++e]+256*this[++e]+this[++e]),e=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(t)<<BigInt(32))+BigInt(e)}),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||T(e,t,this.length);let n=this[e],o=1,i=0;for(;++i<t&&(o*=256);)n+=this[e+i]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||T(e,t,this.length);let n=t,o=1,i=this[e+--n];for(;0<n&&(o*=256);)i+=this[e+--n]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return e>>>=0,t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||T(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},c.prototype.readInt16BE=function(e,t){e>>>=0,t||T(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=U(function(e){N(e>>>=0,"offset");var t=this[e],r=this[e+7],r=(void 0!==t&&void 0!==r||P(e,this.length-8),this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24));return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),c.prototype.readBigInt64BE=U(function(e){N(e>>>=0,"offset");var t=this[e],r=this[e+7],t=(void 0!==t&&void 0!==r||P(e,this.length-8),(t<<24)+65536*this[++e]+256*this[++e]+this[++e]);return(BigInt(t)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)}),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||T(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||T(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||T(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||T(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||b(this,e,t,r,Math.pow(2,8*r)-1,0);let o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||b(this,e,t,r,Math.pow(2,8*r)-1,0);let o=r-1,i=1;for(this[t+o]=255&e;0<=--o&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=U(function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=U(function(e,t=0){return R(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(e,t,r,n){e=+e,t>>>=0,n||b(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);let o=0,i=1,s=0;for(this[t]=255&e;++o<r&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){e=+e,t>>>=0,n||b(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);let o=r-1,i=1,s=0;for(this[t+o]=255&e;0<=--o&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||b(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=U(function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=U(function(e,t=0){return R(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeFloatLE=function(e,t,r){return v(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return v(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return y(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return y(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<r?r:n)===r)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var o=(n=e.length-t<n-r?e.length-t+r:n)-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),o},c.prototype.fill=function(t,r,n,o){if("string"==typeof t){if("string"==typeof r?(o=r,r=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!c.isEncoding(o))throw new TypeError("Unknown encoding: "+o);var e;1===t.length&&(e=t.charCodeAt(0),"utf8"===o&&e<128||"latin1"===o)&&(t=e)}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(!(n<=r)){r>>>=0,n=void 0===n?this.length:n>>>0;let e;if("number"==typeof(t=t||0))for(e=r;e<n;++e)this[e]=t;else{var i=c.isBuffer(t)?t:c.from(t,o),s=i.length;if(0===s)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(e=0;e<n-r;++e)this[e+r]=i[e%s]}}return this};const C={};function S(e,t,r){C[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=this.name+` [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return this.name+` [${e}]: `+this.message}}}function w(e){let t="",r=e.length;for(var n="-"===e[0]?1:0;r>=4+n;r-=3)t="_"+e.slice(r-3,r)+t;return""+e.slice(0,r)+t}function F(t,r,n,e,o,i){if(n<t||t<r){var s="bigint"==typeof r?"n":"";let e;throw e=3<i?0===r||r===BigInt(0)?`>= 0${s} and < 2${s} ** `+8*(i+1)+s:`>= -(2${s} ** ${8*(i+1)-1}${s}) and < 2 ** `+(8*(i+1)-1)+s:`>= ${r}${s} and <= `+n+s,new C.ERR_OUT_OF_RANGE("value",e,t)}r=e,n=i,N(s=o,"offset"),void 0!==r[s]&&void 0!==r[s+n]||P(s,r.length-(n+1))}function N(e,t){if("number"!=typeof e)throw new C.ERR_INVALID_ARG_TYPE(t,"number",e)}function P(e,t,r){if(Math.floor(e)!==e)throw N(e,r),new C.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new C.ERR_BUFFER_OUT_OF_BOUNDS;throw new C.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= `+t,e)}S("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?e+" is outside of buffer bounds":"Attempt to access memory outside buffer bounds"},RangeError),S("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type `+typeof t},TypeError),S("ERR_OUT_OF_RANGE",function(e,t,r){e=`The value of "${e}" is out of range.`;let n=r;return Number.isInteger(r)&&Math.abs(r)>2**32?n=w(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=w(n)),n+="n"),e+=` It must be ${t}. Received `+n},RangeError);const x=/[^+/0-9A-Za-z-_]/g;function A(t,r){r=r||1/0;let n;var o=t.length;let i=null;var s=[];for(let e=0;e<o;++e){if(55295<(n=t.charCodeAt(e))&&n<57344){if(!i){if(56319<n){-1<(r-=3)&&s.push(239,191,189);continue}if(e+1===o){-1<(r-=3)&&s.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(r-=3)&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(r-=3)&&s.push(239,191,189);if(i=null,n<128){if(--r<0)break;s.push(n)}else if(n<2048){if((r-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((r-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function H(e){return g.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function L(e,t,r,n){let o;for(o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function k(e){return e!=e}const V=function(){var r="0123456789abcdef",n=new Array(256);for(let t=0;t<16;++t){var o=16*t;for(let e=0;e<16;++e)n[o+e]=r[t]+r[e]}return n}();function U(e){return"undefined"==typeof BigInt?j:e}function j(){throw new Error("BigInt not supported")}}(buffer);class BaseBuffer{constructor(e){this.position=0,this.length=e}getUInt8(e){throw new Error("Not implemented")}getInt8(e){throw new Error("Not implemented")}getFloat64(e){throw new Error("Not implemented")}putUInt8(e,t){throw new Error("Not implemented")}putInt8(e,t){throw new Error("Not implemented")}putFloat64(e,t){throw new Error("Not implemented")}getInt16(e){return this.getInt8(e)<<8|this.getUInt8(e+1)}getUInt16(e){return this.getUInt8(e)<<8|this.getUInt8(e+1)}getInt32(e){return this.getInt8(e)<<24|this.getUInt8(e+1)<<16|this.getUInt8(e+2)<<8|this.getUInt8(e+3)}getUInt32(e){return this.getUInt8(e)<<24|this.getUInt8(e+1)<<16|this.getUInt8(e+2)<<8|this.getUInt8(e+3)}getInt64(e){return this.getInt8(e)<<56|this.getUInt8(e+1)<<48|this.getUInt8(e+2)<<40|this.getUInt8(e+3)<<32|this.getUInt8(e+4)<<24|this.getUInt8(e+5)<<16|this.getUInt8(e+6)<<8|this.getUInt8(e+7)}getSlice(e,t){return new SliceBuffer(e,t,this)}putInt16(e,t){this.putInt8(e,t>>8),this.putUInt8(e+1,255&t)}putUInt16(e,t){this.putUInt8(e,t>>8&255),this.putUInt8(e+1,255&t)}putInt32(e,t){this.putInt8(e,t>>24),this.putUInt8(e+1,t>>16&255),this.putUInt8(e+2,t>>8&255),this.putUInt8(e+3,255&t)}putUInt32(e,t){this.putUInt8(e,t>>24&255),this.putUInt8(e+1,t>>16&255),this.putUInt8(e+2,t>>8&255),this.putUInt8(e+3,255&t)}putInt64(e,t){this.putInt8(e,t>>48),this.putUInt8(e+1,t>>42&255),this.putUInt8(e+2,t>>36&255),this.putUInt8(e+3,t>>30&255),this.putUInt8(e+4,t>>24&255),this.putUInt8(e+5,t>>16&255),this.putUInt8(e+6,t>>8&255),this.putUInt8(e+7,255&t)}putBytes(r,n){for(let e=0,t=n.remaining();e<t;e++)this.putUInt8(r+e,n.readUInt8())}readUInt8(){return this.getUInt8(this._updatePos(1))}readInt8(){return this.getInt8(this._updatePos(1))}readUInt16(){return this.getUInt16(this._updatePos(2))}readUInt32(){return this.getUInt32(this._updatePos(4))}readInt16(){return this.getInt16(this._updatePos(2))}readInt32(){return this.getInt32(this._updatePos(4))}readInt64(){return this.getInt32(this._updatePos(8))}readFloat64(){return this.getFloat64(this._updatePos(8))}writeUInt8(e){this.putUInt8(this._updatePos(1),e)}writeInt8(e){this.putInt8(this._updatePos(1),e)}writeInt16(e){this.putInt16(this._updatePos(2),e)}writeInt32(e){this.putInt32(this._updatePos(4),e)}writeUInt32(e){this.putUInt32(this._updatePos(4),e)}writeInt64(e){this.putInt64(this._updatePos(8),e)}writeFloat64(e){this.putFloat64(this._updatePos(8),e)}writeBytes(e){this.putBytes(this._updatePos(e.remaining()),e)}readSlice(e){return this.getSlice(this._updatePos(e),e)}_updatePos(e){var t=this.position;return this.position+=e,t}remaining(){return this.length-this.position}hasRemaining(){return 0<this.remaining()}reset(){this.position=0}toString(){return this.constructor.name+"( position="+this.position+" )\n  "+this.toHex()}toHex(){let r="";for(let t=0;t<this.length;t++){let e=this.getUInt8(t).toString(16);1===e.length&&(e="0"+e),r+=e,t!==this.length-1&&(r+=" ")}return r}}class SliceBuffer extends BaseBuffer{constructor(e,t,r){super(t),this._start=e,this._inner=r}putUInt8(e,t){this._inner.putUInt8(this._start+e,t)}getUInt8(e){return this._inner.getUInt8(this._start+e)}putInt8(e,t){this._inner.putInt8(this._start+e,t)}putFloat64(e,t){this._inner.putFloat64(this._start+e,t)}getInt8(e){return this._inner.getInt8(this._start+e)}getFloat64(e){return this._inner.getFloat64(this._start+e)}}var index$5=Object.freeze({__proto__:null,default:BaseBuffer,BaseBuffer:BaseBuffer});class ChannelBuffer extends BaseBuffer{constructor(e){e=newChannelJSBuffer(e);super(e.length),this._buffer=e}getUInt8(e){return this._buffer.readUInt8(e)}getInt8(e){return this._buffer.readInt8(e)}getFloat64(e){return this._buffer.readDoubleBE(e)}putUInt8(e,t){this._buffer.writeUInt8(t,e)}putInt8(e,t){this._buffer.writeInt8(t,e)}putFloat64(e,t){this._buffer.writeDoubleBE(t,e)}putBytes(e,t){var r;t instanceof ChannelBuffer?(r=Math.min(t.length-t.position,this.length-e),t._buffer.copy(this._buffer,e,t.position,t.position+r),t.position+=r):super.putBytes(e,t)}getSlice(e,t){return new ChannelBuffer(this._buffer.slice(e,e+t))}}function alloc(e){return new ChannelBuffer(e)}function newChannelJSBuffer(e){return e instanceof buffer.Buffer?e:"number"==typeof e&&"function"==typeof buffer.Buffer.alloc?buffer.Buffer.alloc(e):new buffer.Buffer(e)}const{ENCRYPTION_OFF:ENCRYPTION_OFF$1,ENCRYPTION_ON:ENCRYPTION_ON$1}=internal["util"],WS_OPEN=1,WS_CLOSED=3;class WebSocketChannel{constructor(e,t=detectWebPageProtocol,r=e=>new WebSocket(e)){this._open=!0,this._pending=[],this._error=null,this._handleConnectionError=this._handleConnectionError.bind(this),this._config=e,this._receiveTimeout=null,this._receiveTimeoutStarted=!1,this._receiveTimeoutId=null,this._closingPromise=null;var{scheme:t,error:n}=determineWebSocketScheme(e,t);if(n)this._error=n;else{this._ws=createWebSocket(t,e.address,r),this._ws.binaryType="arraybuffer";const o=this;this._ws.onclose=function(e){e&&!e.wasClean&&o._handleConnectionError(),o._open=!1},this._ws.onopen=function(){o._clearConnectionTimeout();var t=o._pending;o._pending=null;for(let e=0;e<t.length;e++)o.write(t[e])},this._ws.onmessage=e=>{this._resetTimeout(),o.onmessage&&(e=new ChannelBuffer(e.data),o.onmessage(e))},this._ws.onerror=this._handleConnectionError,this._connectionTimeoutFired=!1,this._connectionTimeoutId=this._setupConnectionTimeout()}}_handleConnectionError(){this._connectionTimeoutFired?(this._error=newError(`Failed to establish connection in ${this._config.connectionTimeout}ms`,this._config.connectionErrorCode),this.onerror&&this.onerror(this._error)):this._open&&!this._timedout&&(this._error=newError("WebSocket connection failure. Due to security constraints in your web browser, the reason for the failure is not available to this Neo4j Driver. Please use your browsers development console to determine the root cause of the failure. Common reasons include the database being unavailable, using the wrong connection URL or temporary network problems. If you have enabled encryption, ensure your browser is configured to trust the certificate Neo4j is configured to use. WebSocket `readyState` is: "+this._ws.readyState,this._config.connectionErrorCode),this.onerror)&&this.onerror(this._error)}write(e){if(null!==this._pending)this._pending.push(e);else{if(!(e instanceof ChannelBuffer))throw newError("Don't know how to send buffer: "+e);try{this._ws.send(e._buffer)}catch(e){if(this._ws.readyState===WS_OPEN)throw e;this._handleConnectionError()}}}close(){return null===this._closingPromise&&(this._closingPromise=new Promise((e,t)=>{this._clearConnectionTimeout(),this._ws&&this._ws.readyState!==WS_CLOSED?(this._open=!1,this.stopReceiveTimeout(),this._ws.onclose=()=>{e()},this._ws.close()):e()})),this._closingPromise}setupReceiveTimeout(e){this._receiveTimeout=e}stopReceiveTimeout(){null!==this._receiveTimeout&&this._receiveTimeoutStarted&&(this._receiveTimeoutStarted=!1,null!=this._receiveTimeoutId&&clearTimeout(this._receiveTimeoutId),this._receiveTimeoutId=null)}startReceiveTimeout(){this._open&&null!==this._receiveTimeout&&!this._receiveTimeoutStarted&&(this._receiveTimeoutStarted=!0,this._resetTimeout())}_resetTimeout(){this._receiveTimeoutStarted&&(null!==this._receiveTimeoutId&&clearTimeout(this._receiveTimeoutId),this._receiveTimeoutId=setTimeout(()=>{this._receiveTimeoutId=null,this._timedout=!0,this.stopReceiveTimeout(),this._error=newError(`Connection lost. Server didn't respond in ${this._receiveTimeout}ms`,this._config.connectionErrorCode),this.close(),this.onerror&&this.onerror(this._error)},this._receiveTimeout))}_setupConnectionTimeout(){var e=this._config.connectionTimeout;if(e){const t=this._ws;return setTimeout(()=>{t.readyState!==WS_OPEN&&(this._connectionTimeoutFired=!0,t.close())},e)}return null}_clearConnectionTimeout(){var e=this._connectionTimeoutId;!e&&0!==e||(this._connectionTimeoutFired=!1,this._connectionTimeoutId=null,clearTimeout(e))}}function createWebSocket(t,r,n){var e=t+"://"+r.asHostPort();try{return n(e)}catch(e){if(isIPv6AddressIssueOnWindows(e,r))return n(asWindowsFriendlyIPv6Address(t,r));throw e}}function isIPv6AddressIssueOnWindows(e,t){return"SyntaxError"===e.name&&isIPv6Address(t.asHostPort())}function isIPv6Address(e){return"["===e.charAt(0)&&-1!==e.indexOf("]")}function asWindowsFriendlyIPv6Address(e,t){return e+`://${t.host().replace(/:/g,"-").replace("%","s")+".ipv6-literal.net"}:`+t.port()}function determineWebSocketScheme(e,t){var r=isEncryptionExplicitlyTurnedOn(e),n=isEncryptionExplicitlyTurnedOff(e),e=e.trust,t=isProtocolSecure(t);return verifyEncryptionSettings(r,n,t),n?{scheme:"ws",error:null}:t?{scheme:"wss",error:null}:r?e&&"TRUST_SYSTEM_CA_SIGNED_CERTIFICATES"!==e?{scheme:null,error:newError("The browser version of this driver only supports one trust strategy, 'TRUST_SYSTEM_CA_SIGNED_CERTIFICATES'. "+e+' is not supported. Please either use TRUST_SYSTEM_CA_SIGNED_CERTIFICATES or disable encryption by setting `encrypted:"'+ENCRYPTION_OFF$1+'"` in the driver configuration.')}:{scheme:"wss",error:null}:{scheme:"ws",error:null}}function isEncryptionExplicitlyTurnedOn(e){return!0===e.encrypted||e.encrypted===ENCRYPTION_ON$1}function isEncryptionExplicitlyTurnedOff(e){return!1===e.encrypted||e.encrypted===ENCRYPTION_OFF$1}function isProtocolSecure(e){e="function"==typeof e?e():"";return e&&0<=e.toLowerCase().indexOf("https")}function verifyEncryptionSettings(e,t,r){null!==r&&(e&&!r?console.warn("Neo4j driver is configured to use secure WebSocket on a HTTP web page. WebSockets might not work in a mixed content environment. Please consider configuring driver to not use encryption."):t&&r&&console.warn("Neo4j driver is configured to use insecure WebSocket on a HTTPS web page. WebSockets might not work in a mixed content environment. Please consider configuring driver to use encryption."))}function detectWebPageProtocol(){return"undefined"!=typeof window&&window.location?window.location.protocol:null}const{BaseHostNameResolver}=internal["resolver"];class BrowserHostNameResolver extends BaseHostNameResolver{resolve(e){return this._resolveToItself(e)}}const Channel=WebSocketChannel,HostNameResolver=BrowserHostNameResolver;class CombinedBuffer extends BaseBuffer{constructor(t){let r=0;for(let e=0;e<t.length;e++)r+=t[e].length;super(r),this._buffers=t}getUInt8(t){for(let e=0;e<this._buffers.length;e++){var r=this._buffers[e];if(!(t>=r.length))return r.getUInt8(t);t-=r.length}}getInt8(t){for(let e=0;e<this._buffers.length;e++){var r=this._buffers[e];if(!(t>=r.length))return r.getInt8(t);t-=r.length}}getFloat64(t){var r=alloc(8);for(let e=0;e<8;e++)r.putUInt8(e,this.getUInt8(t+e));return r.getFloat64(0)}}const _CHUNK_HEADER_SIZE=2,_MESSAGE_BOUNDARY=0,_DEFAULT_BUFFER_SIZE=1400;class Chunker extends BaseBuffer{constructor(e,t){super(0),this._bufferSize=t||_DEFAULT_BUFFER_SIZE,this._ch=e,this._buffer=alloc(this._bufferSize),this._currentChunkStart=0,this._chunkOpen=!1}putUInt8(e,t){this._ensure(1),this._buffer.writeUInt8(t)}putInt8(e,t){this._ensure(1),this._buffer.writeInt8(t)}putFloat64(e,t){this._ensure(8),this._buffer.writeFloat64(t)}putBytes(e,t){for(;0<t.remaining();)this._ensure(1),this._buffer.remaining()>t.remaining()?this._buffer.writeBytes(t):this._buffer.writeBytes(t.readSlice(this._buffer.remaining()));return this}flush(){var e;return 0<this._buffer.position&&(this._closeChunkIfOpen(),e=this._buffer,this._buffer=null,this._ch.write(e.getSlice(0,e.position)),this._buffer=alloc(this._bufferSize),this._chunkOpen=!1),this}messageBoundary(){this._closeChunkIfOpen(),this._buffer.remaining()<_CHUNK_HEADER_SIZE&&this.flush(),this._buffer.writeInt16(_MESSAGE_BOUNDARY)}_ensure(e){e=this._chunkOpen?e:e+_CHUNK_HEADER_SIZE;this._buffer.remaining()<e&&this.flush(),this._chunkOpen||(this._currentChunkStart=this._buffer.position,this._buffer.position=this._buffer.position+_CHUNK_HEADER_SIZE,this._chunkOpen=!0)}_closeChunkIfOpen(){var e;this._chunkOpen&&(e=this._buffer.position-(this._currentChunkStart+_CHUNK_HEADER_SIZE),this._buffer.putUInt16(this._currentChunkStart,e),this._chunkOpen=!1)}}class Dechunker{constructor(){this._currentMessage=[],this._partialChunkHeader=0,this._state=this.AWAITING_CHUNK}AWAITING_CHUNK(e){return 2<=e.remaining()?this._onHeader(e.readUInt16()):(this._partialChunkHeader=e.readUInt8()<<8,this.IN_HEADER)}IN_HEADER(e){return this._onHeader(65535&(this._partialChunkHeader|e.readUInt8()))}IN_CHUNK(e){return this._chunkSize<=e.remaining()?(this._currentMessage.push(e.readSlice(this._chunkSize)),this.AWAITING_CHUNK):(this._chunkSize-=e.remaining(),this._currentMessage.push(e.readSlice(e.remaining())),this.IN_CHUNK)}CLOSED(e){}_onHeader(e){if(0!==e)return this._chunkSize=e,this.IN_CHUNK;{let e;switch(this._currentMessage.length){case 0:return this.AWAITING_CHUNK;case 1:e=this._currentMessage[0];break;default:e=new CombinedBuffer(this._currentMessage)}return this._currentMessage=[],this.onmessage(e),this.AWAITING_CHUNK}}write(e){for(;e.hasRemaining();)this._state=this._state(e)}}const{ENCRYPTION_OFF,ENCRYPTION_ON}=internal["util"],SERVICE_UNAVAILABLE$4=error["SERVICE_UNAVAILABLE"],ALLOWED_VALUES_ENCRYPTED=[null,void 0,!0,!1,ENCRYPTION_ON,ENCRYPTION_OFF],ALLOWED_VALUES_TRUST=[null,void 0,"TRUST_ALL_CERTIFICATES","TRUST_CUSTOM_CA_SIGNED_CERTIFICATES","TRUST_SYSTEM_CA_SIGNED_CERTIFICATES"];class ChannelConfig{constructor(e,t,r){this.address=e,this.encrypted=extractEncrypted(t),this.trust=extractTrust(t),this.trustedCertificates=extractTrustedCertificates(t),this.knownHostsPath=extractKnownHostsPath(t),this.connectionErrorCode=r||SERVICE_UNAVAILABLE$4,this.connectionTimeout=t.connectionTimeout}}function extractEncrypted(e){e=e.encrypted;if(-1===ALLOWED_VALUES_ENCRYPTED.indexOf(e))throw newError(`Illegal value of the encrypted setting ${e}. Expected one of `+ALLOWED_VALUES_ENCRYPTED);return e}function extractTrust(e){e=e.trust;if(-1===ALLOWED_VALUES_TRUST.indexOf(e))throw newError(`Illegal value of the trust setting ${e}. Expected one of `+ALLOWED_VALUES_TRUST);return e}function extractTrustedCertificates(e){return e.trustedCertificates||[]}function extractKnownHostsPath(e){return e.knownHosts||null}var safeBuffer={exports:{}},Buffer=(!function(e,t){var r=buffer,n=r.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function i(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=i),i.prototype=Object.create(n.prototype),o(n,i),i.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},i.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=n(e);return void 0!==t?"string"==typeof r?e.fill(t,r):e.fill(t):e.fill(0),e},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}(safeBuffer,safeBuffer.exports),safeBuffer.exports.Buffer),isEncoding=Buffer.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function _normalizeEncoding(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function normalizeEncoding(e){var t=_normalizeEncoding(e);if("string"==typeof t||Buffer.isEncoding!==isEncoding&&isEncoding(e))return t||e;throw new Error("Unknown encoding: "+e)}var StringDecoder_1=StringDecoder;function StringDecoder(e){var t;switch(this.encoding=normalizeEncoding(e),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,t=4;break;case"utf8":this.fillLast=utf8FillLast,t=4;break;case"base64":this.text=base64Text,this.end=base64End,t=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(t)}function utf8CheckByte(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function utf8CheckIncomplete(e,t,r){var n,o=t.length-1;return o<r?0:0<=(n=utf8CheckByte(t[o]))?(0<n&&(e.lastNeed=n-1),n):--o<r||-2===n?0:0<=(n=utf8CheckByte(t[o]))?(0<n&&(e.lastNeed=n-2),n):!(--o<r||-2===n)&&0<=(n=utf8CheckByte(t[o]))?(0<n&&(2===n?n=0:e.lastNeed=n-3),n):0}function utf8CheckExtraBytes(e,t,r){return 128!=(192&t[0])?(e.lastNeed=0,"�"):1<e.lastNeed&&1<t.length?128!=(192&t[1])?(e.lastNeed=1,"�"):2<e.lastNeed&&2<t.length&&128!=(192&t[2])?(e.lastNeed=2,"�"):void 0:void 0}function utf8FillLast(e){var t=this.lastTotal-this.lastNeed,r=utf8CheckExtraBytes(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function utf8Text(e,t){var r=utf8CheckIncomplete(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;r=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)}function utf8End(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+"�":e}function utf16Text(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);t=e.toString("utf16le",t);if(t){var r=t.charCodeAt(t.length-1);if(55296<=r&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],t.slice(0,-1)}return t}function utf16End(e){var t,e=e&&e.length?this.write(e):"";return this.lastNeed?(t=this.lastTotal-this.lastNeed,e+this.lastChar.toString("utf16le",0,t)):e}function base64Text(e,t){var r=(e.length-t)%3;return 0==r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function base64End(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(e){return e.toString(this.encoding)}function simpleEnd(e){return e&&e.length?this.write(e):""}StringDecoder.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},StringDecoder.prototype.end=utf8End,StringDecoder.prototype.text=utf8Text,StringDecoder.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};const decoder=new StringDecoder_1("utf8");function encode(e){return new ChannelBuffer(newBuffer(e))}function decode(e,t){if(Object.prototype.hasOwnProperty.call(e,"_buffer"))return decodeChannelBuffer(e,t);if(Object.prototype.hasOwnProperty.call(e,"_buffers"))return decodeCombinedBuffer(e,t);throw newError(`Don't know how to decode strings from '${e}'`)}function decodeChannelBuffer(e,t){var r=e.position,t=r+t;return e.position=Math.min(t,e.length),e._buffer.toString("utf8",r,t)}function decodeCombinedBuffer(e,t){return streamDecodeCombinedBuffer(e,t,e=>decoder.write(e._buffer),()=>decoder.end())}function streamDecodeCombinedBuffer(e,t,o,r){let i=t,s=e.position;return e._updatePos(Math.min(t,e.length-s)),e._buffers.reduce(function(e,t){var r,n;return i<=0?e:s>=t.length?(s-=t.length,""):(t._updatePos(s-t.position),r=Math.min(t.length-s,i),n=t.readSlice(r),t._updatePos(r),i=Math.max(i-n.length,0),s=0,e+o(n))},"")+r()}function newBuffer(e){return"function"==typeof buffer.Buffer.from?buffer.Buffer.from(e,"utf8"):new buffer.Buffer(e,"utf8")}var utf8={encode:encode,decode:decode},index$4=Object.freeze({__proto__:null,ChannelConfig:ChannelConfig,alloc:alloc,utf8:utf8,Channel:Channel,HostNameResolver:HostNameResolver,Chunker:Chunker,Dechunker:Dechunker});const BOLT_MAGIC_PREAMBLE=1616949271;function version(e,t){return{major:e,minor:t}}function createHandshakeMessage(e){if(4<e.length)throw newError("It should not have more than 4 versions of the protocol");const o=alloc(20);return o.writeInt32(BOLT_MAGIC_PREAMBLE),e.forEach(e=>{var t,r,n;e instanceof Array?({major:t,minor:n}=e[0],r=e[1]["minor"],r=n-r,o.writeInt32(r<<16|n<<8|t)):({major:r,minor:n}=e,o.writeInt32(n<<8|r))}),o.reset(),o}function parseNegotiatedResponse(e,t){e=[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()];if(72===e[0]&&84===e[1]&&84===e[2]&&80===e[3])throw t.error("Handshake failed since server responded with HTTP."),newError("Server responded HTTP. Make sure you are not trying to connect to the http endpoint (HTTP defaults to port 7474 whereas BOLT defaults to port 7687)");return Number(e[3]+"."+e[2])}function newHandshakeBuffer(){return createHandshakeMessage([[version(5,4),version(5,0)],[version(4,4),version(4,2)],version(4,1),version(3,0)])}function handshake(t,o){return new Promise((r,n)=>{var e=e=>{n(e)};t.onerror=e.bind(this),t._error&&e(t._error),t.onmessage=t=>{try{var e=parseNegotiatedResponse(t,o);r({protocolVersion:e,consumeRemainingBuffer:e=>{t.hasRemaining()&&e(t.readSlice(t.remaining()))}})}catch(e){n(e)}},t.write(newHandshakeBuffer())})}class RawRoutingTable$1{static ofRecord(e){return null===e?RawRoutingTable$1.ofNull():new RecordRawRoutingTable(e)}static ofMessageResponse(e){return null===e?RawRoutingTable$1.ofNull():new ResponseRawRoutingTable(e)}static ofNull(){return new NullRawRoutingTable}get ttl(){throw new Error("Not implemented")}get db(){throw new Error("Not implemented")}get servers(){throw new Error("Not implemented")}get isNull(){throw new Error("Not implemented")}}class ResponseRawRoutingTable extends RawRoutingTable$1{constructor(e){super(),this._response=e}get ttl(){return this._response.rt.ttl}get servers(){return this._response.rt.servers}get db(){return this._response.rt.db}get isNull(){return null===this._response}}class NullRawRoutingTable extends RawRoutingTable$1{get isNull(){return!0}}class RecordRawRoutingTable extends RawRoutingTable$1{constructor(e){super(),this._record=e}get ttl(){return this._record.get("ttl")}get servers(){return this._record.get("servers")}get db(){return this._record.has("db")?this._record.get("db"):null}get isNull(){return null===this._record}}const{FETCH_ALL:FETCH_ALL$4}=internal["constants"],PROTOCOL_ERROR$5=error["PROTOCOL_ERROR"];class StreamObserver{onNext(e){}onError(e){}onCompleted(e){}}class ResultStreamObserver extends StreamObserver{constructor({reactive:e=!1,moreFunction:t,discardFunction:r,fetchSize:n=FETCH_ALL$4,beforeError:o,afterError:i,beforeKeys:s,afterKeys:a,beforeComplete:u,afterComplete:l,server:c,highRecordWatermark:h=Number.MAX_VALUE,lowRecordWatermark:_=Number.MAX_VALUE}={}){super(),this._fieldKeys=null,this._fieldLookup=null,this._head=null,this._queuedRecords=[],this._tail=null,this._error=null,this._observers=[],this._meta={},this._server=c,this._beforeError=o,this._afterError=i,this._beforeKeys=s,this._afterKeys=a,this._beforeComplete=u,this._afterComplete=l,this._queryId=null,this._moreFunction=t,this._discardFunction=r,this._discard=!1,this._fetchSize=n,this._lowRecordWatermark=_,this._highRecordWatermark=h,this._setState(e?_states.READY:_states.READY_STREAMING),this._setupAutoPull(),this._paused=!1}pause(){this._paused=!0}resume(){this._paused=!1,this._setupAutoPull(!0),this._state.pull(this)}onNext(e){const t=new Record(this._fieldKeys,e,this._fieldLookup);this._observers.some(e=>e.onNext)?this._observers.forEach(e=>{e.onNext&&e.onNext(t)}):(this._queuedRecords.push(t),this._queuedRecords.length>this._highRecordWatermark&&(this._autoPull=!1))}onCompleted(e){this._state.onSuccess(this,e)}onError(e){this._state.onError(this,e)}cancel(){this._discard=!0}prepareToHandleSingleResponse(){this._head=[],this._fieldKeys=[],this._setState(_states.STREAMING)}markCompleted(){this._head=[],this._fieldKeys=[],this._tail={},this._setState(_states.SUCCEEDED)}subscribe(t){if(this._head&&t.onKeys&&t.onKeys(this._head),0<this._queuedRecords.length&&t.onNext)for(let e=0;e<this._queuedRecords.length;e++)t.onNext(this._queuedRecords[e]),this._queuedRecords.length-e-1<=this._lowRecordWatermark&&(this._autoPull=!0,this._state===_states.READY)&&this._handleStreaming();this._tail&&t.onCompleted&&t.onCompleted(this._tail),this._error&&t.onError(this._error),this._observers.push(t),this._state===_states.READY&&this._handleStreaming()}_handleHasMore(e){this._setState(_states.READY),this._handleStreaming(),delete e.has_more}_handlePullSuccess(e){const t=Object.assign(this._server?{server:this._server}:{},this._meta,e);if([void 0,null,"r","w","rw","s"].includes(t.type)){this._setState(_states.SUCCEEDED);let e=null;this._beforeComplete&&(e=this._beforeComplete(t));const r=()=>{this._tail=t,this._observers.some(e=>e.onCompleted)&&this._observers.forEach(e=>{e.onCompleted&&e.onCompleted(t)}),this._afterComplete&&this._afterComplete(t)};e?Promise.resolve(e).then(()=>r()):r()}else this.onError(newError(`Server returned invalid query type. Expected one of [undefined, null, "r", "w", "rw", "s"] but got '${t.type}'`,PROTOCOL_ERROR$5))}_handleRunSuccess(t,r){if(null===this._fieldKeys){if(this._fieldKeys=[],this._fieldLookup={},t.fields&&0<t.fields.length){this._fieldKeys=t.fields;for(let e=0;e<t.fields.length;e++)this._fieldLookup[t.fields[e]]=e;delete t.fields}null!==t.qid&&void 0!==t.qid&&(this._queryId=t.qid,delete t.qid),this._storeMetadataForCompletion(t);let e=null;this._beforeKeys&&(e=this._beforeKeys(this._fieldKeys));const n=()=>{this._head=this._fieldKeys,this._observers.some(e=>e.onKeys)&&this._observers.forEach(e=>{e.onKeys&&e.onKeys(this._fieldKeys)}),this._afterKeys&&this._afterKeys(this._fieldKeys),r()};e?Promise.resolve(e).then(()=>n()):n()}}_handleError(t){this._setState(_states.FAILED),this._error=t;let e=null;this._beforeError&&(e=this._beforeError(t));const r=()=>{this._observers.some(e=>e.onError)&&this._observers.forEach(e=>{e.onError&&e.onError(t)}),this._afterError&&this._afterError(t)};e?Promise.resolve(e).then(()=>r()):r()}_handleStreaming(){this._head&&this._observers.some(e=>e.onNext||e.onCompleted)&&(this._paused||!this._discard&&!this._autoPull||this._more())}_more(){this._discard?this._discardFunction(this._queryId,this):this._moreFunction(this._queryId,this._fetchSize,this),this._setState(_states.STREAMING)}_storeMetadataForCompletion(e){var t=Object.keys(e);let r=t.length;for(var n;r--;)n=t[r],this._meta[n]=e[n]}_setState(e){this._state=e}_setupAutoPull(){this._autoPull=!0}}class LoginObserver extends StreamObserver{constructor({onError:e,onCompleted:t}={}){super(),this._onError=e,this._onCompleted=t}onNext(e){this.onError(newError("Received RECORD when initializing "+stringify(e)))}onError(e){this._onError&&this._onError(e)}onCompleted(e){this._onCompleted&&this._onCompleted(e)}}class LogoffObserver extends StreamObserver{constructor({onError:e,onCompleted:t}={}){super(),this._onError=e,this._onCompleted=t}onNext(e){this.onError(newError("Received RECORD when logging off "+stringify(e)))}onError(e){this._onError&&this._onError(e)}onCompleted(e){this._onCompleted&&this._onCompleted(e)}}class ResetObserver extends StreamObserver{constructor({onProtocolError:e,onError:t,onComplete:r}={}){super(),this._onProtocolError=e,this._onError=t,this._onComplete=r}onNext(e){this.onError(newError("Received RECORD when resetting: received record is: "+stringify(e),PROTOCOL_ERROR$5))}onError(e){e.code===PROTOCOL_ERROR$5&&this._onProtocolError&&this._onProtocolError(e.message),this._onError&&this._onError(e)}onCompleted(e){this._onComplete&&this._onComplete(e)}}class TelemetryObserver extends ResultStreamObserver{constructor({onError:e,onCompleted:t}={}){super(),this._onError=e,this._onCompleted=t}onNext(e){this.onError(newError("Received RECORD when sending telemetry "+stringify(e),PROTOCOL_ERROR$5))}onError(e){this._onError&&this._onError(e)}onCompleted(e){this._onCompleted&&this._onCompleted(e)}}class FailedObserver extends ResultStreamObserver{constructor({error:e,onError:t}){super({beforeError:t}),this.onError(e)}}class CompletedObserver extends ResultStreamObserver{constructor(){super(),super.markCompleted()}}class ProcedureRouteObserver extends StreamObserver{constructor({resultObserver:e,onProtocolError:t,onError:r,onCompleted:n}){super(),this._resultObserver=e,this._onError=r,this._onCompleted=n,this._records=[],this._onProtocolError=t,e.subscribe(this)}onNext(e){this._records.push(e)}onError(e){e.code===PROTOCOL_ERROR$5&&this._onProtocolError&&this._onProtocolError(e.message),this._onError&&this._onError(e)}onCompleted(){null!==this._records&&1!==this._records.length?this.onError(newError("Illegal response from router. Received "+this._records.length+" records but expected only one.\n"+stringify(this._records),PROTOCOL_ERROR$5)):this._onCompleted&&this._onCompleted(RawRoutingTable$1.ofRecord(this._records[0]))}}class RouteObserver extends StreamObserver{constructor({onProtocolError:e,onError:t,onCompleted:r}={}){super(),this._onProtocolError=e,this._onError=t,this._onCompleted=r}onNext(e){this.onError(newError("Received RECORD when resetting: received record is: "+stringify(e),PROTOCOL_ERROR$5))}onError(e){e.code===PROTOCOL_ERROR$5&&this._onProtocolError&&this._onProtocolError(e.message),this._onError&&this._onError(e)}onCompleted(e){this._onCompleted&&this._onCompleted(RawRoutingTable$1.ofMessageResponse(e))}}const _states={READY_STREAMING:{onSuccess:(e,t)=>{e._handleRunSuccess(t,()=>{e._setState(_states.STREAMING)})},onError:(e,t)=>{e._handleError(t)},name:()=>"READY_STREAMING",pull:()=>{}},READY:{onSuccess:(e,t)=>{e._handleRunSuccess(t,()=>e._handleStreaming())},onError:(e,t)=>{e._handleError(t)},name:()=>"READY",pull:e=>e._more()},STREAMING:{onSuccess:(e,t)=>{t.has_more?e._handleHasMore(t):e._handlePullSuccess(t)},onError:(e,t)=>{e._handleError(t)},name:()=>"STREAMING",pull:()=>{}},FAILED:{onError:e=>{},name:()=>"FAILED",pull:()=>{}},SUCCEEDED:{name:()=>"SUCCEEDED",pull:()=>{}}};function assertTxConfigIsEmpty(e,t=()=>{},r){if(e&&!e.isEmpty())throw t((e=newError("Driver is connected to the database that does not support transaction configuration. Please upgrade to neo4j 3.5.0 or later in order to use this functionality")).message),r.onError(e),e}function assertDatabaseIsEmpty(e,t=()=>{},r){if(e)throw t((e=newError("Driver is connected to the database that does not support multiple databases. Please upgrade to neo4j 4.0.0 or later in order to use this functionality")).message),r.onError(e),e}function assertImpersonatedUserIsEmpty(e,t=()=>{},r){if(e)throw t((t=newError("Driver is connected to the database that does not support user impersonation. Please upgrade to neo4j 4.4.0 or later in order to use this functionality. "+`Trying to impersonate ${e}.`)).message),r.onError(t),t}function assertNotificationFilterIsEmpty(e,t=()=>{},r){if(void 0!==e)throw t((t=newError("Driver is connected to a database that does not support user notification filters. Please upgrade to Neo4j 5.7.0 or later in order to use this functionality. "+`Trying to set notifications to ${stringify(e)}.`)).message),r.onError(t),t}function identity(e){return e}function reuseOngoingRequest(r,n=null){const o=new Map;return function(...e){const t=stringify(e);return o.has(t)?o.get(t):(e=r.apply(n,e),o.set(t,e),e.finally(()=>{o.delete(t)}))}}function equals(e,t){if(e!==t){if(null===e||null===t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const o of r)if(e[o]!==t[o])return!1}return!0}const PROTOCOL_ERROR$4=error["PROTOCOL_ERROR"];class Structure{constructor(e,t){this.signature=e,this.fields=t}get size(){return this.fields.length}toString(){let t="";for(let e=0;e<this.fields.length;e++)0<e&&(t+=", "),t+=this.fields[e];return"Structure("+this.signature+", ["+t+"])"}}function verifyStructSize(e,t,r){if(t!==r)throw newError(`Wrong struct size for ${e}, expected ${t} but was `+r,PROTOCOL_ERROR$4)}var structure=Object.freeze({__proto__:null,Structure:Structure,verifyStructSize:verifyStructSize,default:Structure});const PROTOCOL_ERROR$3=error["PROTOCOL_ERROR"],TINY_STRING=128,TINY_LIST=144,TINY_MAP=160,TINY_STRUCT=176,NULL=192,FLOAT_64=193,FALSE=194,TRUE=195,INT_8=200,INT_16=201,INT_32=202,INT_64=203,STRING_8=208,STRING_16=209,STRING_32=210,LIST_8=212,LIST_16=213,LIST_32=214,BYTES_8=204,BYTES_16=205,BYTES_32=206,MAP_8=216,MAP_16=217,MAP_32=218,STRUCT_8=220,STRUCT_16=221;class Packer$1{constructor(e){this._ch=e,this._byteArraysSupported=!0}packable(o,i=identity){try{o=i(o)}catch(e){return()=>{throw e}}if(null===o)return()=>this._ch.writeUInt8(NULL);if(!0===o)return()=>this._ch.writeUInt8(TRUE);if(!1===o)return()=>this._ch.writeUInt8(FALSE);if("number"==typeof o)return()=>this.packFloat(o);if("string"==typeof o)return()=>this.packString(o);if("bigint"==typeof o)return()=>this.packInteger(int(o));if(isInt(o))return()=>this.packInteger(o);if(o instanceof Int8Array)return()=>this.packBytes(o);if(o instanceof Array)return()=>{this.packListHeader(o.length);for(let e=0;e<o.length;e++)this.packable(void 0===o[e]?null:o[e],i)()};if(isIterable(o))return this.packableIterable(o,i);if(o instanceof Structure){const t=[];for(let e=0;e<o.fields.length;e++)t[e]=this.packable(o.fields[e],i);return()=>this.packStruct(o.signature,t)}return"object"==typeof o?()=>{var t=Object.keys(o);let r=0;for(let e=0;e<t.length;e++)void 0!==o[t[e]]&&r++;this.packMapHeader(r);for(let e=0;e<t.length;e++){var n=t[e];void 0!==o[n]&&(this.packString(n),this.packable(o[n],i)())}}:this._nonPackableValue("Unable to pack the given value: "+o)}packableIterable(t,e){try{var r=Array.from(t);return this.packable(r,e)}catch(e){throw newError(`Cannot pack given iterable, ${e.message}: `+t)}}packStruct(e,t){this.packStructHeader((t=t||[]).length,e);for(let e=0;e<t.length;e++)t[e]()}packInteger(e){var t=e.high,r=e.low;e.greaterThanOrEqual(-16)&&e.lessThan(128)?this._ch.writeInt8(r):e.greaterThanOrEqual(-128)&&e.lessThan(-16)?(this._ch.writeUInt8(INT_8),this._ch.writeInt8(r)):e.greaterThanOrEqual(-32768)&&e.lessThan(32768)?(this._ch.writeUInt8(INT_16),this._ch.writeInt16(r)):(e.greaterThanOrEqual(-2147483648)&&e.lessThan(2147483648)?this._ch.writeUInt8(INT_32):(this._ch.writeUInt8(INT_64),this._ch.writeInt32(t)),this._ch.writeInt32(r))}packFloat(e){this._ch.writeUInt8(FLOAT_64),this._ch.writeFloat64(e)}packString(e){var e=utf8.encode(e),t=e.length;if(t<16)this._ch.writeUInt8(TINY_STRING|t);else if(t<256)this._ch.writeUInt8(STRING_8),this._ch.writeUInt8(t);else{if(t<65536)this._ch.writeUInt8(STRING_16),this._ch.writeUInt8(t/256>>0);else{if(!(t<4294967296))throw newError("UTF-8 strings of size "+t+" are not supported");this._ch.writeUInt8(STRING_32),this._ch.writeUInt8((t/16777216>>0)%256),this._ch.writeUInt8((t/65536>>0)%256),this._ch.writeUInt8((t/256>>0)%256)}this._ch.writeUInt8(t%256)}this._ch.writeBytes(e)}packListHeader(e){if(e<16)this._ch.writeUInt8(TINY_LIST|e);else if(e<256)this._ch.writeUInt8(LIST_8),this._ch.writeUInt8(e);else{if(e<65536)this._ch.writeUInt8(LIST_16);else{if(!(e<4294967296))throw newError("Lists of size "+e+" are not supported");this._ch.writeUInt8(LIST_32),this._ch.writeUInt8((e/16777216>>0)%256),this._ch.writeUInt8((e/65536>>0)%256)}this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)}}packBytes(t){if(!this._byteArraysSupported)throw newError("Byte arrays are not supported by the database this driver is connected to");this.packBytesHeader(t.length);for(let e=0;e<t.length;e++)this._ch.writeInt8(t[e])}packBytesHeader(e){if(e<256)this._ch.writeUInt8(BYTES_8),this._ch.writeUInt8(e);else{if(e<65536)this._ch.writeUInt8(BYTES_16);else{if(!(e<4294967296))throw newError("Byte arrays of size "+e+" are not supported");this._ch.writeUInt8(BYTES_32),this._ch.writeUInt8((e/16777216>>0)%256),this._ch.writeUInt8((e/65536>>0)%256)}this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)}}packMapHeader(e){if(e<16)this._ch.writeUInt8(TINY_MAP|e);else if(e<256)this._ch.writeUInt8(MAP_8),this._ch.writeUInt8(e);else{if(e<65536)this._ch.writeUInt8(MAP_16),this._ch.writeUInt8(e/256>>0);else{if(!(e<4294967296))throw newError("Maps of size "+e+" are not supported");this._ch.writeUInt8(MAP_32),this._ch.writeUInt8((e/16777216>>0)%256),this._ch.writeUInt8((e/65536>>0)%256),this._ch.writeUInt8((e/256>>0)%256)}this._ch.writeUInt8(e%256)}}packStructHeader(e,t){if(e<16)this._ch.writeUInt8(TINY_STRUCT|e),this._ch.writeUInt8(t);else if(e<256)this._ch.writeUInt8(STRUCT_8),this._ch.writeUInt8(e),this._ch.writeUInt8(t);else{if(!(e<65536))throw newError("Structures of size "+e+" are not supported");this._ch.writeUInt8(STRUCT_16),this._ch.writeUInt8(e/256>>0),this._ch.writeUInt8(e%256)}}disableByteArrays(){this._byteArraysSupported=!1}_nonPackableValue(e){return()=>{throw newError(e,PROTOCOL_ERROR$3)}}}class Unpacker$1{constructor(e=!1,t=!1){this._disableLosslessIntegers=e,this._useBigInt=t}unpack(e,t=identity){var r=e.readUInt8(),n=240&r,o=15&r;if(r===NULL)return null;var i=this._unpackBoolean(r);if(null!==i)return i;i=this._unpackNumberOrInteger(r,e);if(null!==i){if(isInt(i)){if(this._useBigInt)return i.toBigInt();if(this._disableLosslessIntegers)return i.toNumberOrInfinity()}return i}i=this._unpackString(r,n,o,e);if(null!==i)return i;i=this._unpackList(r,n,o,e,t);if(null!==i)return i;i=this._unpackByteArray(r,e);if(null!==i)return i;i=this._unpackMap(r,n,o,e,t);if(null!==i)return i;i=this._unpackStruct(r,n,o,e,t);if(null!==i)return i;throw newError("Unknown packed value with marker "+r.toString(16))}unpackInteger(e){var t=e.readUInt8(),e=this._unpackInteger(t,e);if(null==e)throw newError("Unable to unpack integer value with marker "+t.toString(16));return e}_unpackBoolean(e){return e===TRUE||e!==FALSE&&null}_unpackNumberOrInteger(e,t){return e===FLOAT_64?t.readFloat64():this._unpackInteger(e,t)}_unpackInteger(e,t){var r;return 0<=e&&e<128?int(e):240<=e&&e<256?int(e-256):e===INT_8?int(t.readInt8()):e===INT_16?int(t.readInt16()):e===INT_32?(r=t.readInt32(),int(r)):e===INT_64?(r=t.readInt32(),e=t.readInt32(),new Integer(e,r)):null}_unpackString(e,t,r,n){return t===TINY_STRING?utf8.decode(n,r):e===STRING_8?utf8.decode(n,n.readUInt8()):e===STRING_16?utf8.decode(n,n.readUInt16()):e===STRING_32?utf8.decode(n,n.readUInt32()):null}_unpackList(e,t,r,n,o){return t===TINY_LIST?this._unpackListWithSize(r,n,o):e===LIST_8?this._unpackListWithSize(n.readUInt8(),n,o):e===LIST_16?this._unpackListWithSize(n.readUInt16(),n,o):e===LIST_32?this._unpackListWithSize(n.readUInt32(),n,o):null}_unpackListWithSize(t,r,n){var o=[];for(let e=0;e<t;e++)o.push(this.unpack(r,n));return o}_unpackByteArray(e,t){return e===BYTES_8?this._unpackByteArrayWithSize(t.readUInt8(),t):e===BYTES_16?this._unpackByteArrayWithSize(t.readUInt16(),t):e===BYTES_32?this._unpackByteArrayWithSize(t.readUInt32(),t):null}_unpackByteArrayWithSize(t,r){var n=new Int8Array(t);for(let e=0;e<t;e++)n[e]=r.readInt8();return n}_unpackMap(e,t,r,n,o){return t===TINY_MAP?this._unpackMapWithSize(r,n,o):e===MAP_8?this._unpackMapWithSize(n.readUInt8(),n,o):e===MAP_16?this._unpackMapWithSize(n.readUInt16(),n,o):e===MAP_32?this._unpackMapWithSize(n.readUInt32(),n,o):null}_unpackMapWithSize(t,r,n){var o={};for(let e=0;e<t;e++)o[this.unpack(r,n)]=this.unpack(r,n);return o}_unpackStruct(e,t,r,n,o){return t===TINY_STRUCT?this._unpackStructWithSize(r,n,o):e===STRUCT_8?this._unpackStructWithSize(n.readUInt8(),n,o):e===STRUCT_16?this._unpackStructWithSize(n.readUInt16(),n,o):null}_unpackStructWithSize(t,r,n){var e=r.readUInt8(),o=new Structure(e,[]);for(let e=0;e<t;e++)o.fields.push(this.unpack(r,n));return n(o)}}function isIterable(e){return null!=e&&"function"==typeof e[Symbol.iterator]}var packstreamV1=Object.freeze({__proto__:null,Packer:Packer$1,Unpacker:Unpacker$1});class Packer extends Packer$1{disableByteArrays(){throw new Error("Bolt V2 should always support byte arrays")}}class Unpacker extends Unpacker$1{constructor(e=!1,t=!1){super(e,t)}}var v2$1=Object.freeze({__proto__:null,Packer:Packer,Unpacker:Unpacker}),index$3=Object.freeze({__proto__:null,v1:packstreamV1,v2:v2$1,structure:structure,default:v2$1});const{constants:{ACCESS_MODE_READ,FETCH_ALL:FETCH_ALL$3},util:{assertString}}=internal,INIT=1,RESET=15,RUN=16,PULL_ALL=63,HELLO=1,GOODBYE=2,BEGIN=17,COMMIT=18,ROLLBACK=19,TELEMETRY=84,ROUTE=102,LOGON=106,LOGOFF=107,DISCARD=47,PULL=63,READ_MODE="r",NO_STATEMENT_ID=-1,SIGNATURES=Object.freeze({INIT:INIT,RESET:RESET,RUN:RUN,PULL_ALL:PULL_ALL,HELLO:HELLO,GOODBYE:GOODBYE,BEGIN:BEGIN,COMMIT:COMMIT,ROLLBACK:ROLLBACK,TELEMETRY:TELEMETRY,ROUTE:ROUTE,LOGON:LOGON,LOGOFF:LOGOFF,DISCARD:DISCARD,PULL:PULL});class RequestMessage{constructor(e,t,r){this.signature=e,this.fields=t,this.toString=r}static init(e,t){return new RequestMessage(INIT,[e,t],()=>`INIT ${e} {...}`)}static run(e,t){return new RequestMessage(RUN,[e,t],()=>`RUN ${e} `+stringify(t))}static pullAll(){return PULL_ALL_MESSAGE}static reset(){return RESET_MESSAGE}static hello(e,t,r=null,n=null){t=Object.assign({user_agent:e},t);return r&&(t.routing=r),n&&(t.patch_bolt=n),new RequestMessage(HELLO,[t],()=>`HELLO {user_agent: '${e}', ...}`)}static hello5x1(e,t=null){var r={user_agent:e};return t&&(r.routing=t),new RequestMessage(HELLO,[r],()=>`HELLO {user_agent: '${e}', ...}`)}static hello5x2(e,t=null,r=null){const n={user_agent:e};return t&&(t.minimumSeverityLevel&&(n.notifications_minimum_severity=t.minimumSeverityLevel),t.disabledCategories)&&(n.notifications_disabled_categories=t.disabledCategories),r&&(n.routing=r),new RequestMessage(HELLO,[n],()=>"HELLO "+stringify(n))}static hello5x3(e,t,r=null,n=null){const o={};return e&&(o.user_agent=e),t&&(o.bolt_agent={product:t.product,platform:t.platform,language:t.language,language_details:t.languageDetails}),r&&(r.minimumSeverityLevel&&(o.notifications_minimum_severity=r.minimumSeverityLevel),r.disabledCategories)&&(o.notifications_disabled_categories=r.disabledCategories),n&&(o.routing=n),new RequestMessage(HELLO,[o],()=>"HELLO "+stringify(o))}static logon(e){return new RequestMessage(LOGON,[e],()=>"LOGON { ... }")}static logoff(){return new RequestMessage(LOGOFF,[],()=>"LOGOFF")}static begin({bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o,notificationFilter:i}={}){const s=buildTxMetadata(e,t,r,n,o,i);return new RequestMessage(BEGIN,[s],()=>"BEGIN "+stringify(s))}static commit(){return COMMIT_MESSAGE}static rollback(){return ROLLBACK_MESSAGE}static runWithMetadata(e,t,{bookmarks:r,txConfig:n,database:o,mode:i,impersonatedUser:s,notificationFilter:a}={}){const u=buildTxMetadata(r,n,o,i,s,a);return new RequestMessage(RUN,[e,t,u],()=>`RUN ${e} ${stringify(t)} `+stringify(u))}static goodbye(){return GOODBYE_MESSAGE}static pull({stmtId:e=NO_STATEMENT_ID,n:t=FETCH_ALL$3}={}){const r=buildStreamMetadata(null==e?NO_STATEMENT_ID:e,t||FETCH_ALL$3);return new RequestMessage(PULL,[r],()=>"PULL "+stringify(r))}static discard({stmtId:e=NO_STATEMENT_ID,n:t=FETCH_ALL$3}={}){const r=buildStreamMetadata(null==e?NO_STATEMENT_ID:e,t||FETCH_ALL$3);return new RequestMessage(DISCARD,[r],()=>"DISCARD "+stringify(r))}static telemetry({api:e}){const t=int(e);return new RequestMessage(TELEMETRY,[t],()=>"TELEMETRY "+t.toString())}static route(e={},t=[],r=null){return new RequestMessage(ROUTE,[e,t,r],()=>`ROUTE ${stringify(e)} ${stringify(t)} `+r)}static routeV4x4(e={},t=[],r={}){const n={};return r.databaseName&&(n.db=r.databaseName),r.impersonatedUser&&(n.imp_user=r.impersonatedUser),new RequestMessage(ROUTE,[e,t,n],()=>`ROUTE ${stringify(e)} ${stringify(t)} `+stringify(n))}}function buildTxMetadata(e,t,r,n,o,i){var s={};return e.isEmpty()||(s.bookmarks=e.values()),null!==t.timeout&&(s.tx_timeout=t.timeout),t.metadata&&(s.tx_metadata=t.metadata),r&&(s.db=assertString(r,"database")),o&&(s.imp_user=assertString(o,"impersonatedUser")),n===ACCESS_MODE_READ&&(s.mode=READ_MODE),i&&(i.minimumSeverityLevel&&(s.notifications_minimum_severity=i.minimumSeverityLevel),i.disabledCategories)&&(s.notifications_disabled_categories=i.disabledCategories),s}function buildStreamMetadata(e,t){t={n:int(t)};return e!==NO_STATEMENT_ID&&(t.qid=int(e)),t}const PULL_ALL_MESSAGE=new RequestMessage(PULL_ALL,[],()=>"PULL_ALL"),RESET_MESSAGE=new RequestMessage(RESET,[],()=>"RESET"),COMMIT_MESSAGE=new RequestMessage(COMMIT,[],()=>"COMMIT"),ROLLBACK_MESSAGE=new RequestMessage(ROLLBACK,[],()=>"ROLLBACK"),GOODBYE_MESSAGE=new RequestMessage(GOODBYE,[],()=>"GOODBYE"),objectUtil=internal["objectUtil"];class Transformer{constructor(e){this._transformers=e,this._transformersPerSignature=new Map(e.map(e=>[e.signature,e])),this.fromStructure=this.fromStructure.bind(this),this.toStructure=this.toStructure.bind(this),Object.freeze(this)}fromStructure(e){try{var t;return e instanceof Structure&&this._transformersPerSignature.has(e.signature)?(t=this._transformersPerSignature.get(e.signature)["fromStructure"],t(e)):e}catch(e){return objectUtil.createBrokenObject(e)}}toStructure(t){var e=this._transformers.find(({isTypeInstance:e})=>e(t));return void 0!==e?e.toStructure(t):t}}class TypeTransformer{constructor({signature:e,fromStructure:t,toStructure:r,isTypeInstance:n}){this.signature=e,this.isTypeInstance=n,this.fromStructure=t,this.toStructure=r,Object.freeze(this)}extendsWith({signature:e,fromStructure:t,toStructure:r,isTypeInstance:n}){return new TypeTransformer({signature:e||this.signature,fromStructure:t||this.fromStructure,toStructure:r||this.toStructure,isTypeInstance:n||this.isTypeInstance})}}const PROTOCOL_ERROR$2=error["PROTOCOL_ERROR"],NODE=78,NODE_STRUCT_SIZE$1=3,RELATIONSHIP=82,RELATIONSHIP_STRUCT_SIZE$1=5,UNBOUND_RELATIONSHIP=114,UNBOUND_RELATIONSHIP_STRUCT_SIZE$1=3,PATH=80,PATH_STRUCT_SIZE=3;function createNodeTransformer$1(){return new TypeTransformer({signature:NODE,isTypeInstance:e=>e instanceof Node,toStructure:e=>{throw newError("It is not allowed to pass nodes in query parameters, given: "+e,PROTOCOL_ERROR$2)},fromStructure:e=>{verifyStructSize("Node",NODE_STRUCT_SIZE$1,e.size);var[e,t,r]=e.fields;return new Node(e,t,r)}})}function createRelationshipTransformer$1(){return new TypeTransformer({signature:RELATIONSHIP,isTypeInstance:e=>e instanceof Relationship,toStructure:e=>{throw newError("It is not allowed to pass relationships in query parameters, given: "+e,PROTOCOL_ERROR$2)},fromStructure:e=>{verifyStructSize("Relationship",RELATIONSHIP_STRUCT_SIZE$1,e.size);var[e,t,r,n,o]=e.fields;return new Relationship(e,t,r,n,o)}})}function createUnboundRelationshipTransformer$1(){return new TypeTransformer({signature:UNBOUND_RELATIONSHIP,isTypeInstance:e=>e instanceof UnboundRelationship,toStructure:e=>{throw newError("It is not allowed to pass unbound relationships in query parameters, given: "+e,PROTOCOL_ERROR$2)},fromStructure:e=>{verifyStructSize("UnboundRelationship",UNBOUND_RELATIONSHIP_STRUCT_SIZE$1,e.size);var[e,t,r]=e.fields;return new UnboundRelationship(e,t,r)}})}function createPathTransformer(){return new TypeTransformer({signature:PATH,isTypeInstance:e=>e instanceof Path,toStructure:e=>{throw newError("It is not allowed to pass paths in query parameters, given: "+e,PROTOCOL_ERROR$2)},fromStructure:e=>{verifyStructSize("Path",PATH_STRUCT_SIZE,e.size);var[r,n,o]=e.fields,i=[];let s=r[0];for(let t=0;t<o.length;t+=2){var a=r[o[t+1]],u=toNumber(o[t]);let e;0<u?(e=n[u-1])instanceof UnboundRelationship&&(n[u-1]=e=e.bindTo(s,a)):(e=n[-u-1])instanceof UnboundRelationship&&(n[-u-1]=e=e.bindTo(a,s)),i.push(new PathSegment(s,e,a)),s=a}return new Path(r[0],r[r.length-1],i)}})}var v1={createNodeTransformer:createNodeTransformer$1,createRelationshipTransformer:createRelationshipTransformer$1,createUnboundRelationshipTransformer:createUnboundRelationshipTransformer$1,createPathTransformer:createPathTransformer};const{bookmarks:{Bookmarks:Bookmarks$5},constants:{ACCESS_MODE_WRITE,BOLT_PROTOCOL_V1},logger:{Logger:Logger$2},txConfig:{TxConfig:TxConfig$2}}=internal;class BoltProtocol$d{constructor(e,t,{disableLosslessIntegers:r,useBigInt:n}={},o=()=>null,i,s){this._server=e||{},this._chunker=t,this._packer=this._createPacker(t),this._unpacker=this._createUnpacker(r,n),this._responseHandler=o(this),this._log=i,this._onProtocolError=s,this._fatalError=null,this._lastMessageSignature=null,this._config={disableLosslessIntegers:r,useBigInt:n}}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v1).map(e=>e(this._config,this._log)))),this._transformer}get version(){return BOLT_PROTOCOL_V1}get supportsReAuth(){return!1}get initialized(){return!!this._initialized}get authToken(){return this._authToken}packer(){return this._packer}packable(e){return this._packer.packable(e,this.transformer.toStructure)}unpacker(){return this._unpacker}unpack(e){return this._unpacker.unpack(e,this.transformer.fromStructure)}transformMetadata(e){return e}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){var i=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>this._onLoginCompleted(e,o)});return assertNotificationFilterIsEmpty(r,this._onProtocolError,i),this.write(RequestMessage.init(e,t),i,!0),i}logoff({onComplete:e,onError:t}={}){e=new LogoffObserver({onCompleted:e,onError:t}),t=newError("Driver is connected to a database that does not support logoff. Please upgrade to Neo4j 5.5.0 or later in order to use this functionality.");throw this._onProtocolError(t.message),e.onError(t),t}logon({authToken:e,onComplete:t,onError:r}={}){var n=new LoginObserver({onCompleted:()=>this._onLoginCompleted({},e,t),onError:e=>this._onLoginError(e,r)}),o=newError("Driver is connected to a database that does not support logon. Please upgrade to Neo4j 5.5.0 or later in order to use this functionality.");throw this._onProtocolError(o.message),n.onError(o),o}prepareToClose(){}beginTransaction({bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o,notificationFilter:i,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l}={}){return this.run("BEGIN",e?e.asBeginTransactionParameters():{},{bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o,notificationFilter:i,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l,flush:!1})}commitTransaction({beforeError:e,afterError:t,beforeComplete:r,afterComplete:n}={}){return this.run("COMMIT",{},{bookmarks:Bookmarks$5.empty(),txConfig:TxConfig$2.empty(),mode:ACCESS_MODE_WRITE,beforeError:e,afterError:t,beforeComplete:r,afterComplete:n})}rollbackTransaction({beforeError:e,afterError:t,beforeComplete:r,afterComplete:n}={}){return this.run("ROLLBACK",{},{bookmarks:Bookmarks$5.empty(),txConfig:TxConfig$2.empty(),mode:ACCESS_MODE_WRITE,beforeError:e,afterError:t,beforeComplete:r,afterComplete:n})}run(e,t,{txConfig:r,database:n,impersonatedUser:o,notificationFilter:i,beforeKeys:s,afterKeys:a,beforeError:u,afterError:l,beforeComplete:c,afterComplete:h,flush:_=!0,highRecordWatermark:d=Number.MAX_VALUE,lowRecordWatermark:f=Number.MAX_VALUE}={}){s=new ResultStreamObserver({server:this._server,beforeKeys:s,afterKeys:a,beforeError:u,afterError:l,beforeComplete:c,afterComplete:h,highRecordWatermark:d,lowRecordWatermark:f});return assertTxConfigIsEmpty(r,this._onProtocolError,s),assertDatabaseIsEmpty(n,this._onProtocolError,s),assertImpersonatedUserIsEmpty(o,this._onProtocolError,s),assertNotificationFilterIsEmpty(i,this._onProtocolError,s),this.write(RequestMessage.run(e,t),s,!1),this.write(RequestMessage.pullAll(),s,_),s}get currentFailure(){return this._responseHandler.currentFailure}reset({onError:e,onComplete:t}={}){e=new ResetObserver({onProtocolError:this._onProtocolError,onError:e,onComplete:t});return this.write(RequestMessage.reset(),e,!0),e}telemetry({},{onCompleted:e}={}){var t=new CompletedObserver;return e&&e(),t}_createPacker(e){return new Packer$1(e)}_createUnpacker(e,t){return new Unpacker$1(e,t)}write(e,t,r){this.queueObserverIfProtocolIsNotBroken(t)&&(this._log.isDebugEnabled()&&this._log.debug("C: "+e),this._lastMessageSignature=e.signature,t=new Structure(e.signature,e.fields),this.packable(t)(),this._chunker.messageBoundary(),r)&&this._chunker.flush()}isLastMessageLogon(){return this._lastMessageSignature===SIGNATURES.HELLO||this._lastMessageSignature===SIGNATURES.LOGON}isLastMessageReset(){return this._lastMessageSignature===SIGNATURES.RESET}notifyFatalError(e){return this._fatalError=e,this._responseHandler._notifyErrorToObservers(e)}updateCurrentObserver(){return this._responseHandler._updateCurrentObserver()}hasOngoingObservableRequests(){return this._responseHandler.hasOngoingObservableRequests()}queueObserverIfProtocolIsNotBroken(e){return this.isBroken()?(this.notifyFatalErrorToObserver(e),!1):this._responseHandler._queueObserver(e)}isBroken(){return!!this._fatalError}notifyFatalErrorToObserver(e){e&&e.onError&&e.onError(this._fatalError)}resetFailure(){this._responseHandler._resetFailure()}_onLoginCompleted(e,t,r){this._initialized=!0,this._authToken=t,e&&(t=e.server,this._server.version||(this._server.version=t)),r&&r(e)}_onLoginError(e,t){this._onProtocolError(e.message),t&&t(e)}}const{DAYS_0000_TO_1970,DAYS_PER_400_YEAR_CYCLE,NANOS_PER_HOUR,NANOS_PER_MINUTE,NANOS_PER_SECOND,SECONDS_PER_DAY,floorDiv,floorMod}=internal["temporalUtil"];function epochDayToDate(e){let t=(e=int(e)).add(DAYS_0000_TO_1970).subtract(60),r=int(0);t.lessThan(0)&&(e=t.add(1).div(DAYS_PER_400_YEAR_CYCLE).subtract(1),r=e.multiply(400),t=t.add(e.multiply(-DAYS_PER_400_YEAR_CYCLE)));let n=t.multiply(400).add(591).div(DAYS_PER_400_YEAR_CYCLE),o=t.subtract(n.multiply(365).add(n.div(4)).subtract(n.div(100)).add(n.div(400)));o.lessThan(0)&&(n=n.subtract(1),o=t.subtract(n.multiply(365).add(n.div(4)).subtract(n.div(100)).add(n.div(400)))),n=n.add(r);var e=o,i=e.multiply(5).add(2).div(153),s=i.add(2).modulo(12).add(1),e=e.subtract(i.multiply(306).add(5).div(10)).add(1);return n=n.add(i.div(10)),new Date$1(n,s,e)}function nanoOfDayToLocalTime(e){var t=(e=int(e)).div(NANOS_PER_HOUR),r=(e=e.subtract(t.multiply(NANOS_PER_HOUR))).div(NANOS_PER_MINUTE),n=(e=e.subtract(r.multiply(NANOS_PER_MINUTE))).div(NANOS_PER_SECOND),e=e.subtract(n.multiply(NANOS_PER_SECOND));return new LocalTime(t,r,n,e)}function epochSecondAndNanoToLocalDateTime(e,t){var r=floorDiv(e,SECONDS_PER_DAY),e=floorMod(e,SECONDS_PER_DAY).multiply(NANOS_PER_SECOND).add(t),t=epochDayToDate(r),r=nanoOfDayToLocalTime(e);return new LocalDateTime(t.year,t.month,t.day,r.hour,r.minute,r.second,r.nanosecond)}const{dateToEpochDay,localDateTimeToEpochSecond:localDateTimeToEpochSecond$1,localTimeToNanoOfDay}=internal["temporalUtil"],POINT_2D=88,POINT_2D_STRUCT_SIZE=3,POINT_3D=89,POINT_3D_STRUCT_SIZE=4,DURATION=69,DURATION_STRUCT_SIZE=4,LOCAL_TIME=116,LOCAL_TIME_STRUCT_SIZE=1,TIME=84,TIME_STRUCT_SIZE=2,DATE=68,DATE_STRUCT_SIZE=1,LOCAL_DATE_TIME=100,LOCAL_DATE_TIME_STRUCT_SIZE=2,DATE_TIME_WITH_ZONE_OFFSET$1=70,DATE_TIME_WITH_ZONE_OFFSET_STRUCT_SIZE$1=3,DATE_TIME_WITH_ZONE_ID$1=102,DATE_TIME_WITH_ZONE_ID_STRUCT_SIZE$1=3;function createPoint2DTransformer(){return new TypeTransformer({signature:POINT_2D,isTypeInstance:e=>isPoint(e)&&(null===e.z||void 0===e.z),toStructure:e=>new Structure(POINT_2D,[int(e.srid),e.x,e.y]),fromStructure:e=>{verifyStructSize("Point2D",POINT_2D_STRUCT_SIZE,e.size);var[e,t,r]=e.fields;return new Point(e,t,r,void 0)}})}function createPoint3DTransformer(){return new TypeTransformer({signature:POINT_3D,isTypeInstance:e=>isPoint(e)&&null!==e.z&&void 0!==e.z,toStructure:e=>new Structure(POINT_3D,[int(e.srid),e.x,e.y,e.z]),fromStructure:e=>{verifyStructSize("Point3D",POINT_3D_STRUCT_SIZE,e.size);var[e,t,r,n]=e.fields;return new Point(e,t,r,n)}})}function createDurationTransformer(){return new TypeTransformer({signature:DURATION,isTypeInstance:isDuration,toStructure:e=>{var t=int(e.months),r=int(e.days),n=int(e.seconds),e=int(e.nanoseconds);return new Structure(DURATION,[t,r,n,e])},fromStructure:e=>{verifyStructSize("Duration",DURATION_STRUCT_SIZE,e.size);var[e,t,r,n]=e.fields;return new Duration(e,t,r,n)}})}function createLocalTimeTransformer({disableLosslessIntegers:t,useBigInt:r}){return new TypeTransformer({signature:LOCAL_TIME,isTypeInstance:isLocalTime,toStructure:e=>{e=localTimeToNanoOfDay(e.hour,e.minute,e.second,e.nanosecond);return new Structure(LOCAL_TIME,[e])},fromStructure:e=>{verifyStructSize("LocalTime",LOCAL_TIME_STRUCT_SIZE,e.size);var[e]=e.fields;return convertIntegerPropsIfNeeded$1(nanoOfDayToLocalTime(e),t,r)}})}function createTimeTransformer({disableLosslessIntegers:r,useBigInt:n}){return new TypeTransformer({signature:TIME,isTypeInstance:isTime,toStructure:e=>{var t=localTimeToNanoOfDay(e.hour,e.minute,e.second,e.nanosecond),e=int(e.timeZoneOffsetSeconds);return new Structure(TIME,[t,e])},fromStructure:e=>{verifyStructSize("Time",TIME_STRUCT_SIZE,e.size);var[e,t]=e.fields,e=nanoOfDayToLocalTime(e);return convertIntegerPropsIfNeeded$1(new Time(e.hour,e.minute,e.second,e.nanosecond,t),r,n)}})}function createDateTransformer({disableLosslessIntegers:t,useBigInt:r}){return new TypeTransformer({signature:DATE,isTypeInstance:isDate,toStructure:e=>{e=dateToEpochDay(e.year,e.month,e.day);return new Structure(DATE,[e])},fromStructure:e=>{verifyStructSize("Date",DATE_STRUCT_SIZE,e.size);var[e]=e.fields;return convertIntegerPropsIfNeeded$1(epochDayToDate(e),t,r)}})}function createLocalDateTimeTransformer({disableLosslessIntegers:r,useBigInt:n}){return new TypeTransformer({signature:LOCAL_DATE_TIME,isTypeInstance:isLocalDateTime,toStructure:e=>{var t=localDateTimeToEpochSecond$1(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),e=int(e.nanosecond);return new Structure(LOCAL_DATE_TIME,[t,e])},fromStructure:e=>{verifyStructSize("LocalDateTime",LOCAL_DATE_TIME_STRUCT_SIZE,e.size);var[e,t]=e.fields;return convertIntegerPropsIfNeeded$1(epochSecondAndNanoToLocalDateTime(e,t),r,n)}})}function createDateTimeWithZoneIdTransformer$1({disableLosslessIntegers:n,useBigInt:o}){return new TypeTransformer({signature:DATE_TIME_WITH_ZONE_ID$1,isTypeInstance:e=>isDateTime(e)&&null!=e.timeZoneId,toStructure:e=>{var t=localDateTimeToEpochSecond$1(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),r=int(e.nanosecond),e=e.timeZoneId;return new Structure(DATE_TIME_WITH_ZONE_ID$1,[t,r,e])},fromStructure:e=>{verifyStructSize("DateTimeWithZoneId",DATE_TIME_WITH_ZONE_ID_STRUCT_SIZE$1,e.size);var[e,t,r]=e.fields,e=epochSecondAndNanoToLocalDateTime(e,t);return convertIntegerPropsIfNeeded$1(new DateTime(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond,null,r),n,o)}})}function createDateTimeWithOffsetTransformer$1({disableLosslessIntegers:n,useBigInt:o}){return new TypeTransformer({signature:DATE_TIME_WITH_ZONE_OFFSET$1,isTypeInstance:e=>isDateTime(e)&&null==e.timeZoneId,toStructure:e=>{var t=localDateTimeToEpochSecond$1(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),r=int(e.nanosecond),e=int(e.timeZoneOffsetSeconds);return new Structure(DATE_TIME_WITH_ZONE_OFFSET$1,[t,r,e])},fromStructure:e=>{verifyStructSize("DateTimeWithZoneOffset",DATE_TIME_WITH_ZONE_OFFSET_STRUCT_SIZE$1,e.size);var[e,t,r]=e.fields,e=epochSecondAndNanoToLocalDateTime(e,t);return convertIntegerPropsIfNeeded$1(new DateTime(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond,r,null),n,o)}})}function convertIntegerPropsIfNeeded$1(e,t,r){if(!t&&!r)return e;var n,o,i=Object.create(Object.getPrototypeOf(e));for(const s in e)!0===Object.prototype.hasOwnProperty.call(e,s)&&(n=e[s],i[s]=isInt(n)?(o=n,r?o.toBigInt():o.toNumberOrInfinity()):n);return Object.freeze(i),i}var v2={...v1,createPoint2DTransformer:createPoint2DTransformer,createPoint3DTransformer:createPoint3DTransformer,createDurationTransformer:createDurationTransformer,createLocalTimeTransformer:createLocalTimeTransformer,createTimeTransformer:createTimeTransformer,createDateTransformer:createDateTransformer,createLocalDateTimeTransformer:createLocalDateTimeTransformer,createDateTimeWithZoneIdTransformer:createDateTimeWithZoneIdTransformer$1,createDateTimeWithOffsetTransformer:createDateTimeWithOffsetTransformer$1};const{BOLT_PROTOCOL_V2}=internal["constants"];class BoltProtocol$c extends BoltProtocol$d{_createPacker(e){return new v2$1.Packer(e)}_createUnpacker(e,t){return new v2$1.Unpacker(e,t)}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v2).map(e=>e(this._config,this._log)))),this._transformer}get version(){return BOLT_PROTOCOL_V2}}var v3={...v2};const{bookmarks:{Bookmarks:Bookmarks$4},constants:{BOLT_PROTOCOL_V3:BOLT_PROTOCOL_V3$2},txConfig:{TxConfig:TxConfig$1}}=internal,CONTEXT$1="context",CALL_GET_ROUTING_TABLE=`CALL dbms.cluster.routing.getRoutingTable($${CONTEXT$1})`,noOpObserver=new StreamObserver;class BoltProtocol$b extends BoltProtocol$c{get version(){return BOLT_PROTOCOL_V3$2}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v3).map(e=>e(this._config,this._log)))),this._transformer}transformMetadata(e){return"t_first"in e&&(e.result_available_after=e.t_first,delete e.t_first),"t_last"in e&&(e.result_consumed_after=e.t_last,delete e.t_last),e}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){var i=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>this._onLoginCompleted(e,t,o)});return assertNotificationFilterIsEmpty(r,this._onProtocolError,i),this.write(RequestMessage.hello(e,t),i,!0),i}prepareToClose(){this.write(RequestMessage.goodbye(),noOpObserver,!0)}beginTransaction({bookmarks:e,txConfig:t,database:r,impersonatedUser:n,notificationFilter:o,mode:i,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l}={}){s=new ResultStreamObserver({server:this._server,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l});return s.prepareToHandleSingleResponse(),assertDatabaseIsEmpty(r,this._onProtocolError,s),assertImpersonatedUserIsEmpty(n,this._onProtocolError,s),assertNotificationFilterIsEmpty(o,this._onProtocolError,s),this.write(RequestMessage.begin({bookmarks:e,txConfig:t,mode:i}),s,!0),s}commitTransaction({beforeError:e,afterError:t,beforeComplete:r,afterComplete:n}={}){e=new ResultStreamObserver({server:this._server,beforeError:e,afterError:t,beforeComplete:r,afterComplete:n});return e.prepareToHandleSingleResponse(),this.write(RequestMessage.commit(),e,!0),e}rollbackTransaction({beforeError:e,afterError:t,beforeComplete:r,afterComplete:n}={}){e=new ResultStreamObserver({server:this._server,beforeError:e,afterError:t,beforeComplete:r,afterComplete:n});return e.prepareToHandleSingleResponse(),this.write(RequestMessage.rollback(),e,!0),e}run(e,t,{bookmarks:r,txConfig:n,database:o,impersonatedUser:i,notificationFilter:s,mode:a,beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,flush:f=!0,highRecordWatermark:m=Number.MAX_VALUE,lowRecordWatermark:g=Number.MAX_VALUE}={}){u=new ResultStreamObserver({server:this._server,beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,highRecordWatermark:m,lowRecordWatermark:g});return assertDatabaseIsEmpty(o,this._onProtocolError,u),assertImpersonatedUserIsEmpty(i,this._onProtocolError,u),assertNotificationFilterIsEmpty(s,this._onProtocolError,u),this.write(RequestMessage.runWithMetadata(e,t,{bookmarks:r,txConfig:n,mode:a}),u,!1),this.write(RequestMessage.pullAll(),u,f),u}requestRoutingInformation({routingContext:e={},sessionContext:t={},onError:r,onCompleted:n}){e=this.run(CALL_GET_ROUTING_TABLE,{[CONTEXT$1]:e},{...t,txConfig:TxConfig$1.empty()});return new ProcedureRouteObserver({resultObserver:e,onProtocolError:this._onProtocolError,onError:r,onCompleted:n})}}var v4x0={...v3};const{bookmarks:{Bookmarks:Bookmarks$3},constants:{BOLT_PROTOCOL_V4_0:BOLT_PROTOCOL_V4_0$2,FETCH_ALL:FETCH_ALL$2},txConfig:{TxConfig}}=internal,CONTEXT="context",DATABASE="database",CALL_GET_ROUTING_TABLE_MULTI_DB=`CALL dbms.routing.getRoutingTable($${CONTEXT}, $${DATABASE})`;class BoltProtocol$a extends BoltProtocol$b{get version(){return BOLT_PROTOCOL_V4_0$2}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v4x0).map(e=>e(this._config,this._log)))),this._transformer}beginTransaction({bookmarks:e,txConfig:t,database:r,impersonatedUser:n,notificationFilter:o,mode:i,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l}={}){s=new ResultStreamObserver({server:this._server,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l});return s.prepareToHandleSingleResponse(),assertImpersonatedUserIsEmpty(n,this._onProtocolError,s),assertNotificationFilterIsEmpty(o,this._onProtocolError,s),this.write(RequestMessage.begin({bookmarks:e,txConfig:t,database:r,mode:i}),s,!0),s}run(e,t,{bookmarks:r,txConfig:n,database:o,impersonatedUser:i,notificationFilter:s,mode:a,beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,flush:f=!0,reactive:m=!1,fetchSize:g=FETCH_ALL$2,highRecordWatermark:p=Number.MAX_VALUE,lowRecordWatermark:E=Number.MAX_VALUE}={}){u=new ResultStreamObserver({server:this._server,reactive:m,fetchSize:g,moreFunction:this._requestMore.bind(this),discardFunction:this._requestDiscard.bind(this),beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,highRecordWatermark:p,lowRecordWatermark:E}),assertImpersonatedUserIsEmpty(i,this._onProtocolError,u),assertNotificationFilterIsEmpty(s,this._onProtocolError,u),l=m;return this.write(RequestMessage.runWithMetadata(e,t,{bookmarks:r,txConfig:n,database:o,mode:a}),u,l&&f),m||this.write(RequestMessage.pull({n:g}),u,f),u}_requestMore(e,t,r){this.write(RequestMessage.pull({stmtId:e,n:t}),r,!0)}_requestDiscard(e,t){this.write(RequestMessage.discard({stmtId:e}),t,!0)}_noOp(){}requestRoutingInformation({routingContext:e={},databaseName:t=null,sessionContext:r={},onError:n,onCompleted:o}){e=this.run(CALL_GET_ROUTING_TABLE_MULTI_DB,{[CONTEXT]:e,[DATABASE]:t},{...r,txConfig:TxConfig.empty()});return new ProcedureRouteObserver({resultObserver:e,onProtocolError:this._onProtocolError,onError:n,onCompleted:o})}}var v4x1={...v4x0};const{BOLT_PROTOCOL_V4_1}=internal["constants"];class BoltProtocol$9 extends BoltProtocol$a{constructor(e,t,r,n=()=>null,o,i,s){super(e,t,r,n,o,i),this._serversideRouting=s}get version(){return BOLT_PROTOCOL_V4_1}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v4x1).map(e=>e(this._config,this._log)))),this._transformer}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){var i=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>this._onLoginCompleted(e,t,o)});return assertNotificationFilterIsEmpty(r,this._onProtocolError,i),this.write(RequestMessage.hello(e,t,this._serversideRouting),i,!0),i}}var v4x2={...v4x1};const{BOLT_PROTOCOL_V4_2}=internal["constants"];class BoltProtocol$8 extends BoltProtocol$9{get version(){return BOLT_PROTOCOL_V4_2}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v4x2).map(e=>e(this._config,this._log)))),this._transformer}}var transformersFactories$1={...v4x2},v4x4={...transformersFactories$1};const{localDateTimeToEpochSecond}=internal["temporalUtil"],DATE_TIME_WITH_ZONE_OFFSET=73,DATE_TIME_WITH_ZONE_OFFSET_STRUCT_SIZE=3,DATE_TIME_WITH_ZONE_ID=105,DATE_TIME_WITH_ZONE_ID_STRUCT_SIZE=3;function createDateTimeWithZoneIdTransformer(e,n){const{disableLosslessIntegers:o,useBigInt:i}=e;return v4x4.createDateTimeWithZoneIdTransformer(e).extendsWith({signature:DATE_TIME_WITH_ZONE_ID,fromStructure:e=>{verifyStructSize("DateTimeWithZoneId",DATE_TIME_WITH_ZONE_ID_STRUCT_SIZE,e.size);var[e,t,r]=e.fields,e=getTimeInZoneId(r,e,t);return convertIntegerPropsIfNeeded(new DateTime(e.year,e.month,e.day,e.hour,e.minute,e.second,int(t),e.timeZoneOffsetSeconds,r),o,i)},toStructure:e=>{var t=localDateTimeToEpochSecond(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),r=null!=e.timeZoneOffsetSeconds?e.timeZoneOffsetSeconds:getOffsetFromZoneId(e.timeZoneId,t,e.nanosecond),t=(null==e.timeZoneOffsetSeconds&&n.warn('DateTime objects without "timeZoneOffsetSeconds" property are prune to bugs related to ambiguous times. For instance, 2022-10-30T2:30:00[Europe/Berlin] could be GMT+1 or GMT+2.'),t.subtract(r)),r=int(e.nanosecond),e=e.timeZoneId;return new Structure(DATE_TIME_WITH_ZONE_ID,[t,r,e])}})}function getOffsetFromZoneId(e,t,r){var n=getTimeInZoneId(e,t,r),n=localDateTimeToEpochSecond(n.year,n.month,n.day,n.hour,n.minute,n.second,r).subtract(t),t=t.subtract(n),n=getTimeInZoneId(e,t,r);return localDateTimeToEpochSecond(n.year,n.month,n.day,n.hour,n.minute,n.second,r).subtract(t)}function getTimeInZoneId(e,t,r){e=new Intl.DateTimeFormat("en-US",{timeZone:e,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1,era:"narrow"}),r=int(t).multiply(1e3).add(int(r).div(1e6)).toNumber(),e=e.formatToParts(r).reduce((e,t)=>("era"===t.type?e.adjustEra="B"===t.value.toUpperCase()?e=>e.subtract(1).negate():identity:"hour"===t.type?e.hour=int(t.value).modulo(24):"literal"!==t.type&&(e[t.type]=int(t.value)),e),{}),e.year=e.adjustEra(e.year),r=localDateTimeToEpochSecond(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond);return e.timeZoneOffsetSeconds=r.subtract(t),e.hour=e.hour.modulo(24),e}function createDateTimeWithOffsetTransformer(e){const{disableLosslessIntegers:n,useBigInt:o}=e;return v4x4.createDateTimeWithOffsetTransformer(e).extendsWith({signature:DATE_TIME_WITH_ZONE_OFFSET,toStructure:e=>{var t=localDateTimeToEpochSecond(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),r=int(e.nanosecond),e=int(e.timeZoneOffsetSeconds),t=t.subtract(e);return new Structure(DATE_TIME_WITH_ZONE_OFFSET,[t,r,e])},fromStructure:e=>{verifyStructSize("DateTimeWithZoneOffset",DATE_TIME_WITH_ZONE_OFFSET_STRUCT_SIZE,e.size);var[e,t,r]=e.fields,e=epochSecondAndNanoToLocalDateTime(int(e).add(r),t);return convertIntegerPropsIfNeeded(new DateTime(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond,r,null),n,o)}})}function convertIntegerPropsIfNeeded(e,t,r){if(!t&&!r)return e;var n,o,i=Object.create(Object.getPrototypeOf(e));for(const s in e)!0===Object.prototype.hasOwnProperty.call(e,s)&&(n=e[s],i[s]=isInt(n)?(o=n,r?o.toBigInt():o.toNumberOrInfinity()):n);return Object.freeze(i),i}var v5x0Utc={createDateTimeWithZoneIdTransformer:createDateTimeWithZoneIdTransformer,createDateTimeWithOffsetTransformer:createDateTimeWithOffsetTransformer};const{bookmarks:{Bookmarks:Bookmarks$2},constants:{BOLT_PROTOCOL_V4_3}}=internal;class BoltProtocol$7 extends BoltProtocol$8{get version(){return BOLT_PROTOCOL_V4_3}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(transformersFactories$1).map(e=>e(this._config,this._log)))),this._transformer}requestRoutingInformation({routingContext:e={},databaseName:t=null,sessionContext:r={},onError:n,onCompleted:o}){n=new RouteObserver({onProtocolError:this._onProtocolError,onError:n,onCompleted:o}),o=r.bookmarks||Bookmarks$2.empty();return this.write(RequestMessage.route(e,o.values(),t),n,!0),n}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){var i=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>(void 0!==e.patch_bolt&&this._applyPatches(e.patch_bolt),this._onLoginCompleted(e,t,o))});return assertNotificationFilterIsEmpty(r,this._onProtocolError,i),this.write(RequestMessage.hello(e,t,this._serversideRouting,["utc"]),i,!0),i}_applyPatches(e){e.includes("utc")&&this._applyUtcPatch()}_applyUtcPatch(){this._transformer=new Transformer(Object.values({...transformersFactories$1,...v5x0Utc}).map(e=>e(this._config,this._log)))}}const{constants:{BOLT_PROTOCOL_V4_4:BOLT_PROTOCOL_V4_4$2,FETCH_ALL:FETCH_ALL$1},bookmarks:{Bookmarks:Bookmarks$1}}=internal;class BoltProtocol$6 extends BoltProtocol$7{get version(){return BOLT_PROTOCOL_V4_4$2}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v4x4).map(e=>e(this._config,this._log)))),this._transformer}requestRoutingInformation({routingContext:e={},databaseName:t=null,impersonatedUser:r=null,sessionContext:n={},onError:o,onCompleted:i}){o=new RouteObserver({onProtocolError:this._onProtocolError,onError:o,onCompleted:i}),i=n.bookmarks||Bookmarks$1.empty();return this.write(RequestMessage.routeV4x4(e,i.values(),{databaseName:t,impersonatedUser:r}),o,!0),o}run(e,t,{bookmarks:r,txConfig:n,database:o,mode:i,impersonatedUser:s,notificationFilter:a,beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,flush:f=!0,reactive:m=!1,fetchSize:g=FETCH_ALL$1,highRecordWatermark:p=Number.MAX_VALUE,lowRecordWatermark:E=Number.MAX_VALUE}={}){u=new ResultStreamObserver({server:this._server,reactive:m,fetchSize:g,moreFunction:this._requestMore.bind(this),discardFunction:this._requestDiscard.bind(this),beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,highRecordWatermark:p,lowRecordWatermark:E}),assertNotificationFilterIsEmpty(a,this._onProtocolError,u),l=m;return this.write(RequestMessage.runWithMetadata(e,t,{bookmarks:r,txConfig:n,database:o,mode:i,impersonatedUser:s}),u,l&&f),m||this.write(RequestMessage.pull({n:g}),u,f),u}beginTransaction({bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o,notificationFilter:i,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l}={}){s=new ResultStreamObserver({server:this._server,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l});return s.prepareToHandleSingleResponse(),assertNotificationFilterIsEmpty(i,this._onProtocolError,s),this.write(RequestMessage.begin({bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o}),s,!0),s}_applyUtcPatch(){this._transformer=new Transformer(Object.values({...v4x4,...v5x0Utc}).map(e=>e(this._config,this._log)))}}const NODE_STRUCT_SIZE=4,RELATIONSHIP_STRUCT_SIZE=8,UNBOUND_RELATIONSHIP_STRUCT_SIZE=4;function createNodeTransformer(e){return v4x4.createNodeTransformer(e).extendsWith({fromStructure:e=>{verifyStructSize("Node",NODE_STRUCT_SIZE,e.size);var[e,t,r,n]=e.fields;return new Node(e,t,r,n)}})}function createRelationshipTransformer(e){return v4x4.createRelationshipTransformer(e).extendsWith({fromStructure:e=>{verifyStructSize("Relationship",RELATIONSHIP_STRUCT_SIZE,e.size);var[e,t,r,n,o,i,s,a]=e.fields;return new Relationship(e,t,r,n,o,i,s,a)}})}function createUnboundRelationshipTransformer(e){return v4x4.createUnboundRelationshipTransformer(e).extendsWith({fromStructure:e=>{verifyStructSize("UnboundRelationship",UNBOUND_RELATIONSHIP_STRUCT_SIZE,e.size);var[e,t,r,n]=e.fields;return new UnboundRelationship(e,t,r,n)}})}var v5x0={...v4x4,...v5x0Utc,createNodeTransformer:createNodeTransformer,createRelationshipTransformer:createRelationshipTransformer,createUnboundRelationshipTransformer:createUnboundRelationshipTransformer};const{BOLT_PROTOCOL_V5_0}=internal["constants"];class BoltProtocol$5 extends BoltProtocol$6{get version(){return BOLT_PROTOCOL_V5_0}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v5x0).map(e=>e(this._config,this._log)))),this._transformer}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){var i=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>this._onLoginCompleted(e,t,o)});return assertNotificationFilterIsEmpty(r,this._onProtocolError,i),this.write(RequestMessage.hello(e,t,this._serversideRouting),i,!0),i}}var v5x1={...v5x0};const{BOLT_PROTOCOL_V5_1:BOLT_PROTOCOL_V5_1$2}=internal["constants"];class BoltProtocol$4 extends BoltProtocol$5{get version(){return BOLT_PROTOCOL_V5_1$2}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v5x1).map(e=>e(this._config,this._log)))),this._transformer}get supportsReAuth(){return!0}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){const i={};var s=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>(i.metadata=e,this._onLoginCompleted(e))});return assertNotificationFilterIsEmpty(r,this._onProtocolError,s),this.write(RequestMessage.hello5x1(e,this._serversideRouting),s,!1),this.logon({authToken:t,onComplete:e=>o({...e,...i.metadata}),onError:n,flush:!0})}logon({authToken:e,onComplete:t,onError:r,flush:n}={}){var o=new LoginObserver({onCompleted:()=>this._onLoginCompleted(null,e,t),onError:e=>this._onLoginError(e,r)});return this.write(RequestMessage.logon(e),o,n),o}logoff({onComplete:e,onError:t,flush:r}={}){e=new LogoffObserver({onCompleted:e,onError:t});return this.write(RequestMessage.logoff(),e,r),e}}var v5x2={...v5x1};const{BOLT_PROTOCOL_V5_2,FETCH_ALL}=internal["constants"];class BoltProtocol$3 extends BoltProtocol$4{get version(){return BOLT_PROTOCOL_V5_2}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v5x2).map(e=>e(this._config,this._log)))),this._transformer}get supportsReAuth(){return!0}initialize({userAgent:e,authToken:t,notificationFilter:r,onError:n,onComplete:o}={}){const i={};var s=new LoginObserver({onError:e=>this._onLoginError(e,n),onCompleted:e=>(i.metadata=e,this._onLoginCompleted(e))});return this.write(RequestMessage.hello5x2(e,r,this._serversideRouting),s,!1),this.logon({authToken:t,onComplete:e=>o({...e,...i.metadata}),onError:n,flush:!0})}beginTransaction({bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o,notificationFilter:i,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l}={}){s=new ResultStreamObserver({server:this._server,beforeError:s,afterError:a,beforeComplete:u,afterComplete:l});return s.prepareToHandleSingleResponse(),this.write(RequestMessage.begin({bookmarks:e,txConfig:t,database:r,mode:n,impersonatedUser:o,notificationFilter:i}),s,!0),s}run(e,t,{bookmarks:r,txConfig:n,database:o,mode:i,impersonatedUser:s,notificationFilter:a,beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,flush:f=!0,reactive:m=!1,fetchSize:g=FETCH_ALL,highRecordWatermark:p=Number.MAX_VALUE,lowRecordWatermark:E=Number.MAX_VALUE}={}){u=new ResultStreamObserver({server:this._server,reactive:m,fetchSize:g,moreFunction:this._requestMore.bind(this),discardFunction:this._requestDiscard.bind(this),beforeKeys:u,afterKeys:l,beforeError:c,afterError:h,beforeComplete:_,afterComplete:d,highRecordWatermark:p,lowRecordWatermark:E}),l=m;return this.write(RequestMessage.runWithMetadata(e,t,{bookmarks:r,txConfig:n,database:o,mode:i,impersonatedUser:s,notificationFilter:a}),u,l&&f),m||this.write(RequestMessage.pull({n:g}),u,f),u}}var v5x3={...v5x2};const{BOLT_PROTOCOL_V5_3}=internal["constants"];class BoltProtocol$2 extends BoltProtocol$3{get version(){return BOLT_PROTOCOL_V5_3}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(v5x3).map(e=>e(this._config,this._log)))),this._transformer}initialize({userAgent:e,boltAgent:t,authToken:r,notificationFilter:n,onError:o,onComplete:i}={}){const s={};var a=new LoginObserver({onError:e=>this._onLoginError(e,o),onCompleted:e=>(s.metadata=e,this._onLoginCompleted(e))});return this.write(RequestMessage.hello5x3(e,t,n,this._serversideRouting),a,!1),this.logon({authToken:r,onComplete:e=>i({...e,...s.metadata}),onError:o,flush:!0})}}var transformersFactories={...v5x3};const{BOLT_PROTOCOL_V5_4}=internal["constants"];class BoltProtocol$1 extends BoltProtocol$2{get version(){return BOLT_PROTOCOL_V5_4}get transformer(){return void 0===this._transformer&&(this._transformer=new Transformer(Object.values(transformersFactories).map(e=>e(this._config,this._log)))),this._transformer}telemetry({api:e},{onError:t,onCompleted:r}={}){r=new TelemetryObserver({onCompleted:r,onError:t});return this.write(RequestMessage.telemetry({api:e}),r,!1),r}}const SUCCESS=112,RECORD=113,IGNORED=126,FAILURE=127;function NO_OP(){}function NO_OP_IDENTITY(e){return e}const NO_OP_OBSERVER={onNext:NO_OP,onCompleted:NO_OP,onError:NO_OP};class ResponseHandler{constructor({transformMetadata:e,log:t,observer:r}={}){this._pendingObservers=[],this._log=t,this._transformMetadata=e||NO_OP_IDENTITY,this._observer=Object.assign({onObserversCountChange:NO_OP,onError:NO_OP,onFailure:NO_OP,onErrorApplyTransformation:NO_OP_IDENTITY},r)}get currentFailure(){return this._currentFailure}handleResponse(e){var t=e.fields[0];switch(e.signature){case RECORD:this._log.isDebugEnabled()&&this._log.debug("S: RECORD "+stringify(e)),this._currentObserver.onNext(t);break;case SUCCESS:this._log.isDebugEnabled()&&this._log.debug("S: SUCCESS "+stringify(e));try{var r=this._transformMetadata(t);this._currentObserver.onCompleted(r)}finally{this._updateCurrentObserver()}break;case FAILURE:this._log.isDebugEnabled()&&this._log.debug("S: FAILURE "+stringify(e));try{var n=_standardizeCode(t.code),o=newError(t.message,n);this._currentFailure=this._observer.onErrorApplyTransformation(o),this._currentObserver.onError(this._currentFailure)}finally{this._updateCurrentObserver(),this._observer.onFailure(this._currentFailure)}break;case IGNORED:this._log.isDebugEnabled()&&this._log.debug("S: IGNORED "+stringify(e));try{this._currentFailure&&this._currentObserver.onError?this._currentObserver.onError(this._currentFailure):this._currentObserver.onError&&this._currentObserver.onError(newError("Ignored either because of an error or RESET"))}finally{this._updateCurrentObserver()}break;default:this._observer.onError(newError("Unknown Bolt protocol message: "+e))}}_updateCurrentObserver(){this._currentObserver=this._pendingObservers.shift(),this._observer.onObserversCountChange(this._observersCount)}get _observersCount(){return null==this._currentObserver?this._pendingObservers.length:this._pendingObservers.length+1}_queueObserver(e){return(e=e||NO_OP_OBSERVER).onCompleted=e.onCompleted||NO_OP,e.onError=e.onError||NO_OP,e.onNext=e.onNext||NO_OP,void 0===this._currentObserver?this._currentObserver=e:this._pendingObservers.push(e),this._observer.onObserversCountChange(this._observersCount),!0}_notifyErrorToObservers(e){for(this._currentObserver&&this._currentObserver.onError&&this._currentObserver.onError(e);0<this._pendingObservers.length;){var t=this._pendingObservers.shift();t&&t.onError&&t.onError(e)}}hasOngoingObservableRequests(){return null!=this._currentObserver||0<this._pendingObservers.length}_resetFailure(){this._currentFailure=null}}function _standardizeCode(e){return"Neo.TransientError.Transaction.Terminated"===e?"Neo.ClientError.Transaction.Terminated":"Neo.TransientError.Transaction.LockClientStopped"===e?"Neo.ClientError.Transaction.LockClientStopped":e}function create({version:e,chunker:t,dechunker:n,channel:o,disableLosslessIntegers:r,useBigInt:i,serversideRouting:s,server:a,log:u,observer:l}={}){return createProtocol(e,a,t,{disableLosslessIntegers:r,useBigInt:i},s,t=>{const r=new ResponseHandler({transformMetadata:t.transformMetadata.bind(t),log:u,observer:l});return o.onerror=l.onError.bind(l),o.onmessage=e=>n.write(e),n.onmessage=e=>{try{r.handleResponse(t.unpack(e))}catch(e){return l.onError(e)}},r},l.onProtocolError.bind(l),u)}function createProtocol(e,t,r,n,o,i,s,a){switch(e){case 1:return new BoltProtocol$d(t,r,n,i,a,s);case 2:return new BoltProtocol$c(t,r,n,i,a,s);case 3:return new BoltProtocol$b(t,r,n,i,a,s);case 4:return new BoltProtocol$a(t,r,n,i,a,s);case 4.1:return new BoltProtocol$9(t,r,n,i,a,s,o);case 4.2:return new BoltProtocol$8(t,r,n,i,a,s,o);case 4.3:return new BoltProtocol$7(t,r,n,i,a,s,o);case 4.4:return new BoltProtocol$6(t,r,n,i,a,s,o);case 5:return new BoltProtocol$5(t,r,n,i,a,s,o);case 5.1:return new BoltProtocol$4(t,r,n,i,a,s,o);case 5.2:return new BoltProtocol$3(t,r,n,i,a,s,o);case 5.3:return new BoltProtocol$2(t,r,n,i,a,s,o);case 5.4:return new BoltProtocol$1(t,r,n,i,a,s,o);default:throw newError("Unknown Bolt protocol version: "+e)}}const BoltProtocol=BoltProtocol$7,RawRoutingTable=RawRoutingTable$1;var Bolt={handshake:handshake,create:create},index$2=Object.freeze({__proto__:null,BoltProtocol:BoltProtocol,RawRoutingTable:RawRoutingTable,default:Bolt,StreamObserver:StreamObserver,ResultStreamObserver:ResultStreamObserver,LoginObserver:LoginObserver,LogoffObserver:LogoffObserver,ResetObserver:ResetObserver,FailedObserver:FailedObserver,CompletedObserver:CompletedObserver,RouteObserver:RouteObserver,ProcedureRouteObserver:ProcedureRouteObserver,TelemetryObserver:TelemetryObserver});const DEFAULT_MAX_SIZE=100,DEFAULT_ACQUISITION_TIMEOUT=6e4;class PoolConfig{constructor(e,t){this.maxSize=valueOrDefault(e,DEFAULT_MAX_SIZE),this.acquisitionTimeout=valueOrDefault(t,DEFAULT_ACQUISITION_TIMEOUT)}static defaultConfig(){return new PoolConfig(DEFAULT_MAX_SIZE,DEFAULT_ACQUISITION_TIMEOUT)}static fromDriverConfig(e){var t=isConfigured(e.maxConnectionPoolSize)?e.maxConnectionPoolSize:DEFAULT_MAX_SIZE,e=isConfigured(e.connectionAcquisitionTimeout)?e.connectionAcquisitionTimeout:DEFAULT_ACQUISITION_TIMEOUT;return new PoolConfig(t,e)}}function valueOrDefault(e,t){return 0===e||e?e:t}function isConfigured(e){return 0===e||e}const{Logger:Logger$1}=internal["logger"];class Pool{constructor({create:e=(e,t,r)=>Promise.resolve(),destroy:t=e=>Promise.resolve(),validateOnAcquire:r=(e,t)=>!0,validateOnRelease:n=e=>!0,installIdleObserver:o=(e,t)=>{},removeIdleObserver:i=e=>{},config:s=PoolConfig.defaultConfig(),log:a=Logger$1.noOp()}={}){this._create=e,this._destroy=t,this._validateOnAcquire=r,this._validateOnRelease=n,this._installIdleObserver=o,this._removeIdleObserver=i,this._maxSize=s.maxSize,this._acquisitionTimeout=s.acquisitionTimeout,this._pools={},this._pendingCreates={},this._acquireRequests={},this._activeResourceCounts={},this._release=this._release.bind(this),this._log=a,this._closed=!1}acquire(o,i,s){const a=i.asKey(),u=this._acquireRequests;return u[a]||(u[a]=[]),new Promise((e,t)=>{let r=null;var n=setTimeout(()=>{var e,t=u[a];t&&(u[a]=t.filter(e=>e!==r)),r.isCompleted()||(t=this.activeResourceCount(i),e=this.has(i)?this._pools[a].length:0,r.reject(newError(`Connection acquisition timed out in ${this._acquisitionTimeout} ms. Pool status: Active conn count = ${t}, Idle conn count = ${e}.`)))},this._acquisitionTimeout);r=new PendingRequest(a,o,s,e,t,n,this._log),u[a].push(r),this._processPendingAcquireRequests(i)})}purge(e){return this._purgeKey(e.asKey())}apply(e,t){e=e.asKey();e in this._pools&&this._pools[e].apply(t)}async close(){return this._closed=!0,Promise.all(Object.keys(this._pools).map(e=>this._purgeKey(e)))}keepAll(e){const t=e.map(e=>e.asKey());e=Object.keys(this._pools).filter(e=>-1===t.indexOf(e));return Promise.all(e.map(e=>this._purgeKey(e)))}has(e){return e.asKey()in this._pools}activeResourceCount(e){return this._activeResourceCounts[e.asKey()]||0}_getOrInitializePoolFor(e){let t=this._pools[e];return t||(t=new SingleAddressPool,this._pools[e]=t,this._pendingCreates[e]=0),t}async _acquire(e,t,r){if(this._closed)throw newError("Pool is closed, it is no more able to serve requests.");var n=t.asKey();const o=this._getOrInitializePoolFor(n);if(!r)for(;o.length;){const i=o.pop();if(this._removeIdleObserver&&this._removeIdleObserver(i),await this._validateOnAcquire(e,i))return resourceAcquired(n,this._activeResourceCounts),this._log.isDebugEnabled()&&this._log.debug(i+" acquired from the pool "+n),{resource:i,pool:o};o.removeInUse(i),await this._destroy(i)}if(0<this._maxSize&&this.activeResourceCount(t)+this._pendingCreates[n]>=this._maxSize)return{resource:null,pool:o};this._pendingCreates[n]=this._pendingCreates[n]+1;let i;try{if(this.activeResourceCount(t)+o.length>=this._maxSize&&r){const i=o.pop();this._removeIdleObserver&&this._removeIdleObserver(i),o.removeInUse(i),await this._destroy(i)}i=await this._create(e,t,(e,t)=>this._release(e,t,o)),o.pushInUse(i),resourceAcquired(n,this._activeResourceCounts),this._log.isDebugEnabled()&&this._log.debug(i+" created for the pool "+n)}finally{this._pendingCreates[n]=this._pendingCreates[n]-1}return{resource:i,pool:o}}async _release(e,t,r){const n=e.asKey();try{r.isActive()?await this._validateOnRelease(t)?(this._installIdleObserver&&this._installIdleObserver(t,{onError:e=>{this._log.debug(`Idle connection ${t} destroyed because of error: `+e);e=this._pools[n];e&&(this._pools[n]=e.filter(e=>e!==t),e.removeInUse(t)),this._destroy(t).catch(()=>{})}}),r.push(t),this._log.isDebugEnabled()&&this._log.debug(t+" released to the pool "+n)):(this._log.isDebugEnabled()&&this._log.debug(`${t} destroyed and can't be released to the pool ${n} because it is not functional`),r.removeInUse(t),await this._destroy(t)):(this._log.isDebugEnabled()&&this._log.debug(`${t} destroyed and can't be released to the pool ${n} because pool has been purged`),r.removeInUse(t),await this._destroy(t))}finally{resourceReleased(n,this._activeResourceCounts),this._processPendingAcquireRequests(e)}}async _purgeKey(e){var t=this._pools[e],r=[];if(t){for(;t.length;){var n=t.pop();this._removeIdleObserver&&this._removeIdleObserver(n),r.push(this._destroy(n))}t.close(),delete this._pools[e],await Promise.all(r)}}_processPendingAcquireRequests(r){const n=r.asKey();var e=this._acquireRequests[n];if(e){const o=e.shift();o?this._acquire(o.context,r,o.requireNew).catch(e=>(o.reject(e),{resource:null})).then(({resource:e,pool:t})=>{e?o.isCompleted()?this._release(r,e,t):o.resolve(e):o.isCompleted()||(this._acquireRequests[n]||(this._acquireRequests[n]=[]),this._acquireRequests[n].unshift(o))}):delete this._acquireRequests[n]}}}function resourceAcquired(e,t){var r=t[e]||0;t[e]=r+1}function resourceReleased(e,t){var r=(t[e]||0)-1;0<r?t[e]=r:delete t[e]}class PendingRequest{constructor(e,t,r,n,o,i,s){this._key=e,this._context=t,this._resolve=n,this._reject=o,this._timeoutId=i,this._log=s,this._completed=!1,this._config=r||{}}get context(){return this._context}get requireNew(){return this._config.requireNew||!1}isCompleted(){return this._completed}resolve(e){this._completed||(this._completed=!0,clearTimeout(this._timeoutId),this._log.isDebugEnabled()&&this._log.debug(e+" acquired from the pool "+this._key),this._resolve(e))}reject(e){this._completed||(this._completed=!0,clearTimeout(this._timeoutId),this._reject(e))}}class SingleAddressPool{constructor(){this._active=!0,this._elements=[],this._elementsInUse=new Set}isActive(){return this._active}close(){this._active=!1,this._elements=[],this._elementsInUse=new Set}filter(e){return this._elements=this._elements.filter(e),this}apply(e){this._elements.forEach(e),this._elementsInUse.forEach(e)}get length(){return this._elements.length}pop(){var e=this._elements.pop();return this._elementsInUse.add(e),e}push(e){return this._elementsInUse.delete(e),this._elements.push(e)}pushInUse(e){this._elementsInUse.add(e)}removeInUse(e){this._elementsInUse.delete(e)}}var index$1=Object.freeze({__proto__:null,default:Pool,Pool:Pool,PoolConfig:PoolConfig,DEFAULT_ACQUISITION_TIMEOUT:DEFAULT_ACQUISITION_TIMEOUT,DEFAULT_MAX_SIZE:DEFAULT_MAX_SIZE});class SingleConnectionProvider extends ConnectionProvider{constructor(e){super(),this._connection=e}acquireConnection({}={}){var e=this._connection;return this._connection=null,Promise.resolve(e)}}class Connection extends Connection$1{constructor(e){super(),this._errorHandler=e}get id(){throw new Error("not implemented")}get databaseId(){throw new Error("not implemented")}set databaseId(e){throw new Error("not implemented")}get authToken(){throw new Error("not implemented")}set authToken(e){throw new Error("not implemented")}get supportsReAuth(){throw new Error("not implemented")}get creationTimestamp(){throw new Error("not implemented")}set idleTimestamp(e){throw new Error("not implemented")}get idleTimestamp(){throw new Error("not implemented")}protocol(){throw new Error("not implemented")}get address(){throw new Error("not implemented")}get version(){throw new Error("not implemented")}set version(e){throw new Error("not implemented")}get server(){throw new Error("not implemented")}connect(e,t,r,n){throw new Error("not implemented")}write(e,t,r){throw new Error("not implemented")}close(){throw new Error("not implemented")}handleAndTransformError(e,t){return this._errorHandler?this._errorHandler.handleAndTransformError(e,t,this):e}}const PROTOCOL_ERROR$1=error["PROTOCOL_ERROR"],{Logger}=internal["logger"];let idGenerator=0;function createChannelConnection(i,s,a,u,l=null,e=e=>new Channel(e)){const c=e(new ChannelConfig(i,s,a.errorCode()));return Bolt.handshake(c,u).then(({protocolVersion:e,consumeRemainingBuffer:t})=>{const r=new Chunker(c),n=new Dechunker;var o=new ChannelConnection(c,a,i,u,s.disableLosslessIntegers,l,r,s.notificationFilter,t=>Bolt.create({version:e,channel:c,chunker:r,dechunker:n,disableLosslessIntegers:s.disableLosslessIntegers,useBigInt:s.useBigInt,serversideRouting:l,server:t.server,log:t.logger,observer:{onObserversCountChange:t._handleOngoingRequestsNumberChange.bind(t),onError:t._handleFatalError.bind(t),onFailure:t._resetOnFailure.bind(t),onProtocolError:t._handleProtocolError.bind(t),onErrorApplyTransformation:e=>t.handleAndTransformError(e,t._address)}}),s.telemetryDisabled);return t(e=>n.write(e)),o}).catch(e=>c.close().then(()=>{throw e}))}class ChannelConnection extends Connection{constructor(e,t,r,n,o=!1,i=null,s,a,u,l){super(t),this._authToken=null,this._idle=!1,this._reseting=!1,this._resetObservers=[],this._id=idGenerator++,this._address=r,this._server={address:r.asHostPort()},this._creationTimestamp=Date.now(),this._disableLosslessIntegers=o,this._ch=e,this._chunker=s,this._log=createConnectionLogger(this,n),this._serversideRouting=i,this._notificationFilter=a,this._telemetryDisabledDriverConfig=!0===l,this._telemetryDisabledConnection=!0,this._dbConnectionId=null,this._protocol=u(this),this._isBroken=!1,this._log.isDebugEnabled()&&this._log.debug("created towards "+r)}beginTransaction(e){return this._sendTelemetryIfEnabled(e),this._protocol.beginTransaction(e)}run(e,t,r){return this._sendTelemetryIfEnabled(r),this._protocol.run(e,t,r)}_sendTelemetryIfEnabled(e){this._telemetryDisabledConnection||this._telemetryDisabledDriverConfig||null==e||null==e.apiTelemetryConfig||this._protocol.telemetry({api:e.apiTelemetryConfig.api},{onCompleted:e.apiTelemetryConfig.onTelemetrySuccess,onError:e.beforeError})}commitTransaction(e){return this._protocol.commitTransaction(e)}rollbackTransaction(e){return this._protocol.rollbackTransaction(e)}getProtocolVersion(){return this._protocol.version}get authToken(){return this._authToken}set authToken(e){this._authToken=e}get supportsReAuth(){return this._protocol.supportsReAuth}get id(){return this._id}get databaseId(){return this._dbConnectionId}set databaseId(e){this._dbConnectionId=e}set idleTimestamp(e){this._idleTimestamp=e}get idleTimestamp(){return this._idleTimestamp}get creationTimestamp(){return this._creationTimestamp}async connect(e,t,r,n){if(this._protocol.initialized&&!this._protocol.supportsReAuth)throw newError("Connection does not support re-auth");return this._authToken=r,this._protocol.initialized?n?new Promise((e,t)=>{this._protocol.logoff({onError:t}),this._protocol.logon({authToken:r,onError:t,onComplete:()=>e(this),flush:!0})}):(this._protocol.logoff(),this._protocol.logon({authToken:r,flush:!0}),this):this._initialize(e,t,r)}_initialize(e,n,o){const i=this;return new Promise((r,t)=>{this._protocol.initialize({userAgent:e,boltAgent:n,authToken:o,notificationFilter:this._notificationFilter,onError:e=>t(e),onComplete:e=>{var t;e&&(t=e.server,this.version&&!t||(this.version=t),t=e.connection_id,this.databaseId||(this.databaseId=t),e.hints)&&(null!=(t=e.hints["connection.recv_timeout_seconds"])&&(t=toNumber(t),Number.isInteger(t)&&0<t?this._ch.setupReceiveTimeout(1e3*t):this._log.info(`Server located at ${this._address} supplied an invalid connection receive timeout value (${t}). `+"Please, verify the server configuration and status because this can be the symptom of a bigger issue.")),!0===e.hints["telemetry.enabled"])&&(this._telemetryDisabledConnection=!1),r(i)}})})}protocol(){return this._protocol}get address(){return this._address}get version(){return this._server.version}set version(e){this._server.version=e}get server(){return this._server}get logger(){return this._log}_handleFatalError(e){this._isBroken=!0,this._error=this.handleAndTransformError(this._protocol.currentFailure||e,this._address),this._log.isErrorEnabled()&&this._log.error(`experienced a fatal error caused by ${this._error} (${stringify(this._error)})`),this._protocol.notifyFatalError(this._error)}_setIdle(e){this._idle=!0,this._ch.stopReceiveTimeout(),this._protocol.queueObserverIfProtocolIsNotBroken(e)}_unsetIdle(){this._idle=!1,this._updateCurrentObserver()}_queueObserver(e){return this._protocol.queueObserverIfProtocolIsNotBroken(e)}hasOngoingObservableRequests(){return!this._idle&&this._protocol.hasOngoingObservableRequests()}resetAndFlush(){return new Promise((e,t)=>{this._reset({onError:e=>{this._isBroken?t(e):(e=this._handleProtocolError("Received FAILURE as a response for RESET: "+e),t(e))},onComplete:()=>{e()}})})}_resetOnFailure(){this.isOpen()&&this._reset({onError:()=>{this._protocol.resetFailure()},onComplete:()=>{this._protocol.resetFailure()}})}_reset(t){if(this._reseting)this._protocol.isLastMessageReset()?this._resetObservers.push(t):this._protocol.reset({onError:e=>{t.onError(e)},onComplete:()=>{t.onComplete()}});else{this._resetObservers.push(t),this._reseting=!0;const e=e=>{this._reseting=!1;var t=this._resetObservers;this._resetObservers=[],t.forEach(e)};this._protocol.reset({onError:t=>{e(e=>e.onError(t))},onComplete:()=>{e(e=>e.onComplete())}})}}_updateCurrentObserver(){this._protocol.updateCurrentObserver()}isOpen(){return!this._isBroken&&this._ch._open}_handleOngoingRequestsNumberChange(e){this._idle||(0===e?this._ch.stopReceiveTimeout():this._ch.startReceiveTimeout())}async close(){this._log.isDebugEnabled()&&this._log.debug("closing"),this._protocol&&this.isOpen()&&this._protocol.prepareToClose(),await this._ch.close(),this._log.isDebugEnabled()&&this._log.debug("closed")}toString(){return`Connection [${this.id}][${this.databaseId||""}]`}_handleProtocolError(e){this._protocol.resetFailure(),this._updateCurrentObserver();e=newError(e,PROTOCOL_ERROR$1);return this._handleFatalError(e),e}}function createConnectionLogger(r,n){return new Logger(n._level,(e,t)=>n._loggerFunction(e,r+" "+t))}class DelegateConnection extends Connection{constructor(e,t){super(t),t&&(this._originalErrorHandler=e._errorHandler,e._errorHandler=this._errorHandler),this._delegate=e}beginTransaction(e){return this._delegate.beginTransaction(e)}run(e,t,r){return this._delegate.run(e,t,r)}commitTransaction(e){return this._delegate.commitTransaction(e)}rollbackTransaction(e){return this._delegate.rollbackTransaction(e)}getProtocolVersion(){return this._delegate.getProtocolVersion()}get id(){return this._delegate.id}get databaseId(){return this._delegate.databaseId}set databaseId(e){this._delegate.databaseId=e}get server(){return this._delegate.server}get authToken(){return this._delegate.authToken}get supportsReAuth(){return this._delegate.supportsReAuth}set authToken(e){this._delegate.authToken=e}get address(){return this._delegate.address}get version(){return this._delegate.version}set version(e){this._delegate.version=e}get creationTimestamp(){return this._delegate.creationTimestamp}set idleTimestamp(e){this._delegate.idleTimestamp=e}get idleTimestamp(){return this._delegate.idleTimestamp}isOpen(){return this._delegate.isOpen()}protocol(){return this._delegate.protocol()}connect(e,t,r,n){return this._delegate.connect(e,t,r,n)}write(e,t,r){return this._delegate.write(e,t,r)}resetAndFlush(){return this._delegate.resetAndFlush()}hasOngoingObservableRequests(){return this._delegate.hasOngoingObservableRequests()}close(){return this._delegate.close()}release(){return this._originalErrorHandler&&(this._delegate._errorHandler=this._originalErrorHandler),this._delegate.release()}}const{SERVICE_UNAVAILABLE:SERVICE_UNAVAILABLE$3,SESSION_EXPIRED:SESSION_EXPIRED$1}=error;class ConnectionErrorHandler{constructor(e,t,r,n){this._errorCode=e,this._handleUnavailability=t||noOpHandler,this._handleWriteFailure=r||noOpHandler,this._handleSecurityError=n||noOpHandler}static create({errorCode:e,handleUnavailability:t,handleWriteFailure:r,handleSecurityError:n}){return new ConnectionErrorHandler(e,t,r,n)}errorCode(){return this._errorCode}handleAndTransformError(e,t,r){return isSecurityError(e)?this._handleSecurityError(e,t,r):isAvailabilityError(e)?this._handleUnavailability(e,t,r):isFailureToWrite(e)?this._handleWriteFailure(e,t,r):e}}function isSecurityError(e){return null!=e&&null!=e.code&&e.code.startsWith("Neo.ClientError.Security.")}function isAvailabilityError(e){return!!e&&(e.code===SESSION_EXPIRED$1||e.code===SERVICE_UNAVAILABLE$3||"Neo.TransientError.General.DatabaseUnavailable"===e.code)}function isFailureToWrite(e){return!!e&&("Neo.ClientError.Cluster.NotALeader"===e.code||"Neo.ClientError.General.ForbiddenOnReadOnlyDatabase"===e.code)}function noOpHandler(e){return e}class AuthenticationProvider{constructor({authTokenManager:e,userAgent:t,boltAgent:r}){this._authTokenManager=e||staticAuthTokenManager({}),this._userAgent=t,this._boltAgent=r}async authenticate({connection:e,auth:t,skipReAuth:r,waitReAuth:n,forceReAuth:o}){return null!=t?(r=!0===e.supportsReAuth&&(!equals(e.authToken,t)&&!0!==r||!0===o),null==e.authToken||r?e.connect(this._userAgent,this._boltAgent,t,n||!1):e):equals(o=await this._authTokenManager.getToken(),e.authToken)?e:e.connect(this._userAgent,this._boltAgent,o,!1)}handleError({connection:e,code:t}){return!(!e||!t.startsWith("Neo.ClientError.Security."))&&this._authTokenManager.handleSecurityException(e.authToken,t)}}class LivenessCheckProvider{constructor({connectionLivenessCheckTimeout:e}){this._connectionLivenessCheckTimeout=e}async check(e){var t;return!(!this._isCheckDisabled&&!this._isNewlyCreatedConnection(e)&&(t=Date.now()-e.idleTimestamp,0===this._connectionLivenessCheckTimeout||t>this._connectionLivenessCheckTimeout))||e.resetAndFlush().then(()=>!0)}get _isCheckDisabled(){return null==this._connectionLivenessCheckTimeout||this._connectionLivenessCheckTimeout<0}_isNewlyCreatedConnection(e){return null==e.authToken}}const SERVICE_UNAVAILABLE$2=error["SERVICE_UNAVAILABLE"],AUTHENTICATION_ERRORS=["Neo.ClientError.Security.CredentialsExpired","Neo.ClientError.Security.Forbidden","Neo.ClientError.Security.TokenExpired","Neo.ClientError.Security.Unauthorized"];class PooledConnectionProvider extends ConnectionProvider{constructor({id:e,config:t,log:r,userAgent:n,boltAgent:o,authTokenManager:i,newPool:s=(...e)=>new Pool(...e)},a=null){super(),this._id=e,this._config=t,this._log=r,this._authenticationProvider=new AuthenticationProvider({authTokenManager:i,userAgent:n,boltAgent:o}),this._livenessCheckProvider=new LivenessCheckProvider({connectionLivenessCheckTimeout:t.connectionLivenessCheckTimeout}),this._userAgent=n,this._boltAgent=o,this._createChannelConnection=a||(e=>createChannelConnection(e,this._config,this._createConnectionErrorHandler(),this._log)),this._connectionPool=s({create:this._createConnection.bind(this),destroy:this._destroyConnection.bind(this),validateOnAcquire:this._validateConnectionOnAcquire.bind(this),validateOnRelease:this._validateConnectionOnRelease.bind(this),installIdleObserver:PooledConnectionProvider._installIdleObserverOnConnection.bind(this),removeIdleObserver:PooledConnectionProvider._removeIdleObserverOnConnection.bind(this),config:PoolConfig.fromDriverConfig(t),log:this._log}),this._openConnections={}}_createConnectionErrorHandler(){return new ConnectionErrorHandler(SERVICE_UNAVAILABLE$2)}_createConnection({auth:e},r,n){return this._createChannelConnection(r).then(t=>(t.release=()=>(t.idleTimestamp=Date.now(),n(r,t)),this._openConnections[t.id]=t,this._authenticationProvider.authenticate({connection:t,auth:e}).catch(e=>{throw this._destroyConnection(t),e})))}async _validateConnectionOnAcquire({auth:e,skipReAuth:t},r){if(!this._validateConnection(r))return!1;try{await this._livenessCheckProvider.check(r)}catch(e){return this._log.debug(`The connection ${r.id} is not alive because of an error ${e.code} '${e.message}'`),!1}try{return await this._authenticationProvider.authenticate({connection:r,auth:e,skipReAuth:t}),!0}catch(e){return this._log.debug(`The connection ${r.id} is not valid because of an error ${e.code} '${e.message}'`),!1}}_validateConnectionOnRelease(e){return!0!==e._sticky&&this._validateConnection(e)}_validateConnection(e){return!(!e.isOpen()||this._config.maxConnectionLifetime<Date.now()-e.creationTimestamp)}_destroyConnection(e){return delete this._openConnections[e.id],e.close()}async _verifyConnectivityAndGetServerVersion({address:e}){var e=await this._connectionPool.acquire({},e),t=new ServerInfo(e.server,e.protocol().version);try{e.protocol().isLastMessageLogon()||await e.resetAndFlush()}finally{await e.release()}return t}async _verifyAuthentication({getAddress:e,auth:t}){var r=[];try{var n,o=await e(),i=await this._connectionPool.acquire({auth:t,skipReAuth:!0},o),s=(r.push(i),!i.protocol().isLastMessageLogon());if(i.supportsReAuth)return s&&i.supportsReAuth?await this._authenticationProvider.authenticate({connection:i,auth:t,waitReAuth:!0,forceReAuth:!0}):s&&!i.supportsReAuth&&((n=await this._connectionPool.acquire({auth:t},o,{requireNew:!0}))._sticky=!0,r.push(n)),!0;throw newError("Driver is connected to a database that does not support user switch.")}catch(e){if(AUTHENTICATION_ERRORS.includes(e.code))return!1;throw e}finally{await Promise.all(r.map(e=>e.release()))}}async _verifyStickyConnection({auth:e,connection:t}){var e=equals(e,t.authToken),r=!e;if(t._sticky=e&&!t.supportsReAuth,r||t._sticky)throw await t.release(),newError("Driver is connected to a database that does not support user switch.")}async close(){await this._connectionPool.close(),await Promise.all(Object.values(this._openConnections).map(e=>e.close()))}static _installIdleObserverOnConnection(e,t){e._setIdle(t)}static _removeIdleObserverOnConnection(e){e._unsetIdle()}_handleSecurityError(e,t,r){return this._authenticationProvider.handleError({connection:r,code:e.code})&&(e.retriable=!0),"Neo.ClientError.Security.AuthorizationExpired"===e.code&&this._connectionPool.apply(t,e=>{e.authToken=null}),r&&r.close().catch(()=>{}),e}}const{BOLT_PROTOCOL_V3:BOLT_PROTOCOL_V3$1,BOLT_PROTOCOL_V4_0:BOLT_PROTOCOL_V4_0$1,BOLT_PROTOCOL_V4_4:BOLT_PROTOCOL_V4_4$1,BOLT_PROTOCOL_V5_1:BOLT_PROTOCOL_V5_1$1}=internal["constants"],SERVICE_UNAVAILABLE$1=error["SERVICE_UNAVAILABLE"];class DirectConnectionProvider extends PooledConnectionProvider{constructor({id:e,config:t,log:r,address:n,userAgent:o,boltAgent:i,authTokenManager:s,newPool:a}){super({id:e,config:t,log:r,userAgent:o,boltAgent:i,authTokenManager:s,newPool:a}),this._address=n}async acquireConnection({database:n,auth:e,forceReAuth:t}={}){var r=ConnectionErrorHandler.create({errorCode:SERVICE_UNAVAILABLE$1,handleSecurityError:(e,t,r)=>this._handleSecurityError(e,t,r,n)}),t=await this._connectionPool.acquire({auth:e,forceReAuth:t},this._address);return e?(await this._verifyStickyConnection({auth:e,connection:t,address:this._address}),t):new DelegateConnection(t,r)}_handleSecurityError(e,t,r,n){return this._log.warn(`Direct driver ${this._id} will close connection to ${t} for database '${n}' because of an error ${e.code} '${e.message}'`),super._handleSecurityError(e,t,r)}async _hasProtocolVersion(e){var t=await createChannelConnection(this._address,this._config,this._createConnectionErrorHandler(),this._log),r=t.protocol()?t.protocol().version:null;return await t.close(),!!r&&e(r)}async supportsMultiDb(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V4_0$1)}getNegotiatedProtocolVersion(){return new Promise((e,t)=>{this._hasProtocolVersion(e).catch(t)})}async supportsTransactionConfig(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V3$1)}async supportsUserImpersonation(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V4_4$1)}async supportsSessionAuth(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V5_1$1)}async verifyAuthentication({auth:e}){return this._verifyAuthentication({auth:e,getAddress:()=>this._address})}async verifyConnectivityAndGetServerInfo(){return this._verifyConnectivityAndGetServerVersion({address:this._address})}}const{constants:{ACCESS_MODE_WRITE:WRITE$1,ACCESS_MODE_READ:READ$1},serverAddress:{ServerAddress}}=internal,PROTOCOL_ERROR=error["PROTOCOL_ERROR"],MIN_ROUTERS=1;class RoutingTable{constructor({database:e,routers:t,readers:r,writers:n,expirationTime:o,ttl:i}={}){this.database=e||null,this.databaseName=e||"default database",this.routers=t||[],this.readers=r||[],this.writers=n||[],this.expirationTime=o||int(0),this.ttl=i}static fromRawRoutingTable(e,t,r){return createValidRoutingTable(e,t,r)}forget(e){this.readers=removeFromArray(this.readers,e),this.writers=removeFromArray(this.writers,e)}forgetRouter(e){this.routers=removeFromArray(this.routers,e)}forgetWriter(e){this.writers=removeFromArray(this.writers,e)}isStaleFor(e){return this.expirationTime.lessThan(Date.now())||this.routers.length<MIN_ROUTERS||e===READ$1&&0===this.readers.length||e===WRITE$1&&0===this.writers.length}isExpiredFor(e){return this.expirationTime.add(e).lessThan(Date.now())}allServers(){return[...this.routers,...this.readers,...this.writers]}toString(){return"RoutingTable["+`database=${this.databaseName}, `+`expirationTime=${this.expirationTime}, `+`currentTime=${Date.now()}, `+`routers=[${this.routers}], `+`readers=[${this.readers}], `+`writers=[${this.writers}]]`}}function removeFromArray(e,t){return e.filter(e=>e.asKey()!==t.asKey())}function createValidRoutingTable(e,t,r){var n=r.ttl,o=calculateExpirationTime(r,t),{routers:i,readers:s,writers:a}=parseServers(r,t);return assertNonEmpty(i,"routers",t),assertNonEmpty(s,"readers",t),new RoutingTable({database:e||r.db,routers:i,readers:s,writers:a,expirationTime:o,ttl:n})}function parseServers(t,r){try{let r=[],n=[],o=[];return t.servers.forEach(e=>{var t=e.role,e=e.addresses;"ROUTE"===t?r=parseArray(e).map(e=>ServerAddress.fromUrl(e)):"WRITE"===t?o=parseArray(e).map(e=>ServerAddress.fromUrl(e)):"READ"===t&&(n=parseArray(e).map(e=>ServerAddress.fromUrl(e)))}),{routers:r,readers:n,writers:o}}catch(e){throw newError(`Unable to parse servers entry from router ${r} from addresses:
${stringify(t.servers)}
Error message: `+e.message,PROTOCOL_ERROR)}}function calculateExpirationTime(t,r){try{var e=int(Date.now()),n=int(t.ttl).multiply(1e3).add(e);return n.lessThan(e)?Integer.MAX_VALUE:n}catch(e){throw newError(`Unable to parse TTL entry from router ${r} from raw routing table:
${stringify(t)}
Error message: `+e.message,PROTOCOL_ERROR)}}function assertNonEmpty(e,t,r){if(0===e.length)throw newError("Received no "+t+" from router "+r,PROTOCOL_ERROR)}function parseArray(e){if(Array.isArray(e))return Array.from(e);throw new TypeError("Array expected but got: "+e)}class Rediscovery{constructor(e){this._routingContext=e}lookupRoutingTableOnRouter(t,r,n,o){return t._acquireConnection(e=>this._requestRawRoutingTable(e,t,r,n,o).then(e=>e.isNull?null:RoutingTable.fromRawRoutingTable(r,n,e)))}_requestRawRoutingTable(r,n,o,e,i){return new Promise((e,t)=>{r.protocol().requestRoutingInformation({routingContext:this._routingContext,databaseName:o,impersonatedUser:i,sessionContext:{bookmarks:n._lastBookmarks,mode:n._mode,database:n._database,afterComplete:n._onComplete},onCompleted:e,onError:t})})}}const{SERVICE_UNAVAILABLE,SESSION_EXPIRED}=error,{bookmarks:{Bookmarks},constants:{ACCESS_MODE_READ:READ,ACCESS_MODE_WRITE:WRITE,BOLT_PROTOCOL_V3,BOLT_PROTOCOL_V4_0,BOLT_PROTOCOL_V4_4,BOLT_PROTOCOL_V5_1}}=internal,PROCEDURE_NOT_FOUND_CODE="Neo.ClientError.Procedure.ProcedureNotFound",DATABASE_NOT_FOUND_CODE="Neo.ClientError.Database.DatabaseNotFound",INVALID_BOOKMARK_CODE="Neo.ClientError.Transaction.InvalidBookmark",INVALID_BOOKMARK_MIXTURE_CODE="Neo.ClientError.Transaction.InvalidBookmarkMixture",AUTHORIZATION_EXPIRED_CODE="Neo.ClientError.Security.AuthorizationExpired",INVALID_ARGUMENT_ERROR="Neo.ClientError.Statement.ArgumentError",INVALID_REQUEST_ERROR="Neo.ClientError.Request.Invalid",STATEMENT_TYPE_ERROR="Neo.ClientError.Statement.TypeError",NOT_AVAILABLE="N/A",SYSTEM_DB_NAME="system",DEFAULT_DB_NAME=null,DEFAULT_ROUTING_TABLE_PURGE_DELAY=int(3e4);class RoutingConnectionProvider extends PooledConnectionProvider{constructor({id:e,address:t,routingContext:r,hostNameResolver:n,config:o,log:i,userAgent:s,boltAgent:a,authTokenManager:u,routingTablePurgeDelay:l,newPool:c}){super({id:e,config:o,log:i,userAgent:s,boltAgent:a,authTokenManager:u,newPool:c},e=>createChannelConnection(e,this._config,this._createConnectionErrorHandler(),this._log,this._routingContext)),this._routingContext={...r,address:t.toString()},this._seedRouter=t,this._rediscovery=new Rediscovery(this._routingContext),this._loadBalancingStrategy=new LeastConnectedLoadBalancingStrategy(this._connectionPool),this._hostNameResolver=n,this._dnsResolver=new HostNameResolver,this._log=i,this._useSeedRouter=!0,this._routingTableRegistry=new RoutingTableRegistry(l?int(l):DEFAULT_ROUTING_TABLE_PURGE_DELAY),this._refreshRoutingTable=reuseOngoingRequest(this._refreshRoutingTable,this)}_createConnectionErrorHandler(){return new ConnectionErrorHandler(SESSION_EXPIRED)}_handleUnavailability(e,t,r){return this._log.warn(`Routing driver ${this._id} will forget ${t} for database '${r}' because of an error ${e.code} '${e.message}'`),this.forget(t,r||DEFAULT_DB_NAME),e}_handleSecurityError(e,t,r,n){return this._log.warn(`Routing driver ${this._id} will close connections to ${t} for database '${n}' because of an error ${e.code} '${e.message}'`),super._handleSecurityError(e,t,r,n)}_handleWriteFailure(e,t,r){return this._log.warn(`Routing driver ${this._id} will forget writer ${t} for database '${r}' because of an error ${e.code} '${e.message}'`),this.forgetWriter(t,r||DEFAULT_DB_NAME),newError("No longer possible to write to server at "+t,SESSION_EXPIRED,e)}async acquireConnection({accessMode:e,database:t,bookmarks:r,impersonatedUser:n,onDatabaseNameResolved:o,auth:i}={}){let s,a;const u={database:t||DEFAULT_DB_NAME};t=new ConnectionErrorHandler(SESSION_EXPIRED,(e,t)=>this._handleUnavailability(e,t,u.database),(e,t)=>this._handleWriteFailure(e,t,u.database),(e,t,r)=>this._handleSecurityError(e,t,r,u.database)),r=await this._freshRoutingTable({accessMode:e,database:u.database,bookmarks:r,impersonatedUser:n,auth:i,onDatabaseNameResolved:e=>{u.database=u.database||e,o&&o(e)}});if(e===READ)a=this._loadBalancingStrategy.selectReader(r.readers),s="read";else{if(e!==WRITE)throw newError("Illegal mode "+e);a=this._loadBalancingStrategy.selectWriter(r.writers),s="write"}if(!a)throw newError(`Failed to obtain connection towards ${s} server. Known routing table is: `+r,SESSION_EXPIRED);try{var l=await this._connectionPool.acquire({auth:i},a);return i?(await this._verifyStickyConnection({auth:i,connection:l,address:a}),l):new DelegateConnection(l,t)}catch(e){throw t.handleAndTransformError(e,a)}}async _hasProtocolVersion(t){var r=await this._resolveSeedRouter(this._seedRouter);let n;for(let e=0;e<r.length;e++)try{var o=await createChannelConnection(r[e],this._config,this._createConnectionErrorHandler(),this._log),i=o.protocol()?o.protocol().version:null;return await o.close(),i?t(i):!1}catch(e){n=e}if(n)throw n;return!1}async supportsMultiDb(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V4_0)}async supportsTransactionConfig(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V3)}async supportsUserImpersonation(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V4_4)}async supportsSessionAuth(){return this._hasProtocolVersion(e=>e>=BOLT_PROTOCOL_V5_1)}getNegotiatedProtocolVersion(){return new Promise((e,t)=>{this._hasProtocolVersion(e).catch(t)})}async verifyAuthentication({database:r,accessMode:n,auth:o}){return this._verifyAuthentication({auth:o,getAddress:async()=>{const t={database:r||DEFAULT_DB_NAME};var e=await this._freshRoutingTable({accessMode:n,database:t.database,auth:o,onDatabaseNameResolved:e=>{t.database=t.database||e}}),e=n===WRITE?e.writers:e.readers;if(0===e.length)throw newError(`No servers available for database '${t.database}' with access mode '${n}'`,SERVICE_UNAVAILABLE);return e[0]}})}async verifyConnectivityAndGetServerInfo({database:e,accessMode:t}){const r={database:e||DEFAULT_DB_NAME};e=await this._freshRoutingTable({accessMode:t,database:r.database,onDatabaseNameResolved:e=>{r.database=r.database||e}}),e=t===WRITE?e.writers:e.readers;let n=newError(`No servers available for database '${r.database}' with access mode '${t}'`,SERVICE_UNAVAILABLE);for(const o of e)try{return await this._verifyConnectivityAndGetServerVersion({address:o})}catch(e){n=e}throw n}forget(t,e){this._routingTableRegistry.apply(e,{applyWhenExists:e=>e.forget(t)}),this._connectionPool.purge(t).catch(()=>{})}forgetWriter(t,e){this._routingTableRegistry.apply(e,{applyWhenExists:e=>e.forgetWriter(t)})}_freshRoutingTable({accessMode:e,database:t,bookmarks:r,impersonatedUser:n,onDatabaseNameResolved:o,auth:i}={}){var s=this._routingTableRegistry.get(t,()=>new RoutingTable({database:t}));return s.isStaleFor(e)?(this._log.info(`Routing table is stale for database: "${t}" and access mode: "${e}": `+s),this._refreshRoutingTable(s,r,n,i).then(e=>(o(e.database),e))):s}_refreshRoutingTable(e,t,r,n){var o=e.routers;return this._useSeedRouter?this._fetchRoutingTableFromSeedRouterFallbackToKnownRouters(o,e,t,r,n):this._fetchRoutingTableFromKnownRoutersFallbackToSeedRouter(o,e,t,r,n)}async _fetchRoutingTableFromSeedRouterFallbackToKnownRouters(e,t,r,n,o){let[i,s]=await this._fetchRoutingTableUsingSeedRouter([],this._seedRouter,t,r,n,o);return i?this._useSeedRouter=!1:([e,r]=await this._fetchRoutingTableUsingKnownRouters(e,t,r,n,o),i=e,s=r||s),this._applyRoutingTableIfPossible(t,i,s)}async _fetchRoutingTableFromKnownRoutersFallbackToSeedRouter(e,t,r,n,o){let[i,s]=await this._fetchRoutingTableUsingKnownRouters(e,t,r,n,o);return i||([i,s]=await this._fetchRoutingTableUsingSeedRouter(e,this._seedRouter,t,r,n,o)),this._applyRoutingTableIfPossible(t,i,s)}async _fetchRoutingTableUsingKnownRouters(e,t,r,n,o){var[r,n]=await this._fetchRoutingTable(e,t,r,n,o);return r?[r,null]:(o=e.length-1,RoutingConnectionProvider._forgetRouter(t,e,o),[null,n])}async _fetchRoutingTableUsingSeedRouter(t,e,r,n,o,i){e=(await this._resolveSeedRouter(e)).filter(e=>t.indexOf(e)<0);return this._fetchRoutingTable(e,r,n,o,i)}async _resolveSeedRouter(e){e=await this._hostNameResolver.resolve(e),e=await Promise.all(e.map(e=>this._dnsResolver.resolve(e)));return[].concat.apply([],e)}async _fetchRoutingTable(o,i,s,a,u){return o.reduce(async(e,t,r)=>{var[e]=await e;if(e)return[e,null];var e=r-1,[r,n]=(RoutingConnectionProvider._forgetRouter(i,o,e),await this._createSessionForRediscovery(t,s,a,u));if(!r)return[null,n];try{return[await this._rediscovery.lookupRoutingTableOnRouter(r,i.database,t,a),null]}catch(n){return this._handleRediscoveryError(n,t)}finally{r.close()}},Promise.resolve([null,null]))}async _createSessionForRediscovery(t,e,r,n){try{var o=await this._connectionPool.acquire({auth:n},t),i=(n&&await this._verifyStickyConnection({auth:n,connection:o,address:t}),ConnectionErrorHandler.create({errorCode:SESSION_EXPIRED,handleSecurityError:(e,t,r)=>this._handleSecurityError(e,t,r)})),s=o._sticky?new DelegateConnection(o):new DelegateConnection(o,i),a=new SingleConnectionProvider(s);return o.protocol().version<4?[new Session({mode:WRITE,bookmarks:Bookmarks.empty(),connectionProvider:a}),null]:[new Session({mode:READ,database:SYSTEM_DB_NAME,bookmarks:e,connectionProvider:a,impersonatedUser:r}),null]}catch(e){return this._handleRediscoveryError(e,t)}}_handleRediscoveryError(e,t){if(_isFailFastError(e)||_isFailFastSecurityError(e))throw e;if(e.code===PROCEDURE_NOT_FOUND_CODE)throw newError(`Server at ${t.asHostPort()} can't perform routing. Make sure you are connecting to a causal cluster`,SERVICE_UNAVAILABLE,e);return this._log.warn("unable to fetch routing table because of an error "+e),[null,e]}async _applyRoutingTableIfPossible(e,t,r){if(t)return 0===t.writers.length&&(this._useSeedRouter=!0),await this._updateRoutingTable(t),t;throw newError("Could not perform discovery. No routing servers available. Known routing table: "+e,SERVICE_UNAVAILABLE,r)}async _updateRoutingTable(e){await this._connectionPool.keepAll(e.allServers()),this._routingTableRegistry.removeExpired(),this._routingTableRegistry.register(e),this._log.info("Updated routing table "+e)}static _forgetRouter(e,t,r){t=t[r];e&&t&&e.forgetRouter(t)}}class RoutingTableRegistry{constructor(e){this._tables=new Map,this._routingTablePurgeDelay=e}register(e){return this._tables.set(e.database,e),this}apply(e,{applyWhenExists:t,applyWhenDontExists:r=()=>{}}={}){return this._tables.has(e)?t(this._tables.get(e)):"string"==typeof e||null===e?r():this._forEach(t),this}get(e,t){return this._tables.has(e)?this._tables.get(e):"function"==typeof t?t():t}removeExpired(){return this._removeIf(e=>e.isExpiredFor(this._routingTablePurgeDelay))}_forEach(e){for(var[,t]of this._tables)e(t);return this}_remove(e){return this._tables.delete(e),this}_removeIf(e){for(var[t,r]of this._tables)e(r)&&this._remove(t);return this}}function _isFailFastError(e){return[DATABASE_NOT_FOUND_CODE,INVALID_BOOKMARK_CODE,INVALID_BOOKMARK_MIXTURE_CODE,INVALID_ARGUMENT_ERROR,INVALID_REQUEST_ERROR,STATEMENT_TYPE_ERROR,NOT_AVAILABLE].includes(e.code)}function _isFailFastSecurityError(e){return e.code.startsWith("Neo.ClientError.Security.")&&![AUTHORIZATION_EXPIRED_CODE].includes(e.code)}var lib=Object.freeze({__proto__:null,loadBalancing:index$6,bolt:index$2,buf:index$5,channel:index$4,packstream:index$3,pool:index$1,SingleConnectionProvider:SingleConnectionProvider,PooledConnectionProvider:PooledConnectionProvider,DirectConnectionProvider:DirectConnectionProvider,RoutingConnectionProvider:RoutingConnectionProvider}),require$$3=getAugmentedNamespace(lib),index=(!function(e){var t=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,s,a,u){return new(a=a||Promise)(function(r,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,o)}i((u=u.apply(e,s||[])).next())})},o=commonjsGlobal&&commonjsGlobal.__generator||function(n,o){var i,s,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},l={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function e(r){return function(e){var t=[r,e];if(i)throw new TypeError("Generator is already executing.");for(;u=l&&t[l=0]?0:u;)try{if(i=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,s=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))u.label=t[1];else if(6===t[0]&&u.label<a[1])u.label=a[1],a=t;else{if(!(a&&u.label<a[2])){a[2]&&u.ops.pop(),u.trys.pop();continue}u.label=a[2],u.ops.push(t)}}t=o.call(n,u)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},h=(Object.defineProperty(e,"__esModule",{value:!0}),e.Point=e.TransactionPromise=e.ManagedTransaction=e.Transaction=e.Session=e.ServerInfo=e.Notification=e.QueryStatistics=e.ProfiledPlan=e.Plan=e.Integer=e.Path=e.PathSegment=e.UnboundRelationship=e.Relationship=e.Node=e.ResultSummary=e.Record=e.EagerResult=e.Result=e.Driver=e.temporal=e.spatial=e.graph=e.error=e.routing=e.session=e.types=e.logging=e.auth=e.isRetriableError=e.Neo4jError=e.integer=e.isUnboundRelationship=e.isRelationship=e.isPathSegment=e.isPath=e.isNode=e.isDateTime=e.isLocalDateTime=e.isDate=e.isTime=e.isLocalTime=e.isDuration=e.isPoint=e.isInt=e.int=e.hasReachableServer=e.driver=e.authTokenManagers=void 0,e.notificationFilterMinimumSeverityLevel=e.notificationFilterDisabledCategory=e.notificationSeverityLevel=e.notificationCategory=e.resultTransformers=e.bookmarkManager=e.Connection=e.ConnectionProvider=e.DateTime=e.LocalDateTime=e.Date=e.Time=e.LocalTime=e.Duration=void 0,r(version$1)),n=logging,_=(Object.defineProperty(e,"logging",{enumerable:!0,get:function(){return n.logging}}),require$$2),d=(Object.defineProperty(e,"auth",{enumerable:!0,get:function(){return _.auth}}),Object.defineProperty(e,"authTokenManagers",{enumerable:!0,get:function(){return _.authTokenManagers}}),Object.defineProperty(e,"bookmarkManager",{enumerable:!0,get:function(){return _.bookmarkManager}}),Object.defineProperty(e,"Connection",{enumerable:!0,get:function(){return _.Connection}}),Object.defineProperty(e,"ConnectionProvider",{enumerable:!0,get:function(){return _.ConnectionProvider}}),Object.defineProperty(e,"Date",{enumerable:!0,get:function(){return _.Date}}),Object.defineProperty(e,"DateTime",{enumerable:!0,get:function(){return _.DateTime}}),Object.defineProperty(e,"Driver",{enumerable:!0,get:function(){return _.Driver}}),Object.defineProperty(e,"Duration",{enumerable:!0,get:function(){return _.Duration}}),Object.defineProperty(e,"EagerResult",{enumerable:!0,get:function(){return _.EagerResult}}),Object.defineProperty(e,"error",{enumerable:!0,get:function(){return _.error}}),Object.defineProperty(e,"int",{enumerable:!0,get:function(){return _.int}}),Object.defineProperty(e,"Integer",{enumerable:!0,get:function(){return _.Integer}}),Object.defineProperty(e,"isDate",{enumerable:!0,get:function(){return _.isDate}}),Object.defineProperty(e,"isDateTime",{enumerable:!0,get:function(){return _.isDateTime}}),Object.defineProperty(e,"isDuration",{enumerable:!0,get:function(){return _.isDuration}}),Object.defineProperty(e,"isInt",{enumerable:!0,get:function(){return _.isInt}}),Object.defineProperty(e,"isLocalDateTime",{enumerable:!0,get:function(){return _.isLocalDateTime}}),Object.defineProperty(e,"isLocalTime",{enumerable:!0,get:function(){return _.isLocalTime}}),Object.defineProperty(e,"isNode",{enumerable:!0,get:function(){return _.isNode}}),Object.defineProperty(e,"isPath",{enumerable:!0,get:function(){return _.isPath}}),Object.defineProperty(e,"isPathSegment",{enumerable:!0,get:function(){return _.isPathSegment}}),Object.defineProperty(e,"isPoint",{enumerable:!0,get:function(){return _.isPoint}}),Object.defineProperty(e,"isRelationship",{enumerable:!0,get:function(){return _.isRelationship}}),Object.defineProperty(e,"isRetriableError",{enumerable:!0,get:function(){return _.isRetriableError}}),Object.defineProperty(e,"isTime",{enumerable:!0,get:function(){return _.isTime}}),Object.defineProperty(e,"isUnboundRelationship",{enumerable:!0,get:function(){return _.isUnboundRelationship}}),Object.defineProperty(e,"LocalDateTime",{enumerable:!0,get:function(){return _.LocalDateTime}}),Object.defineProperty(e,"LocalTime",{enumerable:!0,get:function(){return _.LocalTime}}),Object.defineProperty(e,"ManagedTransaction",{enumerable:!0,get:function(){return _.ManagedTransaction}}),Object.defineProperty(e,"Neo4jError",{enumerable:!0,get:function(){return _.Neo4jError}}),Object.defineProperty(e,"Node",{enumerable:!0,get:function(){return _.Node}}),Object.defineProperty(e,"Notification",{enumerable:!0,get:function(){return _.Notification}}),Object.defineProperty(e,"notificationCategory",{enumerable:!0,get:function(){return _.notificationCategory}}),Object.defineProperty(e,"notificationFilterDisabledCategory",{enumerable:!0,get:function(){return _.notificationFilterDisabledCategory}}),Object.defineProperty(e,"notificationFilterMinimumSeverityLevel",{enumerable:!0,get:function(){return _.notificationFilterMinimumSeverityLevel}}),Object.defineProperty(e,"notificationSeverityLevel",{enumerable:!0,get:function(){return _.notificationSeverityLevel}}),Object.defineProperty(e,"Path",{enumerable:!0,get:function(){return _.Path}}),Object.defineProperty(e,"PathSegment",{enumerable:!0,get:function(){return _.PathSegment}}),Object.defineProperty(e,"Plan",{enumerable:!0,get:function(){return _.Plan}}),Object.defineProperty(e,"Point",{enumerable:!0,get:function(){return _.Point}}),Object.defineProperty(e,"ProfiledPlan",{enumerable:!0,get:function(){return _.ProfiledPlan}}),Object.defineProperty(e,"QueryStatistics",{enumerable:!0,get:function(){return _.QueryStatistics}}),Object.defineProperty(e,"Record",{enumerable:!0,get:function(){return _.Record}}),Object.defineProperty(e,"Relationship",{enumerable:!0,get:function(){return _.Relationship}}),Object.defineProperty(e,"Result",{enumerable:!0,get:function(){return _.Result}}),Object.defineProperty(e,"ResultSummary",{enumerable:!0,get:function(){return _.ResultSummary}}),Object.defineProperty(e,"resultTransformers",{enumerable:!0,get:function(){return _.resultTransformers}}),Object.defineProperty(e,"routing",{enumerable:!0,get:function(){return _.routing}}),Object.defineProperty(e,"ServerInfo",{enumerable:!0,get:function(){return _.ServerInfo}}),Object.defineProperty(e,"Session",{enumerable:!0,get:function(){return _.Session}}),Object.defineProperty(e,"Time",{enumerable:!0,get:function(){return _.Time}}),Object.defineProperty(e,"Transaction",{enumerable:!0,get:function(){return _.Transaction}}),Object.defineProperty(e,"TransactionPromise",{enumerable:!0,get:function(){return _.TransactionPromise}}),Object.defineProperty(e,"UnboundRelationship",{enumerable:!0,get:function(){return _.UnboundRelationship}}),require$$3),r=_.driver.READ,i=_.driver.WRITE,s=_.internal.util,f=s.ENCRYPTION_ON,m=s.assertString,g=s.isEmptyObjectOrNull,p=_.internal.serverAddress.ServerAddress,E=_.internal.urlUtil,T="neo4j-javascript/"+h.default;function a(e,t,r){void 0===r&&(r={}),m(e,"Bolt URL");var n,o,i=E.parseDatabaseUrl(e),s=!1,a=!1;switch(i.scheme){case"bolt":break;case"bolt+s":a=!0,o="TRUST_SYSTEM_CA_SIGNED_CERTIFICATES";break;case"bolt+ssc":a=!0,o="TRUST_ALL_CERTIFICATES";break;case"neo4j":s=!0;break;case"neo4j+s":o="TRUST_SYSTEM_CA_SIGNED_CERTIFICATES",s=a=!0;break;case"neo4j+ssc":o="TRUST_ALL_CERTIFICATES",s=a=!0;break;default:throw new Error("Unknown scheme: ".concat(null!=(n=i.scheme)?n:"null"))}if(a){if("encrypted"in r||"trust"in r)throw new Error("Encryption/trust can only be configured either through URL or config, not both");r.encrypted=f,r.trust=o}var u="object"==typeof(c=t=t)&&null!=c&&"getToken"in c&&"handleSecurityException"in c&&"function"==typeof c.getToken&&"function"==typeof c.handleSecurityException?t:((c=null!=(c=t)?c:{}).scheme=null!=(t=c.scheme)?t:"none",(0,_.staticAuthTokenManager)({authToken:c})),l=(r.userAgent=null!=(t=r.userAgent)?t:T,r.boltAgent=_.internal.boltAgent.fromVersion("neo4j-javascript/"+h.default),p.fromUrl(i.hostAndPort)),c={address:l,typename:s?"Routing":"Direct",routing:s};return new _.Driver(c,r,function(){{if(s)return function(e,t,r,n){return new d.RoutingConnectionProvider({id:e,config:t,log:r,hostNameResolver:n,authTokenManager:u,address:l,userAgent:t.userAgent,boltAgent:t.boltAgent,routingContext:i.query})};if(g(i.query))return function(e,t,r){return new d.DirectConnectionProvider({id:e,config:t,log:r,authTokenManager:u,address:l,userAgent:t.userAgent,boltAgent:t.boltAgent})};throw new Error("Parameters are not supported with none routed scheme. Given URL: '".concat(e,"'"))}}())}function u(r,n){return t(this,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:t=a(r,{scheme:"none",principal:"",credentials:""},n),e.label=1;case 1:return e.trys.push([1,,3,5]),[4,t.getNegotiatedProtocolVersion()];case 2:return e.sent(),[2,!0];case 3:return[4,t.close()];case 4:return e.sent(),[7];case 5:return[2]}})})}e.driver=a,e.hasReachableServer=u;var s={Node:_.Node,Relationship:_.Relationship,UnboundRelationship:_.UnboundRelationship,PathSegment:_.PathSegment,Path:_.Path,Result:_.Result,EagerResult:_.EagerResult,ResultSummary:_.ResultSummary,Record:_.Record,Point:_.Point,Date:_.Date,DateTime:_.DateTime,Duration:_.Duration,LocalDateTime:_.LocalDateTime,LocalTime:_.LocalTime,Time:_.Time,Integer:_.Integer},r=(e.types=s,{READ:r,WRITE:i}),i=(e.session=r,{toNumber:_.toNumber,toString:_.toString,inSafeRange:_.inSafeRange}),l=(e.integer=i,{isPoint:_.isPoint}),c=(e.spatial=l,{isDuration:_.isDuration,isLocalTime:_.isLocalTime,isTime:_.isTime,isDate:_.isDate,isLocalDateTime:_.isLocalDateTime,isDateTime:_.isDateTime}),b=(e.temporal=c,{isNode:_.isNode,isPath:_.isPath,isPathSegment:_.isPathSegment,isRelationship:_.isRelationship,isUnboundRelationship:_.isUnboundRelationship}),i=(e.graph=b,{authTokenManagers:_.authTokenManagers,driver:a,hasReachableServer:u,int:_.int,isInt:_.isInt,isPoint:_.isPoint,isDuration:_.isDuration,isLocalTime:_.isLocalTime,isTime:_.isTime,isDate:_.isDate,isLocalDateTime:_.isLocalDateTime,isDateTime:_.isDateTime,isNode:_.isNode,isPath:_.isPath,isPathSegment:_.isPathSegment,isRelationship:_.isRelationship,isUnboundRelationship:_.isUnboundRelationship,integer:i,Neo4jError:_.Neo4jError,isRetriableError:_.isRetriableError,auth:_.auth,logging:n.logging,types:s,session:r,routing:_.routing,error:_.error,graph:b,spatial:l,temporal:c,Driver:_.Driver,Result:_.Result,EagerResult:_.EagerResult,Record:_.Record,ResultSummary:_.ResultSummary,Node:_.Node,Relationship:_.Relationship,UnboundRelationship:_.UnboundRelationship,PathSegment:_.PathSegment,Path:_.Path,Integer:_.Integer,Plan:_.Plan,ProfiledPlan:_.ProfiledPlan,QueryStatistics:_.QueryStatistics,Notification:_.Notification,ServerInfo:_.ServerInfo,Session:_.Session,Transaction:_.Transaction,ManagedTransaction:_.ManagedTransaction,TransactionPromise:_.TransactionPromise,Point:_.Point,Duration:_.Duration,LocalTime:_.LocalTime,Time:_.Time,Date:_.Date,LocalDateTime:_.LocalDateTime,DateTime:_.DateTime,ConnectionProvider:_.ConnectionProvider,Connection:_.Connection,bookmarkManager:_.bookmarkManager,resultTransformers:_.resultTransformers,notificationCategory:_.notificationCategory,notificationSeverityLevel:_.notificationSeverityLevel,notificationFilterDisabledCategory:_.notificationFilterDisabledCategory,notificationFilterMinimumSeverityLevel:_.notificationFilterMinimumSeverityLevel});e.default=i}(lib$2),getDefaultExportFromCjs(lib$2));export{index as default};